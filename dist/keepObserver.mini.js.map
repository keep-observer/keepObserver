{"version":3,"file":"keepObserver.mini.js","sources":["webpack:///webpack/universalModuleDefinition","webpack:///./@util/index.js","webpack:///./@core/report/kibanaApm.js","webpack:///./@core/middleware/kibanaApmTrack.js","webpack:///./@core/monitor/htmlElementActive.js","webpack:///./@core/monitor/network.js","webpack:///./@core/monitor/log.js","webpack:///./@core/instance.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse {\n\t\tvar a = factory();\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(window, function() {\nreturn ","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse {\n\t\tvar a = factory();\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(window, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// define __esModule on exports\n/******/ \t__webpack_require__.r = function(exports) {\n/******/ \t\tObject.defineProperty(exports, '__esModule', { value: true });\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = \"./src/util/index.ts\");\n/******/ })\n/************************************************************************/\n/******/ ({\n\n/***/ \"./node_modules/fast-safe-stringify/index.js\":\n/*!***************************************************!*\\\n  !*** ./node_modules/fast-safe-stringify/index.js ***!\n  \\***************************************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\nmodule.exports = stringify;\nstringify.default = stringify;\nstringify.stable = deterministicStringify;\nstringify.stableStringify = deterministicStringify;\nvar arr = [];\nvar replacerStack = []; // Regular stringify\n\nfunction stringify(obj, replacer, spacer) {\n  decirc(obj, '', [], undefined);\n  var res;\n\n  if (replacerStack.length === 0) {\n    res = JSON.stringify(obj, replacer, spacer);\n  } else {\n    res = JSON.stringify(obj, replaceGetterValues(replacer), spacer);\n  }\n\n  while (arr.length !== 0) {\n    var part = arr.pop();\n\n    if (part.length === 4) {\n      Object.defineProperty(part[0], part[1], part[3]);\n    } else {\n      part[0][part[1]] = part[2];\n    }\n  }\n\n  return res;\n}\n\nfunction decirc(val, k, stack, parent) {\n  var i;\n\n  if (typeof val === 'object' && val !== null) {\n    for (i = 0; i < stack.length; i++) {\n      if (stack[i] === val) {\n        var propertyDescriptor = Object.getOwnPropertyDescriptor(parent, k);\n\n        if (propertyDescriptor.get !== undefined) {\n          if (propertyDescriptor.configurable) {\n            Object.defineProperty(parent, k, {\n              value: '[Circular]'\n            });\n            arr.push([parent, k, val, propertyDescriptor]);\n          } else {\n            replacerStack.push([val, k]);\n          }\n        } else {\n          parent[k] = '[Circular]';\n          arr.push([parent, k, val]);\n        }\n\n        return;\n      }\n    }\n\n    stack.push(val); // Optimize for Arrays. Big arrays could kill the performance otherwise!\n\n    if (Array.isArray(val)) {\n      for (i = 0; i < val.length; i++) {\n        decirc(val[i], i, stack, val);\n      }\n    } else {\n      var keys = Object.keys(val);\n\n      for (i = 0; i < keys.length; i++) {\n        var key = keys[i];\n        decirc(val[key], key, stack, val);\n      }\n    }\n\n    stack.pop();\n  }\n} // Stable-stringify\n\n\nfunction compareFunction(a, b) {\n  if (a < b) {\n    return -1;\n  }\n\n  if (a > b) {\n    return 1;\n  }\n\n  return 0;\n}\n\nfunction deterministicStringify(obj, replacer, spacer) {\n  var tmp = deterministicDecirc(obj, '', [], undefined) || obj;\n  var res;\n\n  if (replacerStack.length === 0) {\n    res = JSON.stringify(tmp, replacer, spacer);\n  } else {\n    res = JSON.stringify(tmp, replaceGetterValues(replacer), spacer);\n  }\n\n  while (arr.length !== 0) {\n    var part = arr.pop();\n\n    if (part.length === 4) {\n      Object.defineProperty(part[0], part[1], part[3]);\n    } else {\n      part[0][part[1]] = part[2];\n    }\n  }\n\n  return res;\n}\n\nfunction deterministicDecirc(val, k, stack, parent) {\n  var i;\n\n  if (typeof val === 'object' && val !== null) {\n    for (i = 0; i < stack.length; i++) {\n      if (stack[i] === val) {\n        var propertyDescriptor = Object.getOwnPropertyDescriptor(parent, k);\n\n        if (propertyDescriptor.get !== undefined) {\n          if (propertyDescriptor.configurable) {\n            Object.defineProperty(parent, k, {\n              value: '[Circular]'\n            });\n            arr.push([parent, k, val, propertyDescriptor]);\n          } else {\n            replacerStack.push([val, k]);\n          }\n        } else {\n          parent[k] = '[Circular]';\n          arr.push([parent, k, val]);\n        }\n\n        return;\n      }\n    }\n\n    if (typeof val.toJSON === 'function') {\n      return;\n    }\n\n    stack.push(val); // Optimize for Arrays. Big arrays could kill the performance otherwise!\n\n    if (Array.isArray(val)) {\n      for (i = 0; i < val.length; i++) {\n        deterministicDecirc(val[i], i, stack, val);\n      }\n    } else {\n      // Create a temporary object in the required way\n      var tmp = {};\n      var keys = Object.keys(val).sort(compareFunction);\n\n      for (i = 0; i < keys.length; i++) {\n        var key = keys[i];\n        deterministicDecirc(val[key], key, stack, val);\n        tmp[key] = val[key];\n      }\n\n      if (parent !== undefined) {\n        arr.push([parent, k, val]);\n        parent[k] = tmp;\n      } else {\n        return tmp;\n      }\n    }\n\n    stack.pop();\n  }\n} // wraps replacer function to handle values we couldn't replace\n// and mark them as [Circular]\n\n\nfunction replaceGetterValues(replacer) {\n  replacer = replacer !== undefined ? replacer : function (k, v) {\n    return v;\n  };\n  return function (key, val) {\n    if (replacerStack.length > 0) {\n      for (var i = 0; i < replacerStack.length; i++) {\n        var part = replacerStack[i];\n\n        if (part[1] === key && part[0] === val) {\n          val = '[Circular]';\n          replacerStack.splice(i, 1);\n          break;\n        }\n      }\n    }\n\n    return replacer.call(this, key, val);\n  };\n}\n\n/***/ }),\n\n/***/ \"./node_modules/hash-string/build/hash-string.js\":\n/*!*******************************************************!*\\\n  !*** ./node_modules/hash-string/build/hash-string.js ***!\n  \\*******************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;(function (root, factory) {\n  if (true) {\n    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n  } else {}\n})(this, function () {\n  /**\n      A string hashing function based on Daniel J. Bernstein's popular 'times 33' hash algorithm.\n      @param {string} text - String to hash\n      @return {number} Resulting number.\n  */\n  function hash(text) {\n    'use strict';\n\n    var hash = 5381,\n        index = text.length;\n\n    while (index) {\n      hash = hash * 33 ^ text.charCodeAt(--index);\n    }\n\n    return hash >>> 0;\n  }\n\n  return hash;\n});\n\n/***/ }),\n\n/***/ \"./src/constants/index.ts\":\n/*!********************************!*\\\n  !*** ./src/constants/index.ts ***!\n  \\********************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n}); //上报数据类型\n\nexports.reportType = ['unKownType', 'log', 'network', 'vue']; //版本号\n\nexports.version = '2.0.0-beta.1'; //公共中间件\n\nexports.publicMiddleScopeNames = ['sendMessage', 'error'];\n\n/***/ }),\n\n/***/ \"./src/util/console.ts\":\n/*!*****************************!*\\\n  !*** ./src/util/console.ts ***!\n  \\*****************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nvar __spread = this && this.__spread || function () {\n  for (var ar = [], i = 0; i < arguments.length; i++) ar = ar.concat(__read(arguments[i]));\n\n  return ar;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar $log = window.console.log;\nvar $wran = window.console.warn;\nvar $error = window.console.error;\n\nwindow.console.log = function () {\n  var args = [];\n\n  for (var _i = 0; _i < arguments.length; _i++) {\n    args[_i] = arguments[_i];\n  }\n\n  $log.apply(window.console, args);\n};\n\nwindow.console.error = function () {\n  var args = [];\n\n  for (var _i = 0; _i < arguments.length; _i++) {\n    args[_i] = arguments[_i];\n  }\n\n  $error.apply(window.console, args);\n};\n\nwindow.console.warn = function () {\n  var args = [];\n\n  for (var _i = 0; _i < arguments.length; _i++) {\n    args[_i] = arguments[_i];\n  }\n\n  $wran.apply(window.console, args);\n};\n\nexports.log = $log;\nexports.error = $error;\nexports.wran = $wran;\n\nexports.devLog = function (develop) {\n  if (develop === void 0) {\n    develop = true;\n  }\n\n  var arg = [];\n\n  for (var _i = 1; _i < arguments.length; _i++) {\n    arg[_i - 1] = arguments[_i];\n  }\n\n  if (!develop) return;\n  return exports.log.apply(void 0, __spread([\"[keepObserver] log message:\"], arg));\n};\n\nexports.devWarn = function (develop) {\n  if (develop === void 0) {\n    develop = true;\n  }\n\n  var arg = [];\n\n  for (var _i = 1; _i < arguments.length; _i++) {\n    arg[_i - 1] = arguments[_i];\n  }\n\n  if (!develop) return;\n  return exports.wran.apply(void 0, __spread([\"[keepObserver] wran message:\"], arg));\n};\n\nexports.warnError = function () {\n  var msg = [];\n\n  for (var _i = 0; _i < arguments.length; _i++) {\n    msg[_i] = arguments[_i];\n  }\n\n  return exports.error.apply(void 0, __spread([\"[keepObserver] find error! message:\"], msg));\n};\n\n/***/ }),\n\n/***/ \"./src/util/deviceID.ts\":\n/*!******************************!*\\\n  !*** ./src/util/deviceID.ts ***!\n  \\******************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n  result[\"default\"] = mod;\n  return result;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar Tools = __importStar(__webpack_require__(/*! ./tool */ \"./src/util/tool.ts\")); //storge-key\n\n\nvar RecordKey = 'deviceId';\n\nvar getDeviceId = function () {\n  return storageModel();\n}; //localStorage model\n\n\nvar storageModel = function () {\n  if (!window.localStorage) {\n    return false;\n  }\n\n  var deviceID = Tools.getStorage(RecordKey);\n\n  if (!deviceID) {\n    deviceID = Tools.getUniqueID();\n    Tools.setStorage(RecordKey, deviceID);\n  }\n\n  return deviceID;\n}; //iframe model\n//暂未开启 需要先写好iframe页面\n//这里还有个问题 iframe是异步获取deviceID 现在的流程放在instance初始化阶段, 异步获取会影响接下来一些流程\n//暂不启用, 放在第二次重构升级在启用\n\n\nvar iframeModel = function () {};\n\nexports.default = getDeviceId;\n\n/***/ }),\n\n/***/ \"./src/util/index.ts\":\n/*!***************************!*\\\n  !*** ./src/util/index.ts ***!\n  \\***************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n  result[\"default\"] = mod;\n  return result;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar Tools = __importStar(__webpack_require__(/*! ./tool */ \"./src/util/tool.ts\"));\n\nexports.Tools = Tools;\n\nvar consoleTools = __importStar(__webpack_require__(/*! ./console */ \"./src/util/console.ts\"));\n\nexports.consoleTools = consoleTools;\n\nvar deviceID_1 = __importDefault(__webpack_require__(/*! ./deviceID */ \"./src/util/deviceID.ts\"));\n\nexports.getDeviceId = deviceID_1.default;\n\nvar public_1 = __importDefault(__webpack_require__(/*! ./share/public */ \"./src/util/share/public/index.ts\"));\n\nexports.KeepObserverPublic = public_1.default;\n\nvar middleware_1 = __importDefault(__webpack_require__(/*! ./share/middleware */ \"./src/util/share/middleware/index.ts\"));\n\nexports.KeepObserverMiddleWare = middleware_1.default;\n\n/***/ }),\n\n/***/ \"./src/util/share/middleware/index.ts\":\n/*!********************************************!*\\\n  !*** ./src/util/share/middleware/index.ts ***!\n  \\********************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nvar __spread = this && this.__spread || function () {\n  for (var ar = [], i = 0; i < arguments.length; i++) ar = ar.concat(__read(arguments[i]));\n\n  return ar;\n};\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n  result[\"default\"] = mod;\n  return result;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar Tools = __importStar(__webpack_require__(/*! ../../../util/tool */ \"./src/util/tool.ts\"));\n\nvar consoleTools = __importStar(__webpack_require__(/*! ../../../util/console */ \"./src/util/console.ts\"));\n\nvar index_1 = __webpack_require__(/*! ../../../constants/index */ \"./src/constants/index.ts\");\n\nvar KeepObserverMiddleWare =\n/** @class */\nfunction () {\n  function KeepObserverMiddleWare(_a) {\n    var _b = _a.develop,\n        develop = _b === void 0 ? false : _b,\n        _c = _a.runMiddleTimeOut,\n        runMiddleTimeOut = _c === void 0 ? 30000 : _c; //当前是否处于开发模式\n\n    this._develop = develop; //中间件超时时间\n\n    this._runMiddleTimeOut = runMiddleTimeOut; //中间件初始化\n\n    this._middles = {}; //中间件执行过程中 禁止重复触发 loop\n\n    this._runMiddleBuff = {};\n  }\n\n  KeepObserverMiddleWare.usePublishMiddles = function (scopeName, middlesFn) {\n    var _staticSelf = this;\n\n    if (_staticSelf.publicMiddles[scopeName]) {\n      _staticSelf.publicMiddles[scopeName].unshift(middlesFn);\n\n      return _staticSelf.publicMiddles;\n    }\n\n    _staticSelf.publicMiddles[scopeName] = [];\n\n    _staticSelf.publicMiddles[scopeName].unshift(middlesFn);\n\n    return _staticSelf.publicMiddles;\n  }; //unshift 从前向后执行 第一个加入的中间件最后一个执行\n\n\n  KeepObserverMiddleWare.prototype.use = function (scopeName, middlesFn) {\n    var _self = this;\n\n    if (_self._middles[scopeName]) {\n      return _self._middles[scopeName].unshift(middlesFn);\n    }\n\n    _self._middles[scopeName] = [];\n    return _self._middles[scopeName].unshift(middlesFn);\n  }; //中间件异步执行\n\n\n  KeepObserverMiddleWare.prototype.run = function (scopeName) {\n    var _this = this;\n\n    var args = [];\n\n    for (var _i = 1; _i < arguments.length; _i++) {\n      args[_i - 1] = arguments[_i];\n    }\n\n    var _self = this; //获取到公共中间件聚合\n\n\n    var publicMiddles = this.constructor.publicMiddles;\n\n    if (!_self._middles[scopeName] && !publicMiddles[scopeName]) {\n      if (index_1.publicMiddleScopeNames.indexOf(scopeName) > -1) {\n        return new Promise(function (resolve) {\n          return resolve.apply(void 0, __spread(args));\n        });\n      }\n\n      consoleTools.warnError(scopeName + \" middles function is undefined\");\n      return Promise.reject(scopeName + \" middles function is undefined\");\n    }\n\n    if (_self._runMiddleBuff[scopeName]) {\n      consoleTools.warnError(scopeName + \" middles is run\");\n      return Promise.reject(scopeName + \" middles is run\");\n    } //合并中间件队列\n\n\n    var publicMiddleQueue = publicMiddles[scopeName] || [];\n    var middlesQueue = publicMiddleQueue.concat(_self._middles[scopeName] || []);\n    var len = middlesQueue.length;\n    var index = 1; //开始执行\n\n    _self._runMiddleBuff[scopeName] = true;\n    this.constructor.currentRunMiddle = scopeName;\n    return new Promise(function (resolve, reject) {\n      //设置超时\n      var runTimeout = setTimeout(function () {\n        index = len;\n        _self._runMiddleBuff[scopeName] = false;\n        var errorMsg = scopeName + \" middles exec is timeout \" + _this._runMiddleTimeOut + \"ms\";\n        consoleTools.warnError(errorMsg);\n\n        if (scopeName !== 'error') {\n          _self.throwError(errorMsg);\n        }\n\n        reject(errorMsg);\n      }, _this._runMiddleTimeOut); // 中断方法，停止执行剩下的中间件,直接返回\n\n      var interrupt = function () {\n        var result = [];\n\n        for (var _i = 0; _i < arguments.length; _i++) {\n          result[_i] = arguments[_i];\n        }\n\n        index = len;\n        clearTimeout(runTimeout);\n        _self._runMiddleBuff[scopeName] = false;\n        return resolve.apply(void 0, __spread(result));\n      };\n\n      try {\n        //向下执行中间件\n        var runNext_1 = function (next) {\n          return function () {\n            var params = [];\n\n            for (var _i = 0; _i < arguments.length; _i++) {\n              params[_i] = arguments[_i];\n            }\n\n            if (index === len) {\n              return params;\n            }\n\n            index++;\n            return next.apply(void 0, __spread(params));\n          };\n        };\n\n        var exec = middlesQueue.reduce(function (a, b) {\n          return function () {\n            var params = [];\n\n            for (var _i = 0; _i < arguments.length; _i++) {\n              params[_i] = arguments[_i];\n            }\n\n            return a(interrupt, runNext_1(b.apply(void 0, __spread(params))));\n          };\n        });\n        exec(interrupt, interrupt).apply(void 0, __spread(args));\n      } catch (err) {\n        _self._runMiddleBuff[scopeName] = false;\n        clearTimeout(runTimeout);\n        var errorMsg = scopeName + \" middles exec is error:\" + Tools.toString(err);\n        consoleTools.warnError(errorMsg);\n\n        if (scopeName !== 'error') {\n          _self.throwError(errorMsg);\n        }\n\n        reject(errorMsg);\n      }\n    }).finally(function () {\n      _this.constructor.currentRunMiddle = false;\n    });\n  }; //抛出中间件错误\n\n\n  KeepObserverMiddleWare.prototype.throwError = function () {\n    var err = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      err[_i] = arguments[_i];\n    }\n\n    this.run.apply(this, __spread(['error'], err));\n  };\n\n  ; //公共方法和部分\n\n  KeepObserverMiddleWare.publicMiddles = {};\n  KeepObserverMiddleWare.currentRunMiddle = false;\n  return KeepObserverMiddleWare;\n}();\n\nexports.default = KeepObserverMiddleWare;\n\n/***/ }),\n\n/***/ \"./src/util/share/public/index.ts\":\n/*!****************************************!*\\\n  !*** ./src/util/share/public/index.ts ***!\n  \\****************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nvar __spread = this && this.__spread || function () {\n  for (var ar = [], i = 0; i < arguments.length; i++) ar = ar.concat(__read(arguments[i]));\n\n  return ar;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n  result[\"default\"] = mod;\n  return result;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar index_1 = __webpack_require__(/*! ../../../constants/index */ \"./src/constants/index.ts\");\n\nvar index_2 = __importDefault(__webpack_require__(/*! ../middleware/index */ \"./src/util/share/middleware/index.ts\"));\n\nvar Tools = __importStar(__webpack_require__(/*! ../../tool */ \"./src/util/tool.ts\"));\n\nvar KeepObserverPublic =\n/** @class */\nfunction () {\n  function KeepObserverPublic(config) {\n    if (config === void 0) {\n      config = {};\n    }\n\n    var _a = config,\n        _b = _a.develop,\n        develop = _b === void 0 ? false : _b,\n        _c = _a.runMiddleTimeOut,\n        runMiddleTimeOut = _c === void 0 ? 30000 : _c; //当前是否处于开发模式\n\n    this._develop = develop; //由子元素继承并重载\n\n    this.middleScopeNames = []; //由子元素继承\n\n    this._publicMiddleScopeNames = index_1.publicMiddleScopeNames; //注册中间件实例\n\n    this._middleWareInstance = new index_2.default(Tools.extend({\n      develop: develop,\n      runMiddleTimeOut: runMiddleTimeOut\n    }, config));\n  }\n\n  KeepObserverPublic.extendReport = function (params) {\n    var newParams = __assign({}, this.extendReportParams, params);\n\n    this.extendReportParams = newParams;\n    return newParams;\n  }; //注册中间件逻辑\n\n\n  KeepObserverPublic.prototype.useMiddle = function (scopeName, middlesFn) {\n    var _self = this;\n\n    _self._middleWareInstance.use(scopeName, middlesFn);\n\n    return _self;\n  }; //执行中间件逻辑\n\n\n  KeepObserverPublic.prototype.runMiddle = function (scopeName) {\n    var args = [];\n\n    for (var _i = 1; _i < arguments.length; _i++) {\n      args[_i - 1] = arguments[_i];\n    }\n\n    var _a;\n\n    var _self = this;\n\n    return (_a = _self._middleWareInstance).run.apply(_a, __spread([scopeName], args));\n  }; //整理上报数据\n\n\n  KeepObserverPublic.prototype.handleReportData = function (params) {\n    var defaultParams = {\n      data: undefined,\n      type: 'undefined',\n      typeName: 'undefined'\n    }; //获取到公共中间件聚合\n\n    var extendParams = this.constructor.extendReportParams;\n\n    var reportParams = __assign({}, defaultParams, {\n      location: window.location.href,\n      environment: window.navigator.userAgent,\n      reportTime: new Date().getTime()\n    }, params, extendParams);\n\n    return reportParams;\n  };\n\n  KeepObserverPublic.extendReportParams = {};\n  return KeepObserverPublic;\n}();\n\nexports.default = KeepObserverPublic;\n\n/***/ }),\n\n/***/ \"./src/util/tool.ts\":\n/*!**************************!*\\\n  !*** ./src/util/tool.ts ***!\n  \\**************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar console_1 = __webpack_require__(/*! ./console */ \"./src/util/console.ts\");\n\nvar hash_string_1 = __importDefault(__webpack_require__(/*! hash-string */ \"./node_modules/hash-string/build/hash-string.js\"));\n\nvar fast_safe_stringify_1 = __importDefault(__webpack_require__(/*! fast-safe-stringify */ \"./node_modules/fast-safe-stringify/index.js\"));\n/**\n * 根据时间搓 返回时间\n * @param date format\n * @return string\n */\n\n\nfunction dateFormat(date, format) {\n  if (!format || typeof format !== 'string') {\n    console.error('format is undefiend or type is Error');\n    return '';\n  }\n\n  date = date instanceof Date ? date : typeof date === 'number' || typeof date === 'string' ? new Date(date) : new Date(); //解析\n\n  var formatReg = {\n    'y+': date.getFullYear(),\n    'M+': date.getMonth() + 1,\n    'd+': date.getDate(),\n    'h+': date.getHours(),\n    'm+': date.getMinutes(),\n    's+': date.getSeconds()\n  };\n\n  for (var reg in formatReg) {\n    if (new RegExp(reg).test(format)) {\n      var match = RegExp.lastMatch;\n      format = format.replace(match, formatReg[reg] < 10 ? '0' + formatReg[reg] : formatReg[reg].toString());\n    }\n  }\n\n  return format;\n}\n\nexports.dateFormat = dateFormat;\n/**\n * 检查script基本数据类型\n * @param mixed value\n * @return boolean\n */\n\nfunction isNumber(value) {\n  return Object.prototype.toString.call(value) == '[object Number]';\n}\n\nexports.isNumber = isNumber;\n\nfunction isString(value) {\n  return Object.prototype.toString.call(value) == '[object String]';\n}\n\nexports.isString = isString;\n\nfunction isArray(value) {\n  return Object.prototype.toString.call(value) == '[object Array]';\n}\n\nexports.isArray = isArray;\n\nfunction isBoolean(value) {\n  return Object.prototype.toString.call(value) == '[object Boolean]';\n}\n\nexports.isBoolean = isBoolean;\n\nfunction isRegExp(value) {\n  return Object.prototype.toString.call(value) == \"[object RegExp]\";\n}\n\nexports.isRegExp = isRegExp;\n\nfunction isDateObject(value) {\n  return Object.prototype.toString.call(value) == \"[object Date]\";\n}\n\nexports.isDateObject = isDateObject;\n\nfunction isUndefined(value) {\n  return value === undefined;\n}\n\nexports.isUndefined = isUndefined;\n\nfunction isNull(value) {\n  return value === null;\n}\n\nexports.isNull = isNull;\n\nfunction isExist(value) {\n  return !isUndefined(value) && !isNull(value);\n}\n\nexports.isExist = isExist;\n\nfunction isSymbol(value) {\n  return Object.prototype.toString.call(value) == '[object Symbol]';\n}\n\nexports.isSymbol = isSymbol;\n\nfunction isSVGElement(value) {\n  return isElement(value) && (value instanceof SVGElement || value.ownerSVGElement);\n}\n\nexports.isSVGElement = isSVGElement;\n\nfunction isObject(value) {\n  return Object.prototype.toString.call(value) == '[object Object]' || // if it isn't a primitive value, then it is a common object\n  !isNumber(value) && !isString(value) && !isBoolean(value) && !isDateObject(value) && !isRegExp(value) && !isArray(value) && !isNull(value) && !isFunction(value) && !isUndefined(value) && !isSymbol(value);\n}\n\nexports.isObject = isObject;\n\nfunction isEmptyObject(obj) {\n  if (!isObject(obj)) {\n    return true;\n  }\n\n  for (var key in obj) {\n    return false;\n  }\n\n  return true;\n}\n\nexports.isEmptyObject = isEmptyObject;\n\nfunction isEmptyArray(array) {\n  if (!isArray(array)) {\n    return true;\n  }\n\n  return array.length > 0 ? false : true;\n}\n\nexports.isEmptyArray = isEmptyArray;\n\nfunction isFunction(value) {\n  return Object.prototype.toString.call(value) == '[object Function]';\n}\n\nexports.isFunction = isFunction;\n\nfunction isElement(value) {\n  return typeof HTMLElement === 'object' ? value instanceof HTMLElement : //DOM2\n  value && typeof value === \"object\" && value !== null && value.nodeType === 1 && typeof value.nodeName === \"string\";\n}\n\nexports.isElement = isElement;\n\nfunction isWindow(value) {\n  var toString = Object.prototype.toString.call(value);\n  return toString == '[object global]' || toString == '[object Window]' || toString == '[object DOMWindow]';\n}\n\nexports.isWindow = isWindow;\n/**\n * 检查是否是普通空对象\n * @param object obj\n * @return boolean\n */\n\nfunction isPlainObject(obj) {\n  var hasOwn = Object.prototype.hasOwnProperty; // Must be an Object.\n\n  if (!obj || typeof obj !== 'object' || obj.nodeType || isWindow(obj)) {\n    return false;\n  }\n\n  try {\n    if (obj.constructor && !hasOwn.call(obj, 'constructor') && !hasOwn.call(obj.constructor.prototype, 'isPrototypeOf')) {\n      return false;\n    }\n  } catch (e) {\n    return false;\n  }\n\n  var key;\n\n  for (key in obj) {}\n\n  return key === undefined || hasOwn.call(obj, key);\n}\n\nexports.isPlainObject = isPlainObject;\n/*\n * 检查是否是class 实例对象\n*/\n\nfunction isClassObject(obj) {\n  return isObject(obj) && !isPlainObject(obj) ? true : false;\n}\n\nexports.isClassObject = isClassObject;\n/*\n  转换工具\n */\n\nfunction toArray(array) {\n  if (Array.from) {\n    return Array.from(array);\n  }\n\n  return Array.prototype.slice.call(array);\n}\n\nexports.toArray = toArray;\n\nfunction toString(content) {\n  if (typeof content === 'string') {\n    return content;\n  }\n\n  return content.toString();\n}\n\nexports.toString = toString;\n/*\n    辅助存储保存监控数据\n*/\n//sessionStorage\n\nfunction setSessionStorage(key, value) {\n  if (!window.sessionStorage) {\n    return;\n  }\n\n  key = 'keepObserverData_' + key;\n  value = JSON.stringify(value);\n  sessionStorage.setItem(key, value);\n}\n\nexports.setSessionStorage = setSessionStorage;\n\nfunction getSessionStorage(key) {\n  if (!window.sessionStorage) {\n    return;\n  }\n\n  key = 'keepObserverData_' + key;\n  var value = sessionStorage.getItem(key);\n  return value ? JSON.parse(value) : '';\n}\n\nexports.getSessionStorage = getSessionStorage;\n\nfunction removeSessionStorage(key) {\n  if (!window.sessionStorage) {\n    return;\n  }\n\n  key = 'keepObserverData_' + key;\n  sessionStorage.removeItem(key);\n}\n\nexports.removeSessionStorage = removeSessionStorage; //localStorage\n\nfunction setStorage(key, value) {\n  if (!window.localStorage) {\n    return;\n  }\n\n  key = 'keepObserverData_' + key;\n  value = JSON.stringify(value);\n  localStorage.setItem(key, value);\n}\n\nexports.setStorage = setStorage;\n\nfunction getStorage(key) {\n  if (!window.localStorage) {\n    return;\n  }\n\n  key = 'keepObserverData_' + key;\n  var value = localStorage.getItem(key);\n  return value ? JSON.parse(value) : '';\n}\n\nexports.getStorage = getStorage;\n\nfunction removeStorage(key) {\n  if (!window.localStorage) {\n    return;\n  }\n\n  key = 'keepObserverData_' + key;\n  localStorage.removeItem(key);\n}\n\nexports.removeStorage = removeStorage;\n/*\n    参考Vconsole 生产唯一ID\n */\n\nfunction getUniqueID() {\n  var id = 'xxxxxxxx-xxx-t-xxx--xxxxxxxx'.replace(/[xyt]/g, function (c) {\n    var r = Math.random() * 16 | 0,\n        t = new Date().getTime(),\n        v = c == 'x' ? r : c == 't' ? t : r & 0x3 | 0x8;\n    return v.toString(16);\n  });\n  return id;\n}\n\nexports.getUniqueID = getUniqueID;\n/*\n    深度合并内容\n    引用类型克隆合并\n    arguments[0] = target\n    arguments type is Object Or Array\n    多内容合并覆盖优先级: arguments[0]<arguments[1]<arguments[2]..\n    如果sources 不是数组或者对象 则直接忽略\n */\n\nfunction extend() {\n  var arg = [];\n\n  for (var _i = 0; _i < arguments.length; _i++) {\n    arg[_i] = arguments[_i];\n  }\n\n  var args = toArray(arguments);\n\n  if (args.length === 0) {\n    console.error(\"extends params is undefined\");\n    return {};\n  }\n\n  if (args.length === 1) {\n    return args[0];\n  }\n\n  var target = args[0];\n  var sources = args.slice(1, args.length);\n\n  if (!isObject(target) && !isArray(target)) {\n    target = {};\n  }\n\n  sources.map(function (item) {\n    //防止死循环\n    if (target === item) {\n      return false;\n    } //如果内容是对象\n\n\n    if (isObject(item)) {\n      //开始遍历\n      for (var key in item) {\n        //如果内容是对象\n        if (isObject(item[key]) && !isEmptyObject(item[key])) {\n          //修正数据\n          target[key] = target[key] && isObject(target[key]) ? target[key] : {};\n          target[key] = extend(target[key], item[key]);\n        } else if (isArray(item[key]) && !isEmptyArray(item[key])) {\n          //修正数据\n          target[key] = target[key] && isArray(target[key]) ? target[key] : [];\n          target[key] = extend(target[key], item[key]);\n        } else if (isObject(item[key]) && isEmptyObject(item[key])) {\n          target[key] = {};\n        } else if (isArray(item[key]) && isEmptyArray(item[key])) {\n          target[key] = [];\n        } else {\n          //基本类型直接赋值\n          target[key] = item[key];\n        }\n      }\n    } else if (isArray(item)) {\n      for (var i = 0; i < item.length; i++) {\n        //如果内容是对象\n        if (isObject(item[i]) && !isEmptyObject(item[i])) {\n          //修正数据\n          target[i] = target[i] && isObject(target[i]) ? target[i] : {};\n          target[i] = extend(target[i], item[i]);\n        } else if (isArray(item[i]) && !isEmptyArray(item[i])) {\n          //修正数据\n          target[i] = target[i] && isArray(target[i]) ? target[i] : [];\n          target[i] = extend(target[i], item[i]);\n        } else if (isObject(item[i]) && isEmptyObject(item[i])) {\n          target[i] = {};\n        } else if (isArray(item[i]) && isEmptyArray(item[i])) {\n          target[i] = [];\n        } else {\n          //基本类型直接赋值\n          target[i] = item[i];\n        }\n      }\n    } //其他类型直接忽略\n\n  });\n  return target;\n}\n\nexports.extend = extend;\n/*\n    mixin calss method and params\n*/\n\nfunction mixin(origin, provider) {\n  if (!provider || !isObject(provider) || isEmptyObject(provider)) {\n    console_1.warnError('keepObserver $mixin receive params not right');\n  }\n\n  for (var key in provider) {\n    if (origin[key]) {\n      console_1.warnError('keepObserver $mixin method key: ' + key + ' is exist');\n      continue;\n    } //不允许重写\n\n\n    Object.defineProperty(origin, key, {\n      configurable: false,\n      enumerable: true,\n      value: provider[key]\n    });\n  }\n}\n\nexports.mixin = mixin;\n/**\n * @filter:\n * @param obj { array and object}\n * @param call { array.filter(callback)}\n * @return: new obj\n */\n\nfunction filter(obj, callback) {\n  if (!isArray(obj) && !isObject(obj) || !isFunction(callback)) {\n    return obj;\n  }\n\n  if (isArray(obj)) {\n    return obj.filter(callback);\n  }\n\n  var newObje = {};\n\n  for (var key in obj) {\n    var value = obj[key];\n\n    if (callback(value, key)) {\n      newObje[key] = value;\n    }\n  }\n\n  return newObje;\n}\n\nexports.filter = filter;\n/**\n * @map:\n * @param obj { array and object}\n * @param call { array.filter(callback)}\n * @return: new obj\n */\n\nfunction map(obj, callback) {\n  if (!isArray(obj) && !isObject(obj) || !isFunction(callback)) {\n    return obj;\n  }\n\n  if (isArray(obj)) {\n    return obj.map(callback);\n  }\n\n  var newObje = {};\n\n  for (var key in obj) {\n    var value = obj[key];\n    newObje[key] = callback(value, key);\n  }\n\n  return newObje;\n}\n\nexports.map = map;\n/**\n * @map:\n * @param obj { array and object}\n * @param call { array.filter(callback)}\n * @return: new Array\n */\n\nfunction mapToArray(obj, callback) {\n  if (!isArray(obj) && !isObject(obj) || !isFunction(callback)) {\n    return obj;\n  }\n\n  if (isArray(obj)) {\n    return obj.map(callback);\n  }\n\n  var newArray = [];\n\n  for (var key in obj) {\n    var value = obj[key];\n    newArray.push(callback(value, key));\n  }\n\n  return newArray;\n}\n\nexports.mapToArray = mapToArray;\n\nfunction throttleWrap(delay) {\n  return function (Fn) {\n    var timeout = null;\n    return function () {\n      var arg = arguments;\n\n      if (timeout) {\n        clearTimeout(timeout);\n      }\n\n      ;\n      timeout = setTimeout(function () {\n        Fn(arg);\n      }, delay);\n    };\n  };\n}\n\nexports.throttleWrap = throttleWrap;\n\nfunction debounceWrap(delay) {\n  return function (Fn) {\n    var timeout = null;\n    return function () {\n      var any = [];\n\n      for (var _i = 0; _i < arguments.length; _i++) {\n        any[_i] = arguments[_i];\n      }\n\n      var arg = arguments;\n\n      if (timeout !== null) {\n        return false;\n      }\n\n      ;\n      timeout = setTimeout(function () {\n        Fn(arg);\n        clearTimeout(timeout);\n        timeout = null;\n      }, delay);\n    };\n  };\n}\n\nexports.debounceWrap = debounceWrap;\n\nfunction objectStringify(object) {\n  return fast_safe_stringify_1.default(object, function (key, value) {\n    if (isWindow(value)) {\n      return '[Window]';\n    }\n\n    if (isElement(value)) {\n      return '[DomElement]';\n    }\n\n    return value;\n  });\n}\n\nexports.objectStringify = objectStringify;\n\nfunction getHashCode(object) {\n  //Times33\n  try {\n    var hashCode = hash_string_1.default(objectStringify(object)); //md5(objectStringify(object))\n\n    return toString(hashCode);\n  } catch (err) {\n    return toString(hash_string_1.default(toString(err))); //md5(toString(err))\n  }\n}\n\nexports.getHashCode = getHashCode;\n\nfunction substringLimt(text, limt, flag) {\n  if (limt === void 0) {\n    limt = 200;\n  }\n\n  if (flag === void 0) {\n    flag = true;\n  }\n\n  text = isString(text) ? text : toString(text);\n  return text.substring(0, text.length > limt ? limt : text.length) + (text.length > limt && flag ? '...' : '');\n}\n\nexports.substringLimt = substringLimt;\n\n/***/ })\n\n/******/ });\n});","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"@util/index\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"@util/index\"], factory);\n\telse {\n\t\tvar a = typeof exports === 'object' ? factory(require(\"@util/index\")) : factory(root[\"@util/index\"]);\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(window, function(__WEBPACK_EXTERNAL_MODULE__util_index__) {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// define __esModule on exports\n/******/ \t__webpack_require__.r = function(exports) {\n/******/ \t\tObject.defineProperty(exports, '__esModule', { value: true });\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = \"./src/services/report/kibanaApm/index.ts\");\n/******/ })\n/************************************************************************/\n/******/ ({\n\n/***/ \"./node_modules/elastic-apm-js-core/node_modules/error-stack-parser/error-stack-parser.js\":\n/*!************************************************************************************************!*\\\n  !*** ./node_modules/elastic-apm-js-core/node_modules/error-stack-parser/error-stack-parser.js ***!\n  \\************************************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;(function (root, factory) {\n  'use strict'; // Universal Module Definition (UMD) to support AMD, CommonJS/Node.js, Rhino, and browsers.\n\n  /* istanbul ignore next */\n\n  if (true) {\n    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [__webpack_require__(/*! stackframe */ \"./node_modules/elastic-apm-js-core/node_modules/stackframe/stackframe.js\")], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n  } else {}\n})(this, function ErrorStackParser(StackFrame) {\n  'use strict';\n\n  var FIREFOX_SAFARI_STACK_REGEXP = /(^|@)\\S+\\:\\d+/;\n  var CHROME_IE_STACK_REGEXP = /^\\s*at .*(\\S+\\:\\d+|\\(native\\))/m;\n  var SAFARI_NATIVE_CODE_REGEXP = /^(eval@)?(\\[native code\\])?$/;\n\n  function _map(array, fn, thisArg) {\n    if (typeof Array.prototype.map === 'function') {\n      return array.map(fn, thisArg);\n    } else {\n      var output = new Array(array.length);\n\n      for (var i = 0; i < array.length; i++) {\n        output[i] = fn.call(thisArg, array[i]);\n      }\n\n      return output;\n    }\n  }\n\n  function _filter(array, fn, thisArg) {\n    if (typeof Array.prototype.filter === 'function') {\n      return array.filter(fn, thisArg);\n    } else {\n      var output = [];\n\n      for (var i = 0; i < array.length; i++) {\n        if (fn.call(thisArg, array[i])) {\n          output.push(array[i]);\n        }\n      }\n\n      return output;\n    }\n  }\n\n  function _indexOf(array, target) {\n    if (typeof Array.prototype.indexOf === 'function') {\n      return array.indexOf(target);\n    } else {\n      for (var i = 0; i < array.length; i++) {\n        if (array[i] === target) {\n          return i;\n        }\n      }\n\n      return -1;\n    }\n  }\n\n  return {\n    /**\n     * Given an Error object, extract the most information from it.\n     *\n     * @param {Error} error object\n     * @return {Array} of StackFrames\n     */\n    parse: function ErrorStackParser$$parse(error) {\n      if (typeof error.stacktrace !== 'undefined' || typeof error['opera#sourceloc'] !== 'undefined') {\n        return this.parseOpera(error);\n      } else if (error.stack && error.stack.match(CHROME_IE_STACK_REGEXP)) {\n        return this.parseV8OrIE(error);\n      } else if (error.stack) {\n        return this.parseFFOrSafari(error);\n      } else {\n        throw new Error('Cannot parse given Error object');\n      }\n    },\n    // Separate line and column numbers from a string of the form: (URI:Line:Column)\n    extractLocation: function ErrorStackParser$$extractLocation(urlLike) {\n      // Fail-fast but return locations like \"(native)\"\n      if (urlLike.indexOf(':') === -1) {\n        return [urlLike];\n      }\n\n      var regExp = /(.+?)(?:\\:(\\d+))?(?:\\:(\\d+))?$/;\n      var parts = regExp.exec(urlLike.replace(/[\\(\\)]/g, ''));\n      return [parts[1], parts[2] || undefined, parts[3] || undefined];\n    },\n    parseV8OrIE: function ErrorStackParser$$parseV8OrIE(error) {\n      var filtered = _filter(error.stack.split('\\n'), function (line) {\n        return !!line.match(CHROME_IE_STACK_REGEXP);\n      }, this);\n\n      return _map(filtered, function (line) {\n        if (line.indexOf('(eval ') > -1) {\n          // Throw away eval information until we implement stacktrace.js/stackframe#8\n          line = line.replace(/eval code/g, 'eval').replace(/(\\(eval at [^\\()]*)|(\\)\\,.*$)/g, '');\n        }\n\n        var tokens = line.replace(/^\\s+/, '').replace(/\\(eval code/g, '(').split(/\\s+/).slice(1);\n        var locationParts = this.extractLocation(tokens.pop());\n        var functionName = tokens.join(' ') || undefined;\n        var fileName = _indexOf(['eval', '<anonymous>'], locationParts[0]) > -1 ? undefined : locationParts[0];\n        return new StackFrame(functionName, undefined, fileName, locationParts[1], locationParts[2], line);\n      }, this);\n    },\n    parseFFOrSafari: function ErrorStackParser$$parseFFOrSafari(error) {\n      var filtered = _filter(error.stack.split('\\n'), function (line) {\n        return !line.match(SAFARI_NATIVE_CODE_REGEXP);\n      }, this);\n\n      return _map(filtered, function (line) {\n        // Throw away eval information until we implement stacktrace.js/stackframe#8\n        if (line.indexOf(' > eval') > -1) {\n          line = line.replace(/ line (\\d+)(?: > eval line \\d+)* > eval\\:\\d+\\:\\d+/g, ':$1');\n        }\n\n        if (line.indexOf('@') === -1 && line.indexOf(':') === -1) {\n          // Safari eval frames only have function names and nothing else\n          return new StackFrame(line);\n        } else {\n          var tokens = line.split('@');\n          var locationParts = this.extractLocation(tokens.pop());\n          var functionName = tokens.join('@') || undefined;\n          return new StackFrame(functionName, undefined, locationParts[0], locationParts[1], locationParts[2], line);\n        }\n      }, this);\n    },\n    parseOpera: function ErrorStackParser$$parseOpera(e) {\n      if (!e.stacktrace || e.message.indexOf('\\n') > -1 && e.message.split('\\n').length > e.stacktrace.split('\\n').length) {\n        return this.parseOpera9(e);\n      } else if (!e.stack) {\n        return this.parseOpera10(e);\n      } else {\n        return this.parseOpera11(e);\n      }\n    },\n    parseOpera9: function ErrorStackParser$$parseOpera9(e) {\n      var lineRE = /Line (\\d+).*script (?:in )?(\\S+)/i;\n      var lines = e.message.split('\\n');\n      var result = [];\n\n      for (var i = 2, len = lines.length; i < len; i += 2) {\n        var match = lineRE.exec(lines[i]);\n\n        if (match) {\n          result.push(new StackFrame(undefined, undefined, match[2], match[1], undefined, lines[i]));\n        }\n      }\n\n      return result;\n    },\n    parseOpera10: function ErrorStackParser$$parseOpera10(e) {\n      var lineRE = /Line (\\d+).*script (?:in )?(\\S+)(?:: In function (\\S+))?$/i;\n      var lines = e.stacktrace.split('\\n');\n      var result = [];\n\n      for (var i = 0, len = lines.length; i < len; i += 2) {\n        var match = lineRE.exec(lines[i]);\n\n        if (match) {\n          result.push(new StackFrame(match[3] || undefined, undefined, match[2], match[1], undefined, lines[i]));\n        }\n      }\n\n      return result;\n    },\n    // Opera 10.65+ Error.stack very similar to FF/Safari\n    parseOpera11: function ErrorStackParser$$parseOpera11(error) {\n      var filtered = _filter(error.stack.split('\\n'), function (line) {\n        return !!line.match(FIREFOX_SAFARI_STACK_REGEXP) && !line.match(/^Error created at/);\n      }, this);\n\n      return _map(filtered, function (line) {\n        var tokens = line.split('@');\n        var locationParts = this.extractLocation(tokens.pop());\n        var functionCall = tokens.shift() || '';\n        var functionName = functionCall.replace(/<anonymous function(: (\\w+))?>/, '$2').replace(/\\([^\\)]*\\)/g, '') || undefined;\n        var argsRaw;\n\n        if (functionCall.match(/\\(([^\\)]*)\\)/)) {\n          argsRaw = functionCall.replace(/^[^\\(]+\\(([^\\)]*)\\)$/, '$1');\n        }\n\n        var args = argsRaw === undefined || argsRaw === '[arguments not available]' ? undefined : argsRaw.split(',');\n        return new StackFrame(functionName, args, locationParts[0], locationParts[1], locationParts[2], line);\n      }, this);\n    }\n  };\n});\n\n/***/ }),\n\n/***/ \"./node_modules/elastic-apm-js-core/node_modules/stackframe/stackframe.js\":\n/*!********************************************************************************!*\\\n  !*** ./node_modules/elastic-apm-js-core/node_modules/stackframe/stackframe.js ***!\n  \\********************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\nvar __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;(function (root, factory) {\n  'use strict'; // Universal Module Definition (UMD) to support AMD, CommonJS/Node.js, Rhino, and browsers.\n\n  /* istanbul ignore next */\n\n  if (true) {\n    !(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?\n\t\t\t\t(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),\n\t\t\t\t__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));\n  } else {}\n})(this, function () {\n  'use strict';\n\n  function _isNumber(n) {\n    return !isNaN(parseFloat(n)) && isFinite(n);\n  }\n\n  function StackFrame(functionName, args, fileName, lineNumber, columnNumber, source) {\n    if (functionName !== undefined) {\n      this.setFunctionName(functionName);\n    }\n\n    if (args !== undefined) {\n      this.setArgs(args);\n    }\n\n    if (fileName !== undefined) {\n      this.setFileName(fileName);\n    }\n\n    if (lineNumber !== undefined) {\n      this.setLineNumber(lineNumber);\n    }\n\n    if (columnNumber !== undefined) {\n      this.setColumnNumber(columnNumber);\n    }\n\n    if (source !== undefined) {\n      this.setSource(source);\n    }\n  }\n\n  StackFrame.prototype = {\n    getFunctionName: function () {\n      return this.functionName;\n    },\n    setFunctionName: function (v) {\n      this.functionName = String(v);\n    },\n    getArgs: function () {\n      return this.args;\n    },\n    setArgs: function (v) {\n      if (Object.prototype.toString.call(v) !== '[object Array]') {\n        throw new TypeError('Args must be an Array');\n      }\n\n      this.args = v;\n    },\n    // NOTE: Property name may be misleading as it includes the path,\n    // but it somewhat mirrors V8's JavaScriptStackTraceApi\n    // https://code.google.com/p/v8/wiki/JavaScriptStackTraceApi and Gecko's\n    // http://mxr.mozilla.org/mozilla-central/source/xpcom/base/nsIException.idl#14\n    getFileName: function () {\n      return this.fileName;\n    },\n    setFileName: function (v) {\n      this.fileName = String(v);\n    },\n    getLineNumber: function () {\n      return this.lineNumber;\n    },\n    setLineNumber: function (v) {\n      if (!_isNumber(v)) {\n        throw new TypeError('Line Number must be a Number');\n      }\n\n      this.lineNumber = Number(v);\n    },\n    getColumnNumber: function () {\n      return this.columnNumber;\n    },\n    setColumnNumber: function (v) {\n      if (!_isNumber(v)) {\n        throw new TypeError('Column Number must be a Number');\n      }\n\n      this.columnNumber = Number(v);\n    },\n    getSource: function () {\n      return this.source;\n    },\n    setSource: function (v) {\n      this.source = String(v);\n    },\n    toString: function () {\n      var functionName = this.getFunctionName() || '{anonymous}';\n      var args = '(' + (this.getArgs() || []).join(',') + ')';\n      var fileName = this.getFileName() ? '@' + this.getFileName() : '';\n      var lineNumber = _isNumber(this.getLineNumber()) ? ':' + this.getLineNumber() : '';\n      var columnNumber = _isNumber(this.getColumnNumber()) ? ':' + this.getColumnNumber() : '';\n      return functionName + args + fileName + lineNumber + columnNumber;\n    }\n  };\n  return StackFrame;\n});\n\n/***/ }),\n\n/***/ \"./node_modules/elastic-apm-js-core/src/common/apm-server.js\":\n/*!*******************************************************************!*\\\n  !*** ./node_modules/elastic-apm-js-core/src/common/apm-server.js ***!\n  \\*******************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n/**\n * MIT License\n *\n * Copyright (c) 2017-present, Elasticsearch BV\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n *\n */\nvar Queue = __webpack_require__(/*! ./queue */ \"./node_modules/elastic-apm-js-core/src/common/queue.js\");\n\nvar throttle = __webpack_require__(/*! ./throttle */ \"./node_modules/elastic-apm-js-core/src/common/throttle.js\");\n\nvar utils = __webpack_require__(/*! ./utils */ \"./node_modules/elastic-apm-js-core/src/common/utils.js\");\n\nvar NDJSON = __webpack_require__(/*! ./ndjson */ \"./node_modules/elastic-apm-js-core/src/common/ndjson.js\");\n\nvar xhrIgnore = __webpack_require__(/*! ./patching/patch-utils */ \"./node_modules/elastic-apm-js-core/src/common/patching/patch-utils.js\").XHR_IGNORE;\n\nclass ApmServer {\n  constructor(configService, loggingService) {\n    this._configService = configService;\n    this._loggingService = loggingService;\n    this.logMessages = {\n      invalidConfig: {\n        message: 'Configuration is invalid!',\n        level: 'warn'\n      }\n    };\n    this.errorQueue = undefined;\n    this.transactionQueue = undefined;\n    this.throttleAddError = undefined;\n    this.throttleAddTransaction = undefined;\n    this.initialized = false;\n    this.ndjsonSpan = {};\n  }\n\n  init() {\n    if (this.initialized) {\n      return;\n    }\n\n    this.initialized = true;\n    this.initErrorQueue();\n    this.initTransactionQueue();\n  }\n\n  createServiceObject() {\n    var cfg = this._configService;\n    var stringLimit = cfg.get('serverStringLimit');\n    var serviceObject = {\n      name: utils.sanitizeString(cfg.get('serviceName'), stringLimit, true),\n      version: utils.sanitizeString(cfg.get('serviceVersion'), stringLimit, false),\n      agent: {\n        name: cfg.get('agentName'),\n        version: cfg.get('agentVersion')\n      },\n      language: {\n        name: 'javascript'\n      }\n    };\n    return serviceObject;\n  }\n\n  _postJson(endPoint, payload) {\n    return this._makeHttpRequest('POST', endPoint, payload, {\n      'Content-Type': 'application/x-ndjson'\n    });\n  }\n\n  _makeHttpRequest(method, url, payload, headers) {\n    return new Promise(function (resolve, reject) {\n      var xhr = new window.XMLHttpRequest();\n      xhr[xhrIgnore] = true;\n      xhr.open(method, url, true);\n      xhr.timeout = 10000;\n\n      if (headers) {\n        for (var header in headers) {\n          if (headers.hasOwnProperty(header)) {\n            xhr.setRequestHeader(header, headers[header]);\n          }\n        }\n      }\n\n      xhr.onreadystatechange = function () {\n        if (xhr.readyState === 4) {\n          var status = xhr.status;\n\n          if (status === 0 || status > 399 && status < 600) {\n            // An http 4xx or 5xx error. Signal an error.\n            var err = new Error(url + ' HTTP status: ' + status);\n            err.xhr = xhr;\n            reject(err);\n          } else {\n            resolve(xhr.responseText);\n          }\n        }\n      };\n\n      xhr.onerror = function (err) {\n        reject(err);\n      };\n\n      xhr.send(payload);\n    });\n  }\n\n  _createQueue(onFlush) {\n    var queueLimit = this._configService.get('queueLimit');\n\n    var flushInterval = this._configService.get('flushInterval');\n\n    return new Queue(onFlush, {\n      queueLimit: queueLimit,\n      flushInterval: flushInterval\n    });\n  }\n\n  initErrorQueue() {\n    var apmServer = this;\n\n    if (this.errorQueue) {\n      this.errorQueue.flush();\n    }\n\n    this.errorQueue = this._createQueue(function (errors) {\n      var p = apmServer.sendErrors(errors);\n\n      if (p) {\n        p.then(undefined, function (reason) {\n          apmServer._loggingService.warn('Failed sending errors!', reason);\n        });\n      }\n    });\n\n    var limit = apmServer._configService.get('errorThrottleLimit');\n\n    var interval = apmServer._configService.get('errorThrottleInterval');\n\n    this.throttleAddError = throttle(this.errorQueue.add.bind(this.errorQueue), function () {\n      apmServer._loggingService.warn('Dropped error due to throttling!');\n    }, {\n      limit: limit,\n      interval: interval\n    });\n  }\n\n  initTransactionQueue() {\n    var apmServer = this;\n\n    if (this.transactionQueue) {\n      this.transactionQueue.flush();\n    }\n\n    this.transactionQueue = this._createQueue(function (transactions) {\n      var p = apmServer.sendTransactions(transactions);\n\n      if (p) {\n        p.then(undefined, function (reason) {\n          apmServer._loggingService.warn('Failed sending transactions!', reason);\n        });\n      }\n    });\n\n    var limit = apmServer._configService.get('transactionThrottleLimit');\n\n    var interval = apmServer._configService.get('transactionThrottleInterval');\n\n    this.throttleAddTransaction = throttle(this.transactionQueue.add.bind(this.transactionQueue), function () {\n      apmServer._loggingService.warn('Dropped transaction due to throttling!');\n    }, {\n      limit: limit,\n      interval: interval\n    });\n  }\n\n  addError(error) {\n    if (this._configService.isActive()) {\n      if (!this.errorQueue) {\n        this.initErrorQueue();\n      }\n\n      this.throttleAddError(error);\n    }\n  }\n\n  addTransaction(transaction) {\n    if (this._configService.isActive()) {\n      if (!this.transactionQueue) {\n        this.initTransactionQueue();\n      }\n\n      this.throttleAddTransaction(transaction);\n    }\n  }\n\n  warnOnce(logObject) {\n    if (logObject.level === 'warn') {\n      logObject.level = 'debug';\n\n      this._loggingService.warn(logObject.message);\n    } else {\n      this._loggingService.debug(logObject.message);\n    }\n  }\n\n  ndjsonErrors(errors) {\n    return errors.map(function (error) {\n      return NDJSON.stringify({\n        error: error\n      });\n    });\n  }\n\n  sendErrors(errors) {\n    if (this._configService.isValid() && this._configService.isActive()) {\n      if (errors && errors.length > 0) {\n        var payload = {\n          service: this.createServiceObject(),\n          errors: errors\n        };\n        payload = this._configService.applyFilters(payload);\n\n        if (payload) {\n          var endPoint = this._configService.getEndpointUrl('errors');\n\n          var ndjson = this.ndjsonErrors(payload.errors);\n          ndjson.unshift(NDJSON.stringify({\n            metadata: {\n              service: payload.service\n            }\n          }));\n          var ndjsonPayload = ndjson.join('');\n          return this._postJson(endPoint, ndjsonPayload);\n        } else {\n          this._loggingService.warn('Dropped payload due to filtering!');\n        }\n      }\n    } else {\n      this.warnOnce(this.logMessages.invalidConfig);\n    }\n  }\n\n  ndjsonTransactions(transactions) {\n    var ndjsonSpan = this.ndjsonSpan;\n    return transactions.map(function (tr) {\n      var spans = '';\n\n      if (tr.spans) {\n        spans = tr.spans.map(function (sp) {\n          ndjsonSpan.span = sp;\n          return NDJSON.stringify(ndjsonSpan);\n        }).join('');\n        delete tr.spans;\n      }\n\n      return NDJSON.stringify({\n        transaction: tr\n      }) + spans;\n    });\n  }\n\n  sendTransactions(transactions) {\n    if (this._configService.isValid() && this._configService.isActive()) {\n      if (transactions && transactions.length > 0) {\n        var payload = {\n          service: this.createServiceObject(),\n          transactions: transactions\n        };\n        payload = this._configService.applyFilters(payload);\n\n        if (payload) {\n          var endPoint = this._configService.getEndpointUrl('transactions');\n\n          var ndjson = this.ndjsonTransactions(payload.transactions);\n          ndjson.unshift(NDJSON.stringify({\n            metadata: {\n              service: payload.service\n            }\n          }));\n          var ndjsonPayload = ndjson.join('');\n          return this._postJson(endPoint, ndjsonPayload);\n        } else {\n          this._loggingService.warn('Dropped payload due to filtering!');\n        }\n      }\n    } else {\n      this.warnOnce(this.logMessages.invalidConfig);\n    }\n  }\n\n}\n\nmodule.exports = ApmServer;\n\n/***/ }),\n\n/***/ \"./node_modules/elastic-apm-js-core/src/common/config-service.js\":\n/*!***********************************************************************!*\\\n  !*** ./node_modules/elastic-apm-js-core/src/common/config-service.js ***!\n  \\***********************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n/**\n * MIT License\n *\n * Copyright (c) 2017-present, Elasticsearch BV\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n *\n */\nconst {\n  getCurrentScript,\n  sanitizeString,\n  setTag,\n  merge\n} = __webpack_require__(/*! ./utils */ \"./node_modules/elastic-apm-js-core/src/common/utils.js\");\n\nconst Subscription = __webpack_require__(/*! ../common/subscription */ \"./node_modules/elastic-apm-js-core/src/common/subscription.js\");\n\nconst constants = __webpack_require__(/*! ./constants */ \"./node_modules/elastic-apm-js-core/src/common/constants.js\");\n\nfunction getConfigFromScript() {\n  var script = getCurrentScript();\n  var config = getDataAttributesFromNode(script);\n  return config;\n}\n\nfunction getDataAttributesFromNode(node) {\n  if (!node) {\n    return {};\n  }\n\n  var dataAttrs = {};\n  var dataRegex = /^data-([\\w-]+)$/;\n  var attrs = node.attributes;\n\n  for (var i = 0; i < attrs.length; i++) {\n    var attr = attrs[i];\n\n    if (dataRegex.test(attr.nodeName)) {\n      var key = attr.nodeName.match(dataRegex)[1]; // camelCase key\n\n      var camelCasedkey = key.split('-').map((value, index) => {\n        return index > 0 ? value.charAt(0).toUpperCase() + value.substring(1) : value;\n      }).join('');\n      dataAttrs[camelCasedkey] = attr.value || attr.nodeValue;\n    }\n  }\n\n  return dataAttrs;\n}\n\nclass Config {\n  constructor() {\n    this.config = {};\n    this.defaults = {\n      serviceName: '',\n      serviceVersion: '',\n      agentName: 'js-base',\n      agentVersion: '%%agent-version%%',\n      serverUrl: 'http://localhost:8200',\n      serverUrlPrefix: '/intake/v2/rum/events',\n      active: true,\n      debug: false,\n      logLevel: 'warn',\n      browserResponsivenessInterval: 500,\n      browserResponsivenessBuffer: 3,\n      checkBrowserResponsiveness: true,\n      groupSimilarSpans: true,\n      similarSpanThreshold: 0.05,\n      capturePageLoad: true,\n      ignoreTransactions: [],\n      // throttlingRequestLimit: 20,\n      // throttlingInterval: 30000, // 30s\n      errorThrottleLimit: 20,\n      errorThrottleInterval: 30000,\n      transactionThrottleLimit: 20,\n      transactionThrottleInterval: 30000,\n      transactionDurationThreshold: 60000,\n      queueLimit: -1,\n      flushInterval: 500,\n      sendPageLoadTransaction: true,\n      serverStringLimit: constants.serverStringLimit,\n      distributedTracing: true,\n      distributedTracingOrigins: [],\n      distributedTracingHeaderValueCallback: undefined,\n      distributedTracingHeaderName: 'elastic-apm-traceparent',\n      pageLoadTraceId: undefined,\n      pageLoadSpanId: undefined,\n      pageLoadSampled: undefined,\n      pageLoadTransactionName: undefined,\n      transactionSampleRate: 1.0,\n      context: {},\n      platform: {}\n    };\n    this._changeSubscription = new Subscription();\n    this.filters = [];\n  }\n\n  init() {\n    var scriptData = getConfigFromScript();\n    this.setConfig(scriptData);\n  }\n\n  isActive() {\n    return this.get('active');\n  }\n\n  addFilter(cb) {\n    if (typeof cb !== 'function') {\n      throw new Error('Argument to must be function');\n    }\n\n    this.filters.push(cb);\n  }\n\n  applyFilters(data) {\n    for (var i = 0; i < this.filters.length; i++) {\n      data = this.filters[i](data);\n\n      if (!data) {\n        return;\n      }\n    }\n\n    return data;\n  }\n\n  get(key) {\n    return key.split('.').reduce((obj, objKey) => {\n      return obj && obj[objKey];\n    }, this.config);\n  }\n\n  getEndpointUrl() {\n    var url = this.get('serverUrl') + this.get('serverUrlPrefix');\n    return url;\n  }\n\n  set(key, value) {\n    var levels = key.split('.');\n    var maxLevel = levels.length - 1;\n    var target = this.config;\n\n    for (let i = 0; i < maxLevel + 1; i++) {\n      const level = levels[i];\n\n      if (!level) {\n        continue;\n      }\n\n      if (i === maxLevel) {\n        target[level] = value;\n      } else {\n        var obj = target[level] || {};\n        target[level] = obj;\n        target = obj;\n      }\n    }\n  }\n\n  setUserContext(userContext) {\n    var context = {};\n\n    if (typeof userContext.id === 'number') {\n      context.id = userContext.id;\n    }\n\n    if (typeof userContext.id === 'string') {\n      context.id = sanitizeString(userContext.id, this.get('serverStringLimit'));\n    }\n\n    if (typeof userContext.username === 'string') {\n      context.username = sanitizeString(userContext.username, this.get('serverStringLimit'));\n    }\n\n    if (typeof userContext.email === 'string') {\n      context.email = sanitizeString(userContext.email, this.get('serverStringLimit'));\n    }\n\n    this.set('context.user', context);\n  }\n\n  setCustomContext(customContext) {\n    if (customContext && typeof customContext === 'object') {\n      this.set('context.custom', customContext);\n    }\n  }\n\n  setTag(key, value) {\n    if (!key) return;\n\n    if (!this.config.context.tags) {\n      this.config.context.tags = {};\n    }\n\n    setTag(key, value, this.config.context.tags);\n  }\n\n  addTags(tags) {\n    var keys = Object.keys(tags);\n    keys.forEach(k => {\n      this.setTag(k, tags[k]);\n    });\n  }\n\n  setConfig(properties) {\n    properties = properties || {};\n    this.config = merge({}, this.defaults, this.config, properties);\n\n    this._changeSubscription.applyAll(this, [this.config]);\n  }\n\n  subscribeToChange(fn) {\n    return this._changeSubscription.subscribe(fn);\n  }\n\n  isValid() {\n    const requiredKeys = ['serviceName', 'serverUrl'];\n\n    for (let i = 0; i < requiredKeys.length; i++) {\n      const key = requiredKeys[i];\n\n      if (this.config[key] == null || this.config[key] === '') {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n}\n\nmodule.exports = Config;\n\n/***/ }),\n\n/***/ \"./node_modules/elastic-apm-js-core/src/common/constants.js\":\n/*!******************************************************************!*\\\n  !*** ./node_modules/elastic-apm-js-core/src/common/constants.js ***!\n  \\******************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\n/**\n * MIT License\n *\n * Copyright (c) 2017-present, Elasticsearch BV\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n *\n */\n\n/**\n * Task States\n */\nconst SCHEDULE = 'schedule';\nconst INVOKE = 'invoke';\nconst CLEAR = 'clear';\n/**\n * Request Sources\n */\n\nconst FETCH_SOURCE = 'fetch';\nconst XMLHTTPREQUEST_SOURCE = 'XMLHttpRequest.send';\n/**\n * Event listener methods\n */\n\nconst ADD_EVENT_LISTENER_STR = 'addEventListener';\nconst REMOVE_EVENT_LISTENER_STR = 'removeEventListener';\n/**\n * Others\n */\n\nconst serverStringLimit = 1024;\nmodule.exports = {\n  SCHEDULE,\n  INVOKE,\n  CLEAR,\n  FETCH_SOURCE,\n  XMLHTTPREQUEST_SOURCE,\n  ADD_EVENT_LISTENER_STR,\n  REMOVE_EVENT_LISTENER_STR,\n  serverStringLimit\n};\n\n/***/ }),\n\n/***/ \"./node_modules/elastic-apm-js-core/src/common/logging-service.js\":\n/*!************************************************************************!*\\\n  !*** ./node_modules/elastic-apm-js-core/src/common/logging-service.js ***!\n  \\************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n/**\n * MIT License\n *\n * Copyright (c) 2017-present, Elasticsearch BV\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n *\n */\nconst {\n  noop\n} = __webpack_require__(/*! ./utils */ \"./node_modules/elastic-apm-js-core/src/common/utils.js\");\n\nclass LoggingService {\n  constructor(spec) {\n    if (!spec) spec = {};\n    this.levels = ['trace', 'debug', 'info', 'warn', 'error'];\n    this.level = spec.level || 'info';\n    this.prefix = spec.prefix || '';\n    this.resetLogMethods();\n  }\n\n  shouldLog(level) {\n    return this.levels.indexOf(level) >= this.levels.indexOf(this.level);\n  }\n\n  setLevel(level) {\n    this.level = level;\n    this.resetLogMethods();\n  }\n\n  resetLogMethods() {\n    var loggingService = this;\n    this.levels.forEach(function (level) {\n      loggingService[level] = loggingService.shouldLog(level) ? log : noop;\n\n      function log() {\n        var prefix = loggingService.prefix;\n        var normalizedLevel;\n\n        switch (level) {\n          case 'trace':\n            normalizedLevel = 'info';\n            break;\n\n          case 'debug':\n            normalizedLevel = 'info';\n            break;\n\n          default:\n            normalizedLevel = level;\n        }\n\n        var args = arguments;\n\n        if (prefix) {\n          if (typeof prefix === 'function') prefix = prefix(level);\n          args[0] = prefix + args[0];\n        }\n\n        if (console) {\n          var realMethod = console[normalizedLevel] ? console[normalizedLevel] : console.log;\n\n          if (typeof realMethod === 'function') {\n            realMethod.apply(console, args);\n          }\n        }\n      }\n    });\n  }\n\n}\n\nmodule.exports = LoggingService;\n\n/***/ }),\n\n/***/ \"./node_modules/elastic-apm-js-core/src/common/ndjson.js\":\n/*!***************************************************************!*\\\n  !*** ./node_modules/elastic-apm-js-core/src/common/ndjson.js ***!\n  \\***************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\n/**\n * MIT License\n *\n * Copyright (c) 2017-present, Elasticsearch BV\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n *\n */\nclass NDJSON {\n  static stringify(object) {\n    return JSON.stringify(object) + '\\n';\n  }\n\n}\n\nmodule.exports = NDJSON;\n\n/***/ }),\n\n/***/ \"./node_modules/elastic-apm-js-core/src/common/patching/fetch-patch.js\":\n/*!*****************************************************************************!*\\\n  !*** ./node_modules/elastic-apm-js-core/src/common/patching/fetch-patch.js ***!\n  \\*****************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n/**\n * MIT License\n *\n * Copyright (c) 2017-present, Elasticsearch BV\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n *\n */\nconst {\n  globalState\n} = __webpack_require__(/*! ./patch-utils */ \"./node_modules/elastic-apm-js-core/src/common/patching/patch-utils.js\");\n\nconst {\n  SCHEDULE,\n  INVOKE,\n  FETCH_SOURCE\n} = __webpack_require__(/*! ../constants */ \"./node_modules/elastic-apm-js-core/src/common/constants.js\");\n\nvar alreadyPatched = false;\n\nfunction patchFetch(callback) {\n  if (alreadyPatched) {\n    return;\n  }\n\n  alreadyPatched = true;\n\n  if (!window.fetch || !window.Request) {\n    return;\n  }\n\n  function scheduleTask(task) {\n    task.state = SCHEDULE;\n    callback(SCHEDULE, task);\n  }\n\n  function invokeTask(task) {\n    task.state = INVOKE;\n    callback(INVOKE, task);\n  }\n\n  var nativeFetch = window.fetch;\n\n  window.fetch = function (input, init) {\n    var fetchSelf = this;\n    var args = arguments;\n    var request, url;\n\n    if (typeof input === 'string') {\n      request = new Request(input, init);\n      url = input;\n    } else if (input) {\n      request = input;\n      url = request.url;\n    } else {\n      return nativeFetch.apply(fetchSelf, args);\n    }\n\n    const task = {\n      source: FETCH_SOURCE,\n      state: '',\n      type: 'macroTask',\n      data: {\n        target: request,\n        method: request.method,\n        sync: false,\n        url: url,\n        args: arguments,\n        aborted: false\n      }\n    };\n    return new Promise(function (resolve, reject) {\n      globalState.fetchInProgress = true;\n      scheduleTask(task);\n      var promise;\n\n      try {\n        promise = nativeFetch.apply(fetchSelf, [request]);\n      } catch (error) {\n        reject(error);\n        task.data.error = error;\n        invokeTask(task);\n        globalState.fetchInProgress = false;\n        return;\n      }\n\n      promise.then(function (response) {\n        resolve(response);\n        task.data.response = response;\n        invokeTask(task);\n      }, function (error) {\n        reject(error);\n        task.data.error = error;\n        invokeTask(task);\n      });\n      globalState.fetchInProgress = false;\n    });\n  };\n}\n\nmodule.exports = {\n  patchFetch: patchFetch\n};\n\n/***/ }),\n\n/***/ \"./node_modules/elastic-apm-js-core/src/common/patching/index.js\":\n/*!***********************************************************************!*\\\n  !*** ./node_modules/elastic-apm-js-core/src/common/patching/index.js ***!\n  \\***********************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n/**\n * MIT License\n *\n * Copyright (c) 2017-present, Elasticsearch BV\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n *\n */\nvar patchXMLHttpRequest = __webpack_require__(/*! ./xhr-patch */ \"./node_modules/elastic-apm-js-core/src/common/patching/xhr-patch.js\").patchXMLHttpRequest;\n\nvar patchFetch = __webpack_require__(/*! ./fetch-patch */ \"./node_modules/elastic-apm-js-core/src/common/patching/fetch-patch.js\").patchFetch;\n\nvar Subscription = __webpack_require__(/*! ../subscription */ \"./node_modules/elastic-apm-js-core/src/common/subscription.js\");\n\nvar subscription = new Subscription();\nvar alreadyPatched = false;\n\nfunction patchAll() {\n  if (!alreadyPatched) {\n    alreadyPatched = true;\n    patchXMLHttpRequest(function (event, task) {\n      subscription.applyAll(this, [event, task]);\n    });\n    patchFetch(function (event, task) {\n      subscription.applyAll(this, [event, task]);\n    });\n  }\n\n  return subscription;\n}\n\nmodule.exports = {\n  patchAll,\n  subscription\n};\n\n/***/ }),\n\n/***/ \"./node_modules/elastic-apm-js-core/src/common/patching/patch-utils.js\":\n/*!*****************************************************************************!*\\\n  !*** ./node_modules/elastic-apm-js-core/src/common/patching/patch-utils.js ***!\n  \\*****************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\n/**\n * MIT License\n *\n * Copyright (c) 2017-present, Elasticsearch BV\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n *\n */\nvar globalState = {\n  fetchInProgress: false\n};\n\nfunction apmSymbol(name) {\n  return '__apm_symbol__' + name;\n}\n\nfunction isPropertyWritable(propertyDesc) {\n  if (!propertyDesc) {\n    return true;\n  }\n\n  if (propertyDesc.writable === false) {\n    return false;\n  }\n\n  return !(typeof propertyDesc.get === 'function' && typeof propertyDesc.set === 'undefined');\n}\n\nfunction attachOriginToPatched(patched, original) {\n  patched[apmSymbol('OriginalDelegate')] = original;\n}\n\nfunction patchMethod(target, name, patchFn) {\n  var proto = target;\n\n  while (proto && !proto.hasOwnProperty(name)) {\n    proto = Object.getPrototypeOf(proto);\n  }\n\n  if (!proto && target[name]) {\n    // somehow we did not find it, but we can see it. This happens on IE for Window properties.\n    proto = target;\n  }\n\n  const delegateName = apmSymbol(name);\n  var delegate;\n\n  if (proto && !(delegate = proto[delegateName])) {\n    delegate = proto[delegateName] = proto[name]; // check whether proto[name] is writable\n    // some property is readonly in safari, such as HtmlCanvasElement.prototype.toBlob\n\n    const desc = proto && Object.getOwnPropertyDescriptor(proto, name);\n\n    if (isPropertyWritable(desc)) {\n      const patchDelegate = patchFn(delegate, delegateName, name);\n\n      proto[name] = function () {\n        return patchDelegate(this, arguments);\n      };\n\n      attachOriginToPatched(proto[name], delegate);\n    }\n  }\n\n  return delegate;\n}\n\nmodule.exports = {\n  apmSymbol,\n  patchMethod,\n  globalState,\n  XHR_IGNORE: apmSymbol('xhrIgnore'),\n  XHR_SYNC: apmSymbol('xhrSync'),\n  XHR_URL: apmSymbol('xhrURL'),\n  XHR_METHOD: apmSymbol('xhrMethod')\n};\n\n/***/ }),\n\n/***/ \"./node_modules/elastic-apm-js-core/src/common/patching/xhr-patch.js\":\n/*!***************************************************************************!*\\\n  !*** ./node_modules/elastic-apm-js-core/src/common/patching/xhr-patch.js ***!\n  \\***************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n/**\n * MIT License\n *\n * Copyright (c) 2017-present, Elasticsearch BV\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n *\n */\nconst {\n  apmSymbol,\n  patchMethod,\n  XHR_SYNC,\n  XHR_URL,\n  XHR_METHOD,\n  XHR_IGNORE\n} = __webpack_require__(/*! ./patch-utils */ \"./node_modules/elastic-apm-js-core/src/common/patching/patch-utils.js\");\n\nconst {\n  SCHEDULE,\n  INVOKE,\n  CLEAR,\n  XMLHTTPREQUEST_SOURCE,\n  ADD_EVENT_LISTENER_STR,\n  REMOVE_EVENT_LISTENER_STR\n} = __webpack_require__(/*! ../constants */ \"./node_modules/elastic-apm-js-core/src/common/constants.js\");\n\nconst XHR_TASK = apmSymbol('xhrTask');\nconst XHR_LISTENER = apmSymbol('xhrListener');\nconst XHR_SCHEDULED = apmSymbol('xhrScheduled');\nvar alreadyPatched = false;\n\nfunction patchXMLHttpRequest(callback) {\n  if (alreadyPatched) {\n    return;\n  }\n\n  alreadyPatched = true;\n  const XMLHttpRequestPrototype = XMLHttpRequest.prototype;\n  let oriAddListener = XMLHttpRequestPrototype[ADD_EVENT_LISTENER_STR];\n  let oriRemoveListener = XMLHttpRequestPrototype[REMOVE_EVENT_LISTENER_STR];\n\n  if (!oriAddListener) {\n    const XMLHttpRequestEventTarget = window['XMLHttpRequestEventTarget'];\n\n    if (XMLHttpRequestEventTarget) {\n      const XMLHttpRequestEventTargetPrototype = XMLHttpRequestEventTarget.prototype;\n      oriAddListener = XMLHttpRequestEventTargetPrototype[ADD_EVENT_LISTENER_STR];\n      oriRemoveListener = XMLHttpRequestEventTargetPrototype[REMOVE_EVENT_LISTENER_STR];\n    }\n  }\n\n  const READY_STATE_CHANGE = 'readystatechange';\n\n  function invokeTask(task) {\n    task.state = INVOKE;\n\n    if (!task.ignore) {\n      callback(INVOKE, task);\n    }\n  }\n\n  function scheduleTask(task) {\n    XMLHttpRequest[XHR_SCHEDULED] = false;\n    task.state = SCHEDULE;\n\n    if (!task.ignore) {\n      callback(SCHEDULE, task);\n    }\n\n    const data = task.data;\n    const target = data.target; // remove existing event listener\n\n    const listener = target[XHR_LISTENER];\n\n    if (!oriAddListener) {\n      oriAddListener = target[ADD_EVENT_LISTENER_STR];\n      oriRemoveListener = target[REMOVE_EVENT_LISTENER_STR];\n    }\n\n    if (listener) {\n      oriRemoveListener.call(target, READY_STATE_CHANGE, listener);\n    }\n\n    const newListener = target[XHR_LISTENER] = () => {\n      if (target.readyState === target.DONE) {\n        // sometimes on some browsers XMLHttpRequest will fire onreadystatechange with\n        // readyState=4 multiple times, so we need to check task state here\n        if (!data.aborted && XMLHttpRequest[XHR_SCHEDULED] && task.state === SCHEDULE) {\n          invokeTask(task);\n        }\n      }\n    };\n\n    oriAddListener.call(target, READY_STATE_CHANGE, newListener);\n    const storedTask = target[XHR_TASK];\n\n    if (!storedTask) {\n      target[XHR_TASK] = task;\n    }\n\n    var result = sendNative.apply(target, data.args);\n    XMLHttpRequest[XHR_SCHEDULED] = true;\n    return result;\n  }\n\n  function clearTask(task) {\n    task.state = CLEAR;\n    callback(CLEAR, task);\n    const data = task.data; // Note - ideally, we would call data.target.removeEventListener here, but it's too late\n    // to prevent it from firing. So instead, we store info for the event listener.\n\n    data.aborted = true;\n  }\n\n  const openNative = patchMethod(XMLHttpRequestPrototype, 'open', () => function (self, args) {\n    self[XHR_METHOD] = args[0];\n    self[XHR_URL] = args[1];\n    self[XHR_SYNC] = args[2] === false;\n    return openNative.apply(self, args);\n  });\n  const sendNative = patchMethod(XMLHttpRequestPrototype, 'send', () => function (self, args) {\n    const task = {\n      source: XMLHTTPREQUEST_SOURCE,\n      state: '',\n      type: 'macroTask',\n      ignore: self[XHR_IGNORE],\n      data: {\n        target: self,\n        method: self[XHR_METHOD],\n        sync: self[XHR_SYNC],\n        url: self[XHR_URL],\n        args: args,\n        aborted: false\n      }\n    };\n    var result = scheduleTask(task);\n\n    if (self[XHR_SYNC]) {\n      invokeTask(task);\n    }\n\n    return result;\n  });\n  const abortNative = patchMethod(XMLHttpRequestPrototype, 'abort', () => function (self, args) {\n    const task = self[XHR_TASK];\n\n    if (task && typeof task.type === 'string') {\n      // If the XHR has already been aborted, do nothing.\n      if (task.data && task.data.aborted) {\n        return;\n      }\n\n      clearTask(task);\n    }\n\n    return abortNative.apply(self, args);\n  });\n}\n\nmodule.exports = {\n  patchXMLHttpRequest: patchXMLHttpRequest\n};\n\n/***/ }),\n\n/***/ \"./node_modules/elastic-apm-js-core/src/common/queue.js\":\n/*!**************************************************************!*\\\n  !*** ./node_modules/elastic-apm-js-core/src/common/queue.js ***!\n  \\**************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\n/**\n * MIT License\n *\n * Copyright (c) 2017-present, Elasticsearch BV\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n *\n */\nclass Queue {\n  constructor(onFlush, opts) {\n    if (!opts) opts = {};\n    this.onFlush = onFlush;\n    this.items = [];\n    this.queueLimit = opts.queueLimit || -1;\n    this.flushInterval = opts.flushInterval || 0;\n    this.timeoutId = undefined;\n  }\n\n  _setTimer() {\n    this.timeoutId = setTimeout(() => {\n      this.flush();\n    }, this.flushInterval);\n  }\n\n  flush() {\n    this.onFlush(this.items);\n\n    this._clear();\n  }\n\n  _clear() {\n    if (typeof this.timeoutId !== 'undefined') {\n      clearTimeout(this.timeoutId);\n      this.timeoutId = undefined;\n    }\n\n    this.items = [];\n  }\n\n  add(item) {\n    this.items.push(item);\n\n    if (this.queueLimit !== -1 && this.items.length >= this.queueLimit) {\n      this.flush();\n    } else {\n      if (typeof this.timeoutId === 'undefined') {\n        this._setTimer();\n      }\n    }\n  }\n\n}\n\nmodule.exports = Queue;\n\n/***/ }),\n\n/***/ \"./node_modules/elastic-apm-js-core/src/common/service-factory.js\":\n/*!************************************************************************!*\\\n  !*** ./node_modules/elastic-apm-js-core/src/common/service-factory.js ***!\n  \\************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n/**\n * MIT License\n *\n * Copyright (c) 2017-present, Elasticsearch BV\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n *\n */\nconst ApmServer = __webpack_require__(/*! ./apm-server */ \"./node_modules/elastic-apm-js-core/src/common/apm-server.js\");\n\nconst ConfigService = __webpack_require__(/*! ./config-service */ \"./node_modules/elastic-apm-js-core/src/common/config-service.js\");\n\nconst LoggingService = __webpack_require__(/*! ./logging-service */ \"./node_modules/elastic-apm-js-core/src/common/logging-service.js\");\n\nconst patchUtils = __webpack_require__(/*! ./patching/patch-utils */ \"./node_modules/elastic-apm-js-core/src/common/patching/patch-utils.js\");\n\nconst utils = __webpack_require__(/*! ./utils */ \"./node_modules/elastic-apm-js-core/src/common/utils.js\");\n\nclass ServiceFactory {\n  constructor() {\n    this._serviceCreators = {};\n    this._serviceInstances = {};\n    this.initialized = false;\n  }\n\n  registerCoreServices() {\n    var serviceFactory = this;\n    this.registerServiceCreator('ConfigService', function () {\n      return new ConfigService();\n    });\n    this.registerServiceCreator('LoggingService', function () {\n      return new LoggingService();\n    });\n    this.registerServiceCreator('ApmServer', function () {\n      return new ApmServer(serviceFactory.getService('ConfigService'), serviceFactory.getService('LoggingService'));\n    });\n    this.registerServiceInstance('PatchUtils', patchUtils);\n    this.registerServiceInstance('Utils', utils);\n  }\n\n  init() {\n    if (this.initialized) {\n      return;\n    }\n\n    this.initialized = true;\n    var serviceFactory = this;\n    var configService = serviceFactory.getService('ConfigService');\n    configService.init();\n    var loggingService = serviceFactory.getService('LoggingService');\n\n    function setLogLevel(loggingService, configService) {\n      if (configService.get('debug') === true && configService.config.logLevel !== 'trace') {\n        loggingService.setLevel('debug', false);\n      } else {\n        loggingService.setLevel(configService.get('logLevel'), false);\n      }\n    }\n\n    setLogLevel(loggingService, configService);\n    configService.subscribeToChange(function () {\n      setLogLevel(loggingService, configService);\n    });\n    var apmServer = serviceFactory.getService('ApmServer');\n    apmServer.init();\n  }\n\n  registerServiceCreator(name, creator) {\n    this._serviceCreators[name] = creator;\n  }\n\n  registerServiceInstance(name, instance) {\n    this._serviceInstances[name] = instance;\n  }\n\n  getService(name) {\n    if (!this._serviceInstances[name]) {\n      if (typeof this._serviceCreators[name] === 'function') {\n        this._serviceInstances[name] = this._serviceCreators[name](this);\n      } else {\n        throw new Error('Can not get service, No creator for: ' + name);\n      }\n    }\n\n    return this._serviceInstances[name];\n  }\n\n}\n\nmodule.exports = ServiceFactory;\n\n/***/ }),\n\n/***/ \"./node_modules/elastic-apm-js-core/src/common/subscription.js\":\n/*!*********************************************************************!*\\\n  !*** ./node_modules/elastic-apm-js-core/src/common/subscription.js ***!\n  \\*********************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\n/**\n * MIT License\n *\n * Copyright (c) 2017-present, Elasticsearch BV\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n *\n */\nclass Subscription {\n  constructor() {\n    this.subscriptions = [];\n  }\n\n  subscribe(fn) {\n    this.subscriptions.push(fn);\n    return () => {\n      var index = this.subscriptions.indexOf(fn);\n\n      if (index > -1) {\n        this.subscriptions.splice(index, 1);\n      }\n    };\n  }\n\n  applyAll(applyTo, applyWith) {\n    this.subscriptions.forEach(fn => {\n      try {\n        fn.apply(applyTo, applyWith);\n      } catch (error) {\n        console.log(error, error.stack);\n      }\n    }, this);\n  }\n\n}\n\nmodule.exports = Subscription;\n\n/***/ }),\n\n/***/ \"./node_modules/elastic-apm-js-core/src/common/throttle.js\":\n/*!*****************************************************************!*\\\n  !*** ./node_modules/elastic-apm-js-core/src/common/throttle.js ***!\n  \\*****************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\n/**\n * MIT License\n *\n * Copyright (c) 2017-present, Elasticsearch BV\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n *\n */\nfunction throttle(fn, onThrottle, opts) {\n  var context = opts.context || this;\n  var limit = opts.limit;\n  var interval = opts.interval;\n\n  var countFn = opts.countFn || function () {};\n\n  var counter = 0;\n  var timeoutId;\n  return function () {\n    var count = typeof countFn === 'function' && countFn.apply(context, arguments);\n\n    if (typeof count !== 'number') {\n      count = 1;\n    }\n\n    counter = counter + count;\n\n    if (typeof timeoutId === 'undefined') {\n      timeoutId = setTimeout(function () {\n        counter = 0;\n        timeoutId = undefined;\n      }, interval);\n    }\n\n    if (counter > limit) {\n      if (typeof onThrottle === 'function') {\n        return onThrottle.apply(context, arguments);\n      }\n    } else {\n      return fn.apply(context, arguments);\n    }\n  };\n}\n\nmodule.exports = throttle;\n\n/***/ }),\n\n/***/ \"./node_modules/elastic-apm-js-core/src/common/url.js\":\n/*!************************************************************!*\\\n  !*** ./node_modules/elastic-apm-js-core/src/common/url.js ***!\n  \\************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\n/**\n * MIT License\n *\n * Copyright (c) 2017-present, Elasticsearch BV\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n *\n */\n\n/**\n * Bare miniaml URL parser that is not compatible with URL Api\n * in the browser\n *\n * Does not support\n * - URLSearchParams\n * - Unicode chars, Punycode\n *\n * {\n *    hash: '',\n *    host: '',\n *    origin: '',\n *    path: ''\n *    protocol: '',\n *    query: '',\n * }\n *\n * Based on code from url-parser!\n * https://github.com/unshiftio/url-parse/blob/master/index.js\n *\n */\nconst RULES = [['#', 'hash'], ['?', 'query'], ['/', 'path'], [NaN, 'host', 1] //\n];\nconst PROTOCOL_REGEX = /^([a-z][a-z0-9.+-]*:)?(\\/\\/)?([\\S\\s]*)/i;\n\nclass Url {\n  constructor(url) {\n    let {\n      protocol,\n      address,\n      slashes\n    } = this.extractProtocol(url || '');\n    const relative = !protocol && !slashes;\n    const location = this.getLocation();\n    const instructions = RULES.slice(); // Sanitize what is left of the address\n\n    address = address.replace('\\\\', '/');\n    let index;\n\n    for (let i = 0; i < instructions.length; i++) {\n      const instruction = instructions[i];\n      const parse = instruction[0];\n      const key = instruction[1];\n\n      if (typeof parse === 'string') {\n        index = address.indexOf(parse);\n\n        if (~index) {\n          this[key] = address.slice(index);\n          address = address.slice(0, index);\n        }\n      } else {\n        /** NaN condition */\n        this[key] = address;\n      }\n      /**\n       * Default values for all keys from location if url is relative\n       */\n\n\n      this[key] = this[key] || (relative && instruction[2] ? location[key] || '' : '');\n      /**\n       * host should be lowercased so they can be used to\n       * create a proper `origin`.\n       */\n\n      if (instruction[2]) this[key] = this[key].toLowerCase();\n    }\n\n    this.protocol = protocol || location.protocol || '';\n    this.origin = this.protocol && this.host && this.protocol !== 'file:' ? this.protocol + '//' + this.host : 'null';\n  }\n\n  getLocation() {\n    var globalVar = {};\n\n    if (typeof window !== 'undefined') {\n      globalVar = window;\n    }\n\n    return globalVar.location;\n  }\n\n  extractProtocol(url) {\n    const match = PROTOCOL_REGEX.exec(url);\n    return {\n      protocol: match[1] ? match[1].toLowerCase() : '',\n      slashes: !!match[2],\n      address: match[3]\n    };\n  }\n\n}\n\nmodule.exports = Url;\n\n/***/ }),\n\n/***/ \"./node_modules/elastic-apm-js-core/src/common/utils.js\":\n/*!**************************************************************!*\\\n  !*** ./node_modules/elastic-apm-js-core/src/common/utils.js ***!\n  \\**************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n/**\n * MIT License\n *\n * Copyright (c) 2017-present, Elasticsearch BV\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n *\n */\nconst constants = __webpack_require__(/*! ./constants */ \"./node_modules/elastic-apm-js-core/src/common/constants.js\");\n\nconst slice = [].slice;\n\nconst Url = __webpack_require__(/*! ../common/url */ \"./node_modules/elastic-apm-js-core/src/common/url.js\");\n\nconst rng = __webpack_require__(/*! uuid/lib/rng-browser */ \"./node_modules/uuid/lib/rng-browser.js\");\n\nfunction isCORSSupported() {\n  var xhr = new window.XMLHttpRequest();\n  return 'withCredentials' in xhr;\n}\n\nvar byteToHex = [];\n\nfor (var i = 0; i < 256; ++i) {\n  byteToHex[i] = (i + 0x100).toString(16).substr(1);\n}\n\nfunction bytesToHex(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex; // join used to fix memory issue caused by concatenation: https://bugs.chromium.org/p/v8/issues/detail?id=3175#c4\n\n  return [bth[buf[i++]], bth[buf[i++]], bth[buf[i++]], bth[buf[i++]], bth[buf[i++]], bth[buf[i++]], bth[buf[i++]], bth[buf[i++]], bth[buf[i++]], bth[buf[i++]], bth[buf[i++]], bth[buf[i++]], bth[buf[i++]], bth[buf[i++]], bth[buf[i++]], bth[buf[i++]]].join('');\n}\n\nfunction getDtHeaderValue(span) {\n  const dtVersion = '00';\n  const dtUnSampledFlags = '00'; // 00000001 ->  '01' -> recorded\n\n  const dtSampledFlags = '01';\n\n  if (span && span.traceId && span.id && span.parentId) {\n    var flags = span.sampled ? dtSampledFlags : dtUnSampledFlags;\n    /**\n     * In the case of unsampled traces, propagate transaction id (parentId)\n     * instead of span id to the downstream\n     */\n\n    var id = span.sampled ? span.id : span.parentId;\n    return dtVersion + '-' + span.traceId + '-' + id + '-' + flags;\n  }\n}\n\nfunction parseDtHeaderValue(value) {\n  var parsed = /^([\\da-f]{2})-([\\da-f]{32})-([\\da-f]{16})-([\\da-f]{2})$/.exec(value);\n\n  if (parsed) {\n    var flags = parsed[4];\n    var sampled = flags !== '00';\n    return {\n      traceId: parsed[2],\n      id: parsed[3],\n      sampled\n    };\n  }\n}\n\nfunction isDtHeaderValid(header) {\n  return /^[\\da-f]{2}-[\\da-f]{32}-[\\da-f]{16}-[\\da-f]{2}$/.test(header) && header.slice(3, 35) !== '00000000000000000000000000000000' && header.slice(36, 52) !== '0000000000000000';\n}\n\nfunction checkSameOrigin(source, target) {\n  let isSame = false;\n\n  if (typeof target === 'string') {\n    const src = new Url(source);\n    const tar = new Url(target);\n    isSame = src.origin === tar.origin;\n  } else if (Array.isArray(target)) {\n    target.forEach(function (t) {\n      if (!isSame) {\n        isSame = checkSameOrigin(source, t);\n      }\n    });\n  }\n\n  return isSame;\n}\n\nfunction generateRandomId(length) {\n  var id = bytesToHex(rng());\n  return id.substr(0, length);\n}\n\nfunction isPlatformSupported() {\n  return typeof window !== 'undefined' && typeof Array.prototype.forEach === 'function' && typeof JSON.stringify === 'function' && typeof Function.bind === 'function' && window.performance && typeof window.performance.now === 'function' && isCORSSupported();\n}\n\nfunction sanitizeString(value, limit, required, placeholder) {\n  if (typeof value === 'number') {\n    value = String(value);\n  }\n\n  if (required && !value) {\n    value = placeholder || 'NA';\n  }\n\n  if (value) {\n    return String(value).substr(0, limit);\n  } else {\n    return value;\n  }\n}\n\nfunction setTag(key, value, obj) {\n  if (!obj || !key) return;\n  var skey = removeInvalidChars(key);\n  obj[skey] = sanitizeString(value, constants.serverStringLimit);\n  return obj;\n}\n\nfunction sanitizeObjectStrings(obj, limit, required, placeholder) {\n  if (!obj) return obj;\n\n  if (typeof obj === 'string') {\n    return sanitizeString(obj, limit, required, placeholder);\n  }\n\n  var keys = Object.keys(obj);\n  keys.forEach(function (k) {\n    var value = obj[k];\n\n    if (typeof value === 'string') {\n      value = sanitizeString(obj[k], limit, required, placeholder);\n    } else if (typeof value === 'object') {\n      value = sanitizeObjectStrings(value, limit, required, placeholder);\n    }\n\n    obj[k] = value;\n  });\n  return obj;\n}\n\nconst navigationTimingKeys = ['fetchStart', 'domainLookupStart', 'domainLookupEnd', 'connectStart', 'connectEnd', 'secureConnectionStart', 'requestStart', 'responseStart', 'responseEnd', 'domLoading', 'domInteractive', 'domContentLoadedEventStart', 'domContentLoadedEventEnd', 'domComplete', 'loadEventStart', 'loadEventEnd'];\n\nfunction getNavigationTimingMarks() {\n  var timing = window.performance.timing;\n  var fetchStart = timing.fetchStart;\n  var marks = {};\n  navigationTimingKeys.forEach(function (timingKey) {\n    var m = timing[timingKey];\n\n    if (m && m >= fetchStart) {\n      marks[timingKey] = m - fetchStart;\n    }\n  });\n  return marks;\n}\n/**\n * Paint Timing Metrics that is available during page load\n * https://www.w3.org/TR/paint-timing/\n */\n\n\nfunction getPaintTimingMarks() {\n  var paints = {};\n  var perf = window.performance;\n\n  if (perf.getEntriesByType) {\n    var entries = perf.getEntriesByType('paint');\n\n    if (entries.length > 0) {\n      var timings = perf.timing;\n      /**\n       * To avoid capturing the unload event handler effect in paint timings\n       */\n\n      var unloadDiff = timings.fetchStart - timings.navigationStart;\n\n      for (var i = 0; i < entries.length; i++) {\n        var data = entries[i];\n        var calcPaintTime = unloadDiff >= 0 ? data.startTime - unloadDiff : data.startTime;\n        paints[data.name] = calcPaintTime;\n      }\n    }\n  }\n\n  return paints;\n}\n\nfunction getTimeOrigin() {\n  return window.performance.timing.fetchStart;\n}\n\nfunction getPageMetadata() {\n  return {\n    page: {\n      referer: document.referrer,\n      url: window.location.href\n    }\n  };\n}\n\nfunction stripQueryStringFromUrl(url) {\n  return url && url.split('?')[0];\n}\n\nfunction isObject(value) {\n  // http://jsperf.com/isobject4\n  return value !== null && typeof value === 'object';\n}\n\nfunction isFunction(value) {\n  return typeof value === 'function';\n}\n\nfunction baseExtend(dst, objs, deep) {\n  for (var i = 0, ii = objs.length; i < ii; ++i) {\n    var obj = objs[i];\n    if (!isObject(obj) && !isFunction(obj)) continue;\n    var keys = Object.keys(obj);\n\n    for (var j = 0, jj = keys.length; j < jj; j++) {\n      var key = keys[j];\n      var src = obj[key];\n\n      if (deep && isObject(src)) {\n        if (!isObject(dst[key])) dst[key] = Array.isArray(src) ? [] : {};\n        baseExtend(dst[key], [src], false); // only one level of deep merge\n      } else {\n        dst[key] = src;\n      }\n    }\n  }\n\n  return dst;\n}\n\nfunction getElasticScript() {\n  if (typeof document !== 'undefined') {\n    var scripts = document.getElementsByTagName('script');\n\n    for (var i = 0, l = scripts.length; i < l; i++) {\n      var sc = scripts[i];\n\n      if (sc.src.indexOf('elastic') > 0) {\n        return sc;\n      }\n    }\n  }\n}\n\nfunction getCurrentScript() {\n  if (typeof document !== 'undefined') {\n    // Source http://www.2ality.com/2014/05/current-script.html\n    var currentScript = document.currentScript;\n\n    if (!currentScript) {\n      return getElasticScript();\n    }\n\n    return currentScript;\n  }\n}\n\nfunction extend(dst) {\n  return baseExtend(dst, slice.call(arguments, 1), false);\n}\n\nfunction merge(dst) {\n  return baseExtend(dst, slice.call(arguments, 1), true);\n}\n\nfunction isUndefined(obj) {\n  return typeof obj === 'undefined';\n}\n\nfunction noop() {}\n\nfunction find(array, predicate, thisArg) {\n  // Source: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/find\n  if (array == null) {\n    throw new TypeError('array is null or not defined');\n  }\n\n  var o = Object(array);\n  var len = o.length >>> 0;\n\n  if (typeof predicate !== 'function') {\n    throw new TypeError('predicate must be a function');\n  }\n\n  var k = 0;\n\n  while (k < len) {\n    var kValue = o[k];\n\n    if (predicate.call(thisArg, kValue, k, o)) {\n      return kValue;\n    }\n\n    k++;\n  }\n\n  return undefined;\n}\n\nfunction removeInvalidChars(key) {\n  return key.replace(/[.*\"]/g, '_');\n}\n\nmodule.exports = {\n  extend,\n  merge,\n  isUndefined,\n  noop,\n  baseExtend,\n  bytesToHex,\n  isCORSSupported,\n  isObject,\n  isFunction,\n  isPlatformSupported,\n  isDtHeaderValid,\n  parseDtHeaderValue,\n  getNavigationTimingMarks,\n  getPaintTimingMarks,\n  getDtHeaderValue,\n  getPageMetadata,\n  getCurrentScript,\n  getElasticScript,\n  getTimeOrigin,\n  generateRandomId,\n  rng,\n  checkSameOrigin,\n  sanitizeString,\n  sanitizeObjectStrings,\n  setTag,\n  stripQueryStringFromUrl,\n  find,\n  removeInvalidChars\n};\n\n/***/ }),\n\n/***/ \"./node_modules/elastic-apm-js-core/src/error-logging/error-logging.js\":\n/*!*****************************************************************************!*\\\n  !*** ./node_modules/elastic-apm-js-core/src/error-logging/error-logging.js ***!\n  \\*****************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n/**\n * MIT License\n *\n * Copyright (c) 2017-present, Elasticsearch BV\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n *\n */\nvar StackTraceService = __webpack_require__(/*! ./stack-trace-service */ \"./node_modules/elastic-apm-js-core/src/error-logging/stack-trace-service.js\");\n\nvar utils = __webpack_require__(/*! ../common/utils */ \"./node_modules/elastic-apm-js-core/src/common/utils.js\");\n\nclass ErrorLogging {\n  constructor(apmServer, configService, loggingService, transactionService) {\n    this._apmServer = apmServer;\n    this._configService = configService;\n    this._loggingService = loggingService;\n    this._transactionService = transactionService;\n    this._stackTraceService = new StackTraceService(configService, loggingService);\n  } // errorEvent = {message, filename, lineno, colno, error}\n\n\n  createErrorDataModel(errorEvent) {\n    var filePath = this._stackTraceService.cleanFilePath(errorEvent.filename);\n\n    var fileName = this._stackTraceService.filePathToFileName(filePath);\n\n    var culprit;\n\n    var frames = this._stackTraceService.createStackTraces(errorEvent);\n\n    frames = this._stackTraceService.filterInvalidFrames(frames);\n\n    if (!fileName && frames.length) {\n      var lastFrame = frames[frames.length - 1];\n\n      if (lastFrame.filename) {\n        fileName = lastFrame.filename;\n      } else {\n        // If filename empty, assume inline script\n        fileName = '(inline script)';\n      }\n    }\n\n    if (this._stackTraceService.isFileInline(filePath)) {\n      culprit = '(inline script)';\n    } else {\n      culprit = fileName;\n    }\n\n    var message = errorEvent.message || errorEvent.error && errorEvent.error.message;\n    var errorType = errorEvent.error ? errorEvent.error.name : undefined;\n\n    if (!errorType) {\n      /**\n       * Try to extract type from message formatted like\n       * 'ReferenceError: Can't find variable: initHighlighting'\n       */\n      if (message && message.indexOf(':') > -1) {\n        errorType = message.split(':')[0];\n      } else {\n        errorType = '';\n      }\n    }\n\n    var configContext = this._configService.get('context');\n\n    var stringLimit = this._configService.get('serverStringLimit');\n\n    var errorContext;\n\n    if (errorEvent.error && typeof errorEvent.error === 'object') {\n      errorContext = this._getErrorProperties(errorEvent.error);\n    }\n\n    var browserMetadata = utils.getPageMetadata();\n    var context = utils.merge({}, browserMetadata, configContext, errorContext);\n    var errorObject = {\n      id: utils.generateRandomId(),\n      culprit: utils.sanitizeString(culprit),\n      exception: {\n        message: utils.sanitizeString(message, undefined, true),\n        stacktrace: frames,\n        type: utils.sanitizeString(errorType, stringLimit, false)\n      },\n      context: context\n    };\n\n    var currentTransaction = this._transactionService.getCurrentTransaction();\n\n    if (currentTransaction) {\n      errorObject.trace_id = currentTransaction.traceId;\n      errorObject.parent_id = currentTransaction.id;\n      errorObject.transaction_id = currentTransaction.id;\n      errorObject.transaction = {\n        type: currentTransaction.type,\n        sampled: currentTransaction.sampled\n      };\n    }\n\n    return errorObject;\n  }\n\n  logErrorEvent(errorEvent, sendImmediately) {\n    if (this._configService.isActive()) {\n      if (typeof errorEvent === 'undefined') {\n        return;\n      }\n\n      var errorObject = this.createErrorDataModel(errorEvent);\n\n      if (typeof errorObject.exception.message === 'undefined') {\n        return;\n      }\n\n      if (sendImmediately) {\n        return this._apmServer.sendErrors([errorObject]);\n      } else {\n        return this._apmServer.addError(errorObject);\n      }\n    }\n  }\n\n  registerGlobalEventListener() {\n    var errorLogging = this;\n\n    window.onerror = function (messageOrEvent, source, lineno, colno, error) {\n      var errorEvent;\n\n      if (typeof messageOrEvent !== 'undefined' && typeof messageOrEvent !== 'string') {\n        errorEvent = messageOrEvent;\n      } else {\n        errorEvent = {\n          message: messageOrEvent,\n          filename: source,\n          lineno: lineno,\n          colno: colno,\n          error: error\n        };\n      }\n\n      errorLogging.logErrorEvent(errorEvent);\n    };\n  }\n\n  logError(messageOrError) {\n    var errorEvent = {};\n\n    if (typeof messageOrError === 'string') {\n      errorEvent.message = messageOrError;\n    } else {\n      errorEvent.error = messageOrError;\n    }\n\n    return this.logErrorEvent(errorEvent);\n  }\n\n  _getErrorProperties(error) {\n    var properties = {};\n    Object.keys(error).forEach(function (key) {\n      if (key === 'stack') return;\n      var val = error[key];\n      if (val === null) return; // null is typeof object and well break the switch below\n\n      switch (typeof val) {\n        case 'function':\n          return;\n\n        case 'object':\n          // ignore all objects except Dates\n          if (typeof val.toISOString !== 'function') return;\n          val = val.toISOString();\n      }\n\n      properties[key] = val;\n    });\n    return properties;\n  }\n\n}\n\nmodule.exports = ErrorLogging;\n\n/***/ }),\n\n/***/ \"./node_modules/elastic-apm-js-core/src/error-logging/index.js\":\n/*!*********************************************************************!*\\\n  !*** ./node_modules/elastic-apm-js-core/src/error-logging/index.js ***!\n  \\*********************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n/**\n * MIT License\n *\n * Copyright (c) 2017-present, Elasticsearch BV\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n *\n */\nconst ErrorLogging = __webpack_require__(/*! ./error-logging */ \"./node_modules/elastic-apm-js-core/src/error-logging/error-logging.js\");\n\nmodule.exports = {\n  ErrorLogging: ErrorLogging,\n  registerServices: function registerServices(serviceFactory) {\n    serviceFactory.registerServiceCreator('ErrorLogging', function () {\n      const apmService = serviceFactory.getService('ApmServer');\n      const configService = serviceFactory.getService('ConfigService');\n      const loggingService = serviceFactory.getService('LoggingService');\n      const transactionService = serviceFactory.getService('TransactionService');\n      return new ErrorLogging(apmService, configService, loggingService, transactionService);\n    });\n  }\n};\n\n/***/ }),\n\n/***/ \"./node_modules/elastic-apm-js-core/src/error-logging/stack-trace-service.js\":\n/*!***********************************************************************************!*\\\n  !*** ./node_modules/elastic-apm-js-core/src/error-logging/stack-trace-service.js ***!\n  \\***********************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n/**\n * MIT License\n *\n * Copyright (c) 2017-present, Elasticsearch BV\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n *\n */\nvar errorStackParser = __webpack_require__(/*! error-stack-parser */ \"./node_modules/elastic-apm-js-core/node_modules/error-stack-parser/error-stack-parser.js\");\n\nclass StackTraceService {\n  constructor(configService, loggingService) {\n    this._configService = configService;\n    this._loggingService = loggingService;\n  }\n\n  createStackTraces(errorEvent) {\n    var stackTraceService = this;\n    var error = errorEvent.error;\n    var stackTraces;\n\n    if (error) {\n      try {\n        stackTraces = errorStackParser.parse(error);\n      } catch (e) {\n        this._loggingService.debug('Parsing error stack failed!', e);\n      }\n    }\n\n    if (!stackTraces || stackTraces.length === 0) {\n      stackTraces = [{\n        fileName: errorEvent.filename,\n        lineNumber: errorEvent.lineno,\n        columnNumber: errorEvent.colno\n      }];\n    }\n\n    stackTraces = ErrorStackNormalizer(stackTraces);\n    stackTraces = stackTraces.map(function (stack) {\n      if (!stack.fileName && !stack.lineNumber) {\n        return {};\n      }\n\n      if (!stack.columnNumber && !stack.lineNumber) {\n        return {};\n      }\n\n      var filePath = stackTraceService.cleanFilePath(stack.fileName);\n      var fileName = stackTraceService.filePathToFileName(filePath);\n\n      if (stackTraceService.isFileInline(filePath)) {\n        fileName = '(inline script)';\n      }\n\n      return {\n        abs_path: stack.fileName,\n        filename: fileName,\n        function: stack.functionName || '<anonymous>',\n        lineno: stack.lineNumber,\n        colno: stack.columnNumber\n      };\n    });\n    return stackTraces;\n  }\n\n  filterInvalidFrames(frames) {\n    var result = [];\n\n    if (Array.isArray(frames)) {\n      result = frames.filter(function (f) {\n        return typeof f['filename'] !== 'undefined' && typeof f['lineno'] !== 'undefined';\n      });\n    }\n\n    return result;\n  }\n\n  filePathToFileName(fileUrl) {\n    var origin = window.location.origin || window.location.protocol + '//' + window.location.hostname + (window.location.port ? ':' + window.location.port : '');\n\n    if (fileUrl.indexOf(origin) > -1) {\n      fileUrl = fileUrl.replace(origin + '/', '');\n    }\n\n    return fileUrl;\n  }\n\n  cleanFilePath(filePath) {\n    if (!filePath) {\n      filePath = '';\n    }\n\n    if (filePath === '<anonymous>') {\n      filePath = '';\n    }\n\n    return filePath;\n  }\n\n  isFileInline(fileUrl) {\n    if (fileUrl) {\n      return window.location.href.indexOf(fileUrl) === 0;\n    } else {\n      return false;\n    }\n  }\n\n}\n\nfunction ErrorStackNormalizer(stackFrames) {\n  return stackFrames.map(function (frame) {\n    if (frame.functionName) {\n      frame.functionName = normalizeFunctionName(frame.functionName);\n    }\n\n    return frame;\n  });\n}\n\nfunction normalizeFunctionName(fnName) {\n  // SpinderMonkey name convetion (https://developer.mozilla.org/en-US/docs/Tools/Debugger-API/Debugger.Object#Accessor_Properties_of_the_Debugger.Object_prototype)\n  // We use a/b to refer to the b defined within a\n  var parts = fnName.split('/');\n\n  if (parts.length > 1) {\n    fnName = ['Object', parts[parts.length - 1]].join('.');\n  } else {\n    fnName = parts[0];\n  } // a< to refer to a function that occurs somewhere within an expression that is assigned to a.\n\n\n  fnName = fnName.replace(/.<$/gi, '.<anonymous>'); // Normalize IE's 'Anonymous function'\n\n  fnName = fnName.replace(/^Anonymous function$/, '<anonymous>'); // Always use the last part\n\n  parts = fnName.split('.');\n\n  if (parts.length > 1) {\n    fnName = parts[parts.length - 1];\n  } else {\n    fnName = parts[0];\n  }\n\n  return fnName;\n}\n\nmodule.exports = StackTraceService;\n\n/***/ }),\n\n/***/ \"./node_modules/elastic-apm-js-core/src/index.js\":\n/*!*******************************************************!*\\\n  !*** ./node_modules/elastic-apm-js-core/src/index.js ***!\n  \\*******************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n/**\n * MIT License\n *\n * Copyright (c) 2017-present, Elasticsearch BV\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n *\n */\n// export public core APIs.\nvar ErrorLogging = __webpack_require__(/*! ./error-logging */ \"./node_modules/elastic-apm-js-core/src/error-logging/index.js\");\n\nvar PerformanceMonitoring = __webpack_require__(/*! ./performance-monitoring */ \"./node_modules/elastic-apm-js-core/src/performance-monitoring/index.js\");\n\nvar ServiceFactory = __webpack_require__(/*! ./common/service-factory */ \"./node_modules/elastic-apm-js-core/src/common/service-factory.js\");\n\nvar utils = __webpack_require__(/*! ./common/utils */ \"./node_modules/elastic-apm-js-core/src/common/utils.js\");\n\nvar patching = __webpack_require__(/*! ./common/patching */ \"./node_modules/elastic-apm-js-core/src/common/patching/index.js\");\n\nmodule.exports = {\n  createServiceFactory: function () {\n    var serviceFactory = new ServiceFactory();\n    serviceFactory.registerCoreServices();\n    ErrorLogging.registerServices(serviceFactory);\n    PerformanceMonitoring.registerServices(serviceFactory);\n    return serviceFactory;\n  },\n  ServiceFactory: ServiceFactory,\n  patching: patching,\n  utils: utils\n};\n\n/***/ }),\n\n/***/ \"./node_modules/elastic-apm-js-core/src/performance-monitoring/capture-hard-navigation.js\":\n/*!************************************************************************************************!*\\\n  !*** ./node_modules/elastic-apm-js-core/src/performance-monitoring/capture-hard-navigation.js ***!\n  \\************************************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n/**\n * MIT License\n *\n * Copyright (c) 2017-present, Elasticsearch BV\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n *\n */\nconst Span = __webpack_require__(/*! ./span */ \"./node_modules/elastic-apm-js-core/src/performance-monitoring/span.js\");\n\nconst Url = __webpack_require__(/*! ../common/url */ \"./node_modules/elastic-apm-js-core/src/common/url.js\");\n\nconst eventPairs = [['domainLookupStart', 'domainLookupEnd', 'Domain lookup'], ['connectStart', 'connectEnd', 'Making a connection to the server'], ['requestStart', 'responseEnd', 'Requesting and receiving the document'], ['domLoading', 'domInteractive', 'Parsing the document, executing sync. scripts'], ['domContentLoadedEventStart', 'domContentLoadedEventEnd', 'Fire \"DOMContentLoaded\" event'], ['loadEventStart', 'loadEventEnd', 'Fire \"load\" event']];\nconst spanThreshold = 5 * 60 * 1000;\n\nfunction isValidSpan(transaction, span) {\n  var d = span.duration();\n  return d < spanThreshold && d > 0 && span._start <= transaction._end && span._end <= transaction._end;\n}\n\nfunction createNavigationTimingSpans(timings, baseTime) {\n  var spans = [];\n\n  for (var i = 0; i < eventPairs.length; i++) {\n    var start = timings[eventPairs[i][0]];\n    var end = timings[eventPairs[i][1]];\n\n    if (baseTime && start && end && end > start && start >= baseTime && end - start < spanThreshold && start - baseTime < spanThreshold && end - baseTime < spanThreshold) {\n      var span = new Span(eventPairs[i][2], 'hard-navigation.browser-timing');\n\n      if (eventPairs[i][0] === 'requestStart') {\n        span.pageResponse = true;\n      }\n\n      span._start = start - baseTime;\n      span.ended = true;\n      span._end = end - baseTime;\n      spans.push(span);\n    }\n  }\n\n  return spans;\n}\n\nfunction createResourceTimingSpans(entries, filterUrls) {\n  var spans = [];\n\n  for (var i = 0; i < entries.length; i++) {\n    var entry = entries[i];\n\n    if (entry.initiatorType && entry.initiatorType === 'xmlhttprequest' || !entry.name) {\n      continue;\n    } else if (entry.initiatorType !== 'css' && entry.initiatorType !== 'img' && entry.initiatorType !== 'script' && entry.initiatorType !== 'link') {\n      // is web request? test for css/img before the expensive operation\n      var foundAjaxReq = false;\n\n      for (var j = 0; j < filterUrls.length; j++) {\n        // entry.name.endsWith(ajaxUrls[j])\n        var idx = entry.name.lastIndexOf(filterUrls[j]);\n\n        if (idx > -1 && idx === entry.name.length - filterUrls[j].length) {\n          foundAjaxReq = true;\n          break;\n        }\n      }\n\n      if (foundAjaxReq) {\n        continue;\n      }\n    } else {\n      var kind = 'resource';\n\n      if (entry.initiatorType) {\n        kind += '.' + entry.initiatorType;\n      }\n\n      var start = entry.startTime;\n      var end = entry.responseEnd;\n\n      if (typeof start === 'number' && typeof end === 'number' && start >= 0 && end > start && end - start < spanThreshold && start < spanThreshold && end < spanThreshold) {\n        var parsedUrl = new Url(entry.name);\n        var spanName = parsedUrl.origin + parsedUrl.path;\n        var span = new Span(spanName || entry.name, kind);\n        span.addContext({\n          http: {\n            url: entry.name\n          }\n        });\n        span._start = start;\n        span.ended = true;\n        span._end = end;\n        spans.push(span);\n      }\n    }\n  }\n\n  return spans;\n}\n\nfunction captureHardNavigation(transaction) {\n  if (transaction.isHardNavigation && window.performance && window.performance.timing) {\n    var timings = window.performance.timing;\n    var baseTime = timings.fetchStart; // must be zero otherwise the calculated relative _start time would be wrong\n\n    transaction._start = 0;\n    transaction.type = 'page-load';\n    createNavigationTimingSpans(timings, baseTime).forEach(function (span) {\n      if (isValidSpan(transaction, span)) {\n        span.traceId = transaction.traceId;\n        span.sampled = transaction.sampled;\n\n        if (transaction.options.pageLoadSpanId && span.pageResponse) {\n          span.id = transaction.options.pageLoadSpanId;\n        }\n\n        transaction.spans.push(span);\n      }\n    });\n\n    if (window.performance.getEntriesByType) {\n      var entries = window.performance.getEntriesByType('resource');\n      var ajaxUrls = transaction.spans.filter(function (span) {\n        return span.type === 'external' && span.subType === 'http';\n      }).map(function (span) {\n        return span.name.split(' ')[1];\n      });\n      createResourceTimingSpans(entries, ajaxUrls).forEach(function (span) {\n        if (isValidSpan(transaction, span)) {\n          transaction.spans.push(span);\n        }\n      });\n    }\n\n    transaction._adjustStartToEarliestSpan();\n\n    transaction._adjustEndToLatestSpan();\n\n    transaction.addNavigationTimingMarks();\n  }\n}\n\nmodule.exports = {\n  captureHardNavigation: captureHardNavigation,\n  createNavigationTimingSpans: createNavigationTimingSpans,\n  createResourceTimingSpans: createResourceTimingSpans\n};\n\n/***/ }),\n\n/***/ \"./node_modules/elastic-apm-js-core/src/performance-monitoring/index.js\":\n/*!******************************************************************************!*\\\n  !*** ./node_modules/elastic-apm-js-core/src/performance-monitoring/index.js ***!\n  \\******************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n/**\n * MIT License\n *\n * Copyright (c) 2017-present, Elasticsearch BV\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n *\n */\nvar PerformanceMonitoring = __webpack_require__(/*! ./performance-monitoring */ \"./node_modules/elastic-apm-js-core/src/performance-monitoring/performance-monitoring.js\");\n\nvar TransactionService = __webpack_require__(/*! ./transaction-service */ \"./node_modules/elastic-apm-js-core/src/performance-monitoring/transaction-service.js\");\n\nmodule.exports = {\n  PerformanceMonitoring: PerformanceMonitoring,\n  registerServices: function registerServices(serviceFactory) {\n    serviceFactory.registerServiceCreator('TransactionService', function () {\n      var configService = serviceFactory.getService('ConfigService');\n      var loggingService = serviceFactory.getService('LoggingService');\n      return new TransactionService(loggingService, configService);\n    });\n    serviceFactory.registerServiceCreator('PerformanceMonitoring', function () {\n      var configService = serviceFactory.getService('ConfigService');\n      var loggingService = serviceFactory.getService('LoggingService');\n      var apmService = serviceFactory.getService('ApmServer');\n      var transactionService = serviceFactory.getService('TransactionService');\n      return new PerformanceMonitoring(apmService, configService, loggingService, transactionService);\n    });\n  }\n};\n\n/***/ }),\n\n/***/ \"./node_modules/elastic-apm-js-core/src/performance-monitoring/performance-monitoring.js\":\n/*!***********************************************************************************************!*\\\n  !*** ./node_modules/elastic-apm-js-core/src/performance-monitoring/performance-monitoring.js ***!\n  \\***********************************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n/**\n * MIT License\n *\n * Copyright (c) 2017-present, Elasticsearch BV\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n *\n */\nconst {\n  sanitizeObjectStrings,\n  sanitizeString,\n  checkSameOrigin,\n  isDtHeaderValid,\n  getDtHeaderValue,\n  merge,\n  stripQueryStringFromUrl,\n  parseDtHeaderValue\n} = __webpack_require__(/*! ../common/utils */ \"./node_modules/elastic-apm-js-core/src/common/utils.js\");\n\nconst patchingSub = __webpack_require__(/*! ../common/patching */ \"./node_modules/elastic-apm-js-core/src/common/patching/index.js\").subscription;\n\nconst {\n  globalState\n} = __webpack_require__(/*! ../common/patching/patch-utils */ \"./node_modules/elastic-apm-js-core/src/common/patching/patch-utils.js\");\n\nconst {\n  SCHEDULE,\n  INVOKE,\n  XMLHTTPREQUEST_SOURCE,\n  FETCH_SOURCE\n} = __webpack_require__(/*! ../common/constants */ \"./node_modules/elastic-apm-js-core/src/common/constants.js\");\n\nclass PerformanceMonitoring {\n  constructor(apmServer, configService, loggingService, transactionService) {\n    this._apmServer = apmServer;\n    this._configService = configService;\n    this._logginService = loggingService;\n    this._transactionService = transactionService;\n  }\n\n  init() {\n    var performanceMonitoring = this;\n\n    this._transactionService.subscribe(function (tr) {\n      var payload = performanceMonitoring.createTransactionPayload(tr);\n\n      if (payload) {\n        performanceMonitoring._apmServer.addTransaction(payload);\n      }\n    });\n\n    var patchSubFn = this.getXhrPatchSubFn(this._configService, this._transactionService);\n    this.cancelPatchSub = patchingSub.subscribe(patchSubFn);\n  }\n\n  getXhrPatchSubFn() {\n    var configService = this._configService;\n    var transactionService = this._transactionService;\n    var pm = this;\n    return function (event, task) {\n      if (task.source === XMLHTTPREQUEST_SOURCE && !globalState.fetchInProgress || task.source === FETCH_SOURCE) {\n        if (event === SCHEDULE && task.data) {\n          var spanName = task.data.method + ' ' + stripQueryStringFromUrl(task.data.url);\n          var span = transactionService.startSpan(spanName, 'external.http');\n\n          if (span) {\n            var isDtEnabled = configService.get('distributedTracing');\n            var origins = configService.get('distributedTracingOrigins');\n            var isSameOrigin = checkSameOrigin(task.data.url, window.location.href) || checkSameOrigin(task.data.url, origins);\n            var target = task.data.target;\n\n            if (isDtEnabled && isSameOrigin && target) {\n              pm.injectDtHeader(span, target);\n            }\n\n            span.addContext({\n              http: {\n                method: task.data.method,\n                url: task.data.url\n              }\n            });\n            span.sync = task.data.sync;\n            task.data.span = span;\n          }\n        } else if (event === INVOKE && task.data && task.data.span) {\n          if (typeof task.data.target.status !== 'undefined') {\n            task.data.span.addContext({\n              http: {\n                status_code: task.data.target.status\n              }\n            });\n          } else if (task.data.response) {\n            task.data.span.addContext({\n              http: {\n                status_code: task.data.response.status\n              }\n            });\n          }\n\n          task.data.span.end();\n        }\n      }\n    };\n  }\n\n  injectDtHeader(span, target) {\n    var configService = this._configService;\n    var headerName = configService.get('distributedTracingHeaderName');\n    var headerValueCallback = configService.get('distributedTracingHeaderValueCallback');\n\n    if (typeof headerValueCallback !== 'function') {\n      headerValueCallback = getDtHeaderValue;\n    }\n\n    var headerValue = headerValueCallback(span);\n    var isHeaderValid = isDtHeaderValid(headerValue);\n\n    if (headerName && headerValue && isHeaderValid) {\n      if (typeof target.setRequestHeader === 'function') {\n        target.setRequestHeader(headerName, headerValue);\n      } else if (target.headers && typeof target.headers.append === 'function') {\n        target.headers.append(headerName, headerValue);\n      } else {\n        target[headerName] = headerValue;\n      }\n    }\n  }\n\n  extractDtHeader(target) {\n    var configService = this._configService;\n    var headerName = configService.get('distributedTracingHeaderName');\n\n    if (target) {\n      return parseDtHeaderValue(target[headerName]);\n    }\n  }\n\n  setTransactionContext(transaction) {\n    var context = this._configService.get('context');\n\n    if (context) {\n      transaction.addContext(context);\n    }\n  }\n\n  filterTransaction(tr) {\n    var performanceMonitoring = this;\n\n    var transactionDurationThreshold = this._configService.get('transactionDurationThreshold');\n\n    var duration = tr.duration();\n\n    if (!duration || duration > transactionDurationThreshold || !tr.spans.length) {\n      return false;\n    }\n    /**\n     * In case of unsampled transaction, send only the transaction to apm server\n     *  without any spans to reduce the payload size\n     */\n\n\n    if (!tr.sampled) {\n      tr.resetSpans();\n    }\n\n    var browserResponsivenessInterval = this._configService.get('browserResponsivenessInterval');\n\n    var checkBrowserResponsiveness = this._configService.get('checkBrowserResponsiveness');\n\n    if (checkBrowserResponsiveness && !tr.isHardNavigation) {\n      var buffer = performanceMonitoring._configService.get('browserResponsivenessBuffer');\n\n      var wasBrowserResponsive = performanceMonitoring.checkBrowserResponsiveness(tr, browserResponsivenessInterval, buffer);\n\n      if (!wasBrowserResponsive) {\n        performanceMonitoring._logginService.debug('Transaction was discarded! browser was not responsive enough during the transaction.', ' duration:', duration, ' browserResponsivenessCounter:', tr.browserResponsivenessCounter, 'interval:', browserResponsivenessInterval);\n\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  prepareTransaction(transaction) {\n    transaction.spans.sort(function (spanA, spanB) {\n      return spanA._start - spanB._start;\n    });\n\n    if (this._configService.get('groupSimilarSpans')) {\n      var similarSpanThreshold = this._configService.get('similarSpanThreshold');\n\n      transaction.spans = this.groupSmallContinuouslySimilarSpans(transaction, similarSpanThreshold);\n    }\n\n    transaction.spans = transaction.spans.filter(function (span) {\n      return span.duration() > 0 && span._start >= transaction._start && span._end > transaction._start && span._start < transaction._end && span._end <= transaction._end;\n    });\n    this.setTransactionContext(transaction);\n  }\n\n  createTransactionDataModel(transaction) {\n    var configContext = this._configService.get('context');\n\n    var stringLimit = this._configService.get('serverStringLimit');\n\n    var transactionStart = transaction._start;\n    var spans = transaction.spans.map(function (span) {\n      var context;\n\n      if (span.context) {\n        context = sanitizeObjectStrings(span.context, stringLimit);\n      }\n\n      return {\n        id: span.id,\n        transaction_id: transaction.id,\n        parent_id: span.parentId || transaction.id,\n        trace_id: transaction.traceId,\n        name: sanitizeString(span.name, stringLimit, true),\n        type: sanitizeString(span.type, stringLimit, true),\n        subType: sanitizeString(span.subType, stringLimit, true),\n        action: sanitizeString(span.action, stringLimit, true),\n        sync: span.sync,\n        start: span._start - transactionStart,\n        duration: span.duration(),\n        context: context\n      };\n    });\n    var context = merge({}, configContext, transaction.context);\n    return {\n      id: transaction.id,\n      trace_id: transaction.traceId,\n      name: sanitizeString(transaction.name, stringLimit, false),\n      type: sanitizeString(transaction.type, stringLimit, true),\n      duration: transaction.duration(),\n      spans: spans,\n      context: context,\n      marks: transaction.marks,\n      span_count: {\n        started: spans.length\n      },\n      sampled: transaction.sampled\n    };\n  }\n\n  createTransactionPayload(transaction) {\n    this.prepareTransaction(transaction);\n    var filtered = this.filterTransaction(transaction);\n\n    if (filtered) {\n      return this.createTransactionDataModel(transaction);\n    }\n  }\n\n  sendTransactions(transactions) {\n    var payload = transactions.map(this.createTransactionPayload.bind(this)).filter(function (tr) {\n      return tr;\n    });\n\n    this._logginService.debug('Sending Transactions to apm server.', transactions.length); // todo: check if transactions are already being sent\n\n\n    var promise = this._apmServer.sendTransactions(payload);\n\n    return promise;\n  }\n\n  convertTransactionsToServerModel(transactions) {\n    return transactions.map(this.createTransactionDataModel.bind(this));\n  }\n\n  groupSmallContinuouslySimilarSpans(transaction, threshold) {\n    var transDuration = transaction.duration();\n    var spans = [];\n    var lastCount = 1;\n    transaction.spans.forEach(function (span, index) {\n      if (spans.length === 0) {\n        spans.push(span);\n      } else {\n        var lastSpan = spans[spans.length - 1];\n        var isContinuouslySimilar = lastSpan.type === span.type && lastSpan.subType === span.subType && lastSpan.action === span.action && lastSpan.name === span.name && span.duration() / transDuration < threshold && (span._start - lastSpan._end) / transDuration < threshold;\n        var isLastSpan = transaction.spans.length === index + 1;\n\n        if (isContinuouslySimilar) {\n          lastCount++;\n          lastSpan._end = span._end;\n        }\n\n        if (lastCount > 1 && (!isContinuouslySimilar || isLastSpan)) {\n          lastSpan.name = lastCount + 'x ' + lastSpan.name;\n          lastCount = 1;\n        }\n\n        if (!isContinuouslySimilar) {\n          spans.push(span);\n        }\n      }\n    });\n    return spans;\n  }\n\n  checkBrowserResponsiveness(transaction, interval, buffer) {\n    var counter = transaction.browserResponsivenessCounter;\n\n    if (typeof interval === 'undefined' || typeof counter === 'undefined') {\n      return true;\n    }\n\n    var duration = transaction.duration();\n    var expectedCount = Math.floor(duration / interval);\n    var wasBrowserResponsive = counter + buffer >= expectedCount;\n    return wasBrowserResponsive;\n  }\n\n}\n\nmodule.exports = PerformanceMonitoring;\n\n/***/ }),\n\n/***/ \"./node_modules/elastic-apm-js-core/src/performance-monitoring/span-base.js\":\n/*!**********************************************************************************!*\\\n  !*** ./node_modules/elastic-apm-js-core/src/performance-monitoring/span-base.js ***!\n  \\**********************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n/**\n * MIT License\n *\n * Copyright (c) 2017-present, Elasticsearch BV\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n *\n */\nconst {\n  isUndefined,\n  generateRandomId,\n  setTag,\n  merge\n} = __webpack_require__(/*! ../common/utils */ \"./node_modules/elastic-apm-js-core/src/common/utils.js\");\n\nclass SpanBase {\n  // context\n  constructor(name, type, options) {\n    this.options = options || {};\n    this.name = name || this.options.name || 'Unknown';\n    this.type = type || this.options.type || 'custom';\n    this.id = this.options.id || generateRandomId(16);\n    this.traceId = this.options.traceId;\n    this.sampled = this.options.sampled;\n    this.timestamp = this.options.timestamp || Date.now();\n    this.ended = false;\n    this._start = window.performance.now();\n    this._end = undefined;\n    this.onEnd = this.options.onEnd;\n  }\n\n  ensureContext() {\n    if (!this.context) {\n      this.context = {};\n    }\n  }\n\n  addTags(tags) {\n    this.ensureContext();\n    var ctx = this.context;\n\n    if (!ctx.tags) {\n      ctx.tags = {};\n    }\n\n    var keys = Object.keys(tags);\n    keys.forEach(function (k) {\n      setTag(k, tags[k], ctx.tags);\n    });\n  }\n\n  addContext(context) {\n    if (!context) return;\n    this.ensureContext();\n    merge(this.context, context);\n  }\n\n  end() {\n    if (this.ended) {\n      return;\n    }\n\n    this.ended = true;\n    this._end = window.performance.now();\n    this.callOnEnd();\n  }\n\n  callOnEnd() {\n    if (typeof this.onEnd === 'function') {\n      this.onEnd(this);\n    }\n  }\n\n  duration() {\n    if (isUndefined(this._end) || isUndefined(this._start)) {\n      return null;\n    }\n\n    var diff = this._end - this._start;\n    return parseFloat(diff);\n  }\n\n}\n\nmodule.exports = SpanBase;\n\n/***/ }),\n\n/***/ \"./node_modules/elastic-apm-js-core/src/performance-monitoring/span.js\":\n/*!*****************************************************************************!*\\\n  !*** ./node_modules/elastic-apm-js-core/src/performance-monitoring/span.js ***!\n  \\*****************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n/**\n * MIT License\n *\n * Copyright (c) 2017-present, Elasticsearch BV\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n *\n */\nconst BaseSpan = __webpack_require__(/*! ./span-base */ \"./node_modules/elastic-apm-js-core/src/performance-monitoring/span-base.js\");\n\nclass Span extends BaseSpan {\n  constructor(name, type, options) {\n    super(name, type, options);\n    this.parentId = this.options.parentId;\n    this.subType = undefined;\n    this.action = undefined;\n\n    if (this.type.indexOf('.') !== -1) {\n      var fields = this.type.split('.', 3);\n      this.type = fields[0];\n      this.subType = fields[1];\n      this.action = fields[2];\n    }\n\n    this.sync = this.options.sync;\n  }\n\n}\n\nmodule.exports = Span;\n\n/***/ }),\n\n/***/ \"./node_modules/elastic-apm-js-core/src/performance-monitoring/transaction-service.js\":\n/*!********************************************************************************************!*\\\n  !*** ./node_modules/elastic-apm-js-core/src/performance-monitoring/transaction-service.js ***!\n  \\********************************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n/**\n * MIT License\n *\n * Copyright (c) 2017-present, Elasticsearch BV\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n *\n */\nvar Transaction = __webpack_require__(/*! ./transaction */ \"./node_modules/elastic-apm-js-core/src/performance-monitoring/transaction.js\");\n\nvar utils = __webpack_require__(/*! ../common/utils */ \"./node_modules/elastic-apm-js-core/src/common/utils.js\");\n\nvar Subscription = __webpack_require__(/*! ../common/subscription */ \"./node_modules/elastic-apm-js-core/src/common/subscription.js\");\n\nvar captureHardNavigation = __webpack_require__(/*! ./capture-hard-navigation */ \"./node_modules/elastic-apm-js-core/src/performance-monitoring/capture-hard-navigation.js\").captureHardNavigation;\n\nclass TransactionService {\n  constructor(logger, config) {\n    if (typeof config === 'undefined') {\n      logger.debug('TransactionService: config is not provided');\n    }\n\n    this._config = config;\n    this._logger = logger;\n    this.marks = {};\n    this.currentTransaction = undefined;\n    this._subscription = new Subscription();\n    this._alreadyCapturedPageLoad = false;\n  }\n\n  shouldCreateTransaction() {\n    return this._config.isActive();\n  }\n\n  getOrCreateCurrentTransaction() {\n    if (!this.shouldCreateTransaction()) {\n      return;\n    }\n\n    var tr = this.getCurrentTransaction();\n\n    if (!utils.isUndefined(tr) && !tr.ended) {\n      return tr;\n    }\n\n    return this.createZoneTransaction();\n  }\n\n  getCurrentTransaction() {\n    return this.currentTransaction;\n  }\n\n  setCurrentTransaction(value) {\n    this.currentTransaction = value;\n  }\n\n  createTransaction(name, type, options) {\n    var perfOptions = options;\n\n    if (utils.isUndefined(perfOptions)) {\n      perfOptions = this._config.config;\n    }\n\n    if (!this.shouldCreateTransaction()) {\n      return;\n    }\n\n    var tr = new Transaction(name, type, perfOptions);\n    this.setCurrentTransaction(tr);\n\n    if (perfOptions.checkBrowserResponsiveness) {\n      this.startCounter(tr);\n    }\n\n    return tr;\n  }\n\n  createZoneTransaction() {\n    return this.createTransaction('ZoneTransaction', 'transaction');\n  }\n\n  startCounter(transaction) {\n    transaction.browserResponsivenessCounter = 0;\n\n    var interval = this._config.get('browserResponsivenessInterval');\n\n    if (typeof interval === 'undefined') {\n      this._logger.debug('browserResponsivenessInterval is undefined!');\n\n      return;\n    }\n\n    this.runOuter(function () {\n      var id = setInterval(function () {\n        if (transaction.ended) {\n          window.clearInterval(id);\n        } else {\n          transaction.browserResponsivenessCounter++;\n        }\n      }, interval);\n    });\n  }\n\n  sendPageLoadMetrics(name) {\n    var tr = this.startTransaction(name, 'page-load');\n    tr.detectFinish();\n    return tr;\n  }\n\n  capturePageLoadMetrics(tr) {\n    var self = this;\n\n    var capturePageLoad = self._config.get('capturePageLoad');\n\n    if (capturePageLoad && !self._alreadyCapturedPageLoad && tr.isHardNavigation) {\n      tr.addMarks(self.marks);\n      captureHardNavigation(tr);\n      self._alreadyCapturedPageLoad = true;\n      return true;\n    }\n  }\n\n  startTransaction(name, type, options) {\n    var self = this;\n    var config = self._config.config;\n    var perfOptions = utils.extend({\n      pageLoadTraceId: config.pageLoadTraceId,\n      pageLoadSampled: config.pageLoadSampled,\n      pageLoadSpanId: config.pageLoadSpanId,\n      pageLoadTransactionName: config.pageLoadTransactionName,\n      transactionSampleRate: config.transactionSampleRate\n    }, options);\n\n    if (!type) {\n      type = 'custom';\n    }\n\n    if (!name) {\n      name = 'Unknown';\n    } // this will create a zone transaction if possible\n\n\n    var tr = this.getOrCreateCurrentTransaction();\n\n    if (tr) {\n      if (tr.name === 'ZoneTransaction') {\n        tr.redefine(name, type, perfOptions);\n      } else {\n        this._logger.debug('Ending old transaction', tr);\n\n        tr.end();\n        tr = this.createTransaction(name, type, perfOptions);\n      }\n    } else {\n      return;\n    }\n\n    if (type === 'page-load') {\n      tr.isHardNavigation = true;\n\n      if (perfOptions.pageLoadTraceId) {\n        tr.traceId = perfOptions.pageLoadTraceId;\n      }\n\n      if (typeof perfOptions.pageLoadSampled !== 'undefined') {\n        tr.sampled = perfOptions.pageLoadSampled;\n      }\n\n      if (tr.name === 'Unknown' && config.pageLoadTransactionName) {\n        tr.name = config.pageLoadTransactionName;\n      }\n    }\n\n    this._logger.debug('TransactionService.startTransaction', tr);\n\n    tr.onEnd = function () {\n      self.applyAsync(function () {\n        self._logger.debug('TransactionService transaction finished', tr);\n\n        if (!self.shouldIgnoreTransaction(tr.name)) {\n          if (type === 'page-load') {\n            if (tr.name === 'Unknown' && self._config.get('pageLoadTransactionName')) {\n              tr.name = self._config.get('pageLoadTransactionName');\n            }\n\n            var captured = self.capturePageLoadMetrics(tr);\n\n            if (captured) {\n              self.add(tr);\n            }\n          } else {\n            self.add(tr);\n          }\n        }\n      });\n    };\n\n    return tr;\n  }\n\n  applyAsync(fn, applyThis, applyArgs) {\n    return this.runOuter(function () {\n      return Promise.resolve().then(function () {\n        return fn.apply(applyThis, applyArgs);\n      }, function (reason) {\n        console.log(reason);\n      });\n    });\n  }\n\n  shouldIgnoreTransaction(transactionName) {\n    var ignoreList = this._config.get('ignoreTransactions');\n\n    for (var i = 0; i < ignoreList.length; i++) {\n      var element = ignoreList[i];\n\n      if (typeof element.test === 'function') {\n        if (element.test(transactionName)) {\n          return true;\n        }\n      } else if (element === transactionName) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  startSpan(name, type, options) {\n    var trans = this.getOrCreateCurrentTransaction();\n\n    if (trans) {\n      this._logger.debug('TransactionService.startSpan', name, type);\n\n      var span = trans.startSpan(name, type, options);\n      return span;\n    }\n  }\n\n  add(transaction) {\n    if (!this._config.isActive()) {\n      return;\n    }\n\n    this._subscription.applyAll(this, [transaction]);\n\n    this._logger.debug('TransactionService.add', transaction);\n  }\n\n  subscribe(fn) {\n    return this._subscription.subscribe(fn);\n  }\n\n  addTask(taskId) {\n    var tr = this.getOrCreateCurrentTransaction();\n\n    if (tr) {\n      tr.addTask(taskId);\n\n      this._logger.debug('TransactionService.addTask', taskId);\n    }\n\n    return taskId;\n  }\n\n  removeTask(taskId) {\n    var tr = this.getCurrentTransaction();\n\n    if (!utils.isUndefined(tr) && !tr.ended) {\n      tr.removeTask(taskId);\n\n      this._logger.debug('TransactionService.removeTask', taskId);\n    }\n  }\n\n  detectFinish() {\n    var tr = this.getCurrentTransaction();\n\n    if (!utils.isUndefined(tr) && !tr.ended) {\n      tr.detectFinish();\n\n      this._logger.debug('TransactionService.detectFinish');\n    }\n  }\n\n  runOuter(fn, applyThis, applyArgs) {\n    return fn.apply(applyThis, applyArgs);\n  }\n\n}\n\nmodule.exports = TransactionService;\n\n/***/ }),\n\n/***/ \"./node_modules/elastic-apm-js-core/src/performance-monitoring/transaction.js\":\n/*!************************************************************************************!*\\\n  !*** ./node_modules/elastic-apm-js-core/src/performance-monitoring/transaction.js ***!\n  \\************************************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n/**\n * MIT License\n *\n * Copyright (c) 2017-present, Elasticsearch BV\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n *\n */\nconst Span = __webpack_require__(/*! ./span */ \"./node_modules/elastic-apm-js-core/src/performance-monitoring/span.js\");\n\nconst SpanBase = __webpack_require__(/*! ./span-base */ \"./node_modules/elastic-apm-js-core/src/performance-monitoring/span-base.js\");\n\nconst {\n  generateRandomId,\n  getNavigationTimingMarks,\n  getPaintTimingMarks,\n  merge,\n  extend,\n  getPageMetadata,\n  removeInvalidChars\n} = __webpack_require__(/*! ../common/utils */ \"./node_modules/elastic-apm-js-core/src/common/utils.js\");\n\nclass Transaction extends SpanBase {\n  constructor(name, type, options) {\n    super(name, type, options);\n    this.traceId = generateRandomId();\n    this.marks = undefined;\n    this.spans = [];\n    this._activeSpans = {};\n    this._scheduledTasks = {};\n    this.nextAutoTaskId = 0;\n    this.isHardNavigation = false;\n    this.sampled = Math.random() <= this.options.transactionSampleRate;\n  }\n\n  addNavigationTimingMarks() {\n    var marks = getNavigationTimingMarks();\n    var paintMarks = getPaintTimingMarks();\n\n    if (marks) {\n      var agent = {\n        timeToFirstByte: marks.responseStart,\n        domInteractive: marks.domInteractive,\n        domComplete: marks.domComplete\n      };\n\n      if (paintMarks['first-contentful-paint']) {\n        agent.firstContentfulPaint = paintMarks['first-contentful-paint'];\n      }\n\n      this.addMarks({\n        navigationTiming: marks,\n        agent\n      });\n    }\n  }\n\n  addMarks(obj) {\n    this.marks = merge(this.marks || {}, obj);\n  }\n\n  mark(key) {\n    var skey = removeInvalidChars(key);\n\n    var now = window.performance.now() - this._start;\n\n    var custom = {};\n    custom[skey] = now;\n    this.addMarks({\n      custom\n    });\n  }\n\n  redefine(name, type, options) {\n    this.name = name;\n    this.type = type;\n    this.options = options;\n  }\n\n  startSpan(name, type, options) {\n    if (this.ended) {\n      return;\n    }\n\n    var transaction = this;\n    var opts = extend({}, options);\n\n    opts.onEnd = function (trc) {\n      transaction._onSpanEnd(trc);\n    };\n\n    opts.traceId = this.traceId;\n    opts.sampled = this.sampled;\n\n    if (!opts.parentId) {\n      opts.parentId = this.id;\n    }\n\n    var span = new Span(name, type, opts);\n    this._activeSpans[span.id] = span;\n    return span;\n  }\n\n  isFinished() {\n    var scheduledTasks = Object.keys(this._scheduledTasks);\n    return scheduledTasks.length === 0;\n  }\n\n  detectFinish() {\n    if (this.isFinished()) this.end();\n  }\n\n  end() {\n    if (this.ended) {\n      return;\n    }\n\n    this.ended = true;\n    this._end = window.performance.now(); // truncate active spans\n\n    for (var sid in this._activeSpans) {\n      var span = this._activeSpans[sid];\n      span.type = span.type + '.truncated';\n      span.end();\n    }\n\n    var metadata = getPageMetadata();\n    this.addContext(metadata);\n\n    this._adjustStartToEarliestSpan();\n\n    this._adjustEndToLatestSpan();\n\n    this.callOnEnd();\n  }\n\n  addTask(taskId) {\n    // todo: should not accept more tasks if the transaction is alreadyFinished]\n    if (typeof taskId === 'undefined') {\n      taskId = 'autoId' + this.nextAutoTaskId++;\n    }\n\n    this._scheduledTasks[taskId] = taskId;\n    return taskId;\n  }\n\n  removeTask(taskId) {\n    delete this._scheduledTasks[taskId];\n    this.detectFinish();\n  }\n\n  addEndedSpans(existingSpans) {\n    this.spans = this.spans.concat(existingSpans);\n  }\n\n  resetSpans() {\n    this.spans = [];\n  }\n\n  _onSpanEnd(span) {\n    this.spans.push(span); // Remove span from _activeSpans\n\n    delete this._activeSpans[span.id];\n  }\n\n  _adjustEndToLatestSpan() {\n    var latestSpan = findLatestNonXHRSpan(this.spans);\n\n    if (latestSpan) {\n      this._end = latestSpan._end; // set all spans that now are longer than the transaction to\n      // be truncated spans\n\n      for (var i = 0; i < this.spans.length; i++) {\n        var span = this.spans[i];\n\n        if (span._end > this._end) {\n          span._end = this._end;\n          span.type = span.type + '.truncated';\n        }\n\n        if (span._start > this._end) {\n          span._start = this._end;\n        }\n      }\n    }\n  }\n\n  _adjustStartToEarliestSpan() {\n    var span = getEarliestSpan(this.spans);\n\n    if (span && span._start < this._start) {\n      this._start = span._start;\n    }\n  }\n\n}\n\nfunction findLatestNonXHRSpan(spans) {\n  var latestSpan = null;\n\n  for (var i = 0; i < spans.length; i++) {\n    var span = spans[i];\n\n    if (span.type && span.type.indexOf('ext') === -1 && span.type !== 'transaction' && (!latestSpan || latestSpan._end < span._end)) {\n      latestSpan = span;\n    }\n  }\n\n  return latestSpan;\n}\n\nfunction getEarliestSpan(spans) {\n  var earliestSpan = null;\n  spans.forEach(function (span) {\n    if (!earliestSpan) {\n      earliestSpan = span;\n    }\n\n    if (earliestSpan && earliestSpan._start > span._start) {\n      earliestSpan = span;\n    }\n  });\n  return earliestSpan;\n}\n\nmodule.exports = Transaction;\n\n/***/ }),\n\n/***/ \"./node_modules/uuid/lib/rng-browser.js\":\n/*!**********************************************!*\\\n  !*** ./node_modules/uuid/lib/rng-browser.js ***!\n  \\**********************************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\n// Unique ID creation requires a high quality random # generator.  In the\n// browser this is a little complicated due to unknown quality of Math.random()\n// and inconsistent support for the `crypto` API.  We do the best we can via\n// feature-detection\n// getRandomValues needs to be invoked in a context where \"this\" is a Crypto\n// implementation. Also, find the complete implementation of crypto on IE11.\nvar getRandomValues = typeof crypto != 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto) || typeof msCrypto != 'undefined' && typeof window.msCrypto.getRandomValues == 'function' && msCrypto.getRandomValues.bind(msCrypto);\n\nif (getRandomValues) {\n  // WHATWG crypto RNG - http://wiki.whatwg.org/wiki/Crypto\n  var rnds8 = new Uint8Array(16); // eslint-disable-line no-undef\n\n  module.exports = function whatwgRNG() {\n    getRandomValues(rnds8);\n    return rnds8;\n  };\n} else {\n  // Math.random()-based (RNG)\n  //\n  // If all else fails, use Math.random().  It's fast, but is of unspecified\n  // quality.\n  var rnds = new Array(16);\n\n  module.exports = function mathRNG() {\n    for (var i = 0, r; i < 16; i++) {\n      if ((i & 0x03) === 0) r = Math.random() * 0x100000000;\n      rnds[i] = r >>> ((i & 0x03) << 3) & 0xff;\n    }\n\n    return rnds;\n  };\n}\n\n/***/ }),\n\n/***/ \"./src/services/report/kibanaApm/api.ts\":\n/*!**********************************************!*\\\n  !*** ./src/services/report/kibanaApm/api.ts ***!\n  \\**********************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nfunction setUserInfo(userContext) {\n  this.tracerTransaction.setUserInfo(userContext);\n}\n\nexports.setUserInfo = setUserInfo;\n;\n\nfunction captureError(error) {\n  return this.tracerTransaction.captureError(error);\n}\n\nexports.captureError = captureError;\n\nfunction createCustomLog(name, type, options) {\n  if (type === void 0) {\n    type = 'custome';\n  }\n\n  return this.tracerTransaction.createCustomEventTransaction(name, type, options);\n}\n\nexports.createCustomLog = createCustomLog;\n\n/***/ }),\n\n/***/ \"./src/services/report/kibanaApm/custome.ts\":\n/*!**************************************************!*\\\n  !*** ./src/services/report/kibanaApm/custome.ts ***!\n  \\**************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports._handleCustome = function (params) {};\n\n/***/ }),\n\n/***/ \"./src/services/report/kibanaApm/defaultConfig.ts\":\n/*!********************************************************!*\\\n  !*** ./src/services/report/kibanaApm/defaultConfig.ts ***!\n  \\********************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = {\n  //上报url\n  serverUrl: null,\n  //服务名\n  serviceName: 'undefined',\n  //版本\n  agentVersion: 'undefined',\n  //是否自动启动\n  automaticStart: true,\n  //是否启动pageload检测\n  isCatchPageload: true,\n  //是否启动错误捕获\n  isCatchError: true,\n  //上传相关配置\n  transactionDurationThreshold: 999999999999999999999,\n  flushInterval: 0,\n  errorThrottleInterval: 0,\n  transactionThrottleInterval: 0\n};\n\n/***/ }),\n\n/***/ \"./src/services/report/kibanaApm/handle.ts\":\n/*!*************************************************!*\\\n  !*** ./src/services/report/kibanaApm/handle.ts ***!\n  \\*************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar index_1 = __webpack_require__(/*! @util/index */ \"@util/index\");\n\nexports._getReportContent = function (params) {\n  var _self = this; //判断数据合法性\n\n\n  if (!params || !params.type || !params.typeName || !params.data) {\n    index_1.consoleTools.warnError('reportServer receive reportData is not right : typeName and type and data is undefined ');\n    return false;\n  } //处理上报\n\n\n  switch (params.type) {\n    case 'monitor':\n      this._handleMonitor(params);\n\n      break;\n\n    case 'custome':\n      this._handleCustome(params);\n\n      break;\n    //以下暂缺，kibanaApm暂时不处理\n\n    case 'analyse':\n    case 'performance':\n    case 'undefined':\n    default:\n      index_1.consoleTools.warnError(params.type + 'is no handle type');\n  }\n};\n\nexports._handleCatchError = function () {\n  var _self = this;\n\n  this.tracerTransaction.watchCatchError(function (errorMessage) {\n    //通知发送错误\n    _self.sendMessage({\n      type: \"monitor\",\n      typeName: 'error',\n      data: errorMessage\n    });\n  });\n};\n\n/***/ }),\n\n/***/ \"./src/services/report/kibanaApm/index.ts\":\n/*!************************************************!*\\\n  !*** ./src/services/report/kibanaApm/index.ts ***!\n  \\************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar defaultConfig_1 = __importDefault(__webpack_require__(/*! ./defaultConfig */ \"./src/services/report/kibanaApm/defaultConfig.ts\"));\n\nvar index_1 = __webpack_require__(/*! @util/index */ \"@util/index\");\n\nvar transaction_1 = __importDefault(__webpack_require__(/*! ./transaction */ \"./src/services/report/kibanaApm/transaction.ts\"));\n\nvar handle_1 = __webpack_require__(/*! ./handle */ \"./src/services/report/kibanaApm/handle.ts\");\n\nvar api_1 = __webpack_require__(/*! ./api */ \"./src/services/report/kibanaApm/api.ts\");\n\nvar custome_1 = __webpack_require__(/*! ./custome */ \"./src/services/report/kibanaApm/custome.ts\");\n\nvar monitor_1 = __webpack_require__(/*! ./monitor */ \"./src/services/report/kibanaApm/monitor.ts\"); // report Server \n\n\nvar KeepObserverKibanaApmReport =\n/** @class */\nfunction (_super) {\n  __extends(KeepObserverKibanaApmReport, _super); //constructor\n\n\n  function KeepObserverKibanaApmReport(config) {\n    if (config === void 0) {\n      config = {};\n    }\n\n    var _this = _super.call(this, config) || this; //method\n\n\n    _this._getReportContent = handle_1._getReportContent.bind(_this);\n    _this._handleCatchError = handle_1._handleCatchError.bind(_this);\n    _this._handleCustome = custome_1._handleCustome.bind(_this);\n    _this._handleMonitor = monitor_1._handleMonitor.bind(_this);\n    _this._handleMonitorLog = monitor_1._handleMonitorLog.bind(_this);\n    _this._handleMonitorNetwork = monitor_1._handleMonitorNetwork.bind(_this);\n    _this._handleHtmlElementActive = monitor_1._handleHtmlElementActive.bind(_this);\n    _this._handleKibanaApmTrack = monitor_1._handleKibanaApmTrack.bind(_this); //api\n\n    _this.setUserInfo = api_1.setUserInfo.bind(_this);\n    _this.captureError = api_1.captureError.bind(_this);\n    _this.createCustomLog = api_1.createCustomLog.bind(_this);\n    var _a = config,\n        _b = _a.reportCustom,\n        reportCustom = _b === void 0 ? false : _b,\n        _c = _a.develop,\n        develop = _c === void 0 ? false : _c; //存混合配置\n\n    var reportConfig = reportCustom || config; //是否是开发模式\n\n    reportConfig.develop = develop; //混合默认配置\n\n    _this._config = index_1.Tools.extend(__assign({}, defaultConfig_1[\"default\"]), reportConfig); //发送方法\n\n    _this.sendMessage = function () {\n      return index_1.consoleTools.warnError('sendMessage is not active, apply receive sendPipeMessage fail ');\n    }; //init\n\n\n    _this.tracerTransaction = new transaction_1[\"default\"](_this._config);\n    return _this;\n  }\n  /*\n      提供一个挂载方法在注入中使用\n   */\n\n\n  KeepObserverKibanaApmReport.prototype.apply = function (_a) {\n    var registerReciveMessage = _a.registerReciveMessage,\n        sendMessage = _a.sendMessage;\n    registerReciveMessage(this._getReportContent, this);\n    this.sendMessage = sendMessage; //start\n\n    var _b = this._config,\n        isCatchPageload = _b.isCatchPageload,\n        isCatchError = _b.isCatchError;\n\n    if (isCatchPageload) {\n      this.tracerTransaction.pageLoad();\n    }\n\n    if (isCatchError) {\n      this.tracerTransaction.catchError();\n\n      this._handleCatchError();\n    }\n\n    return {\n      setUserInfo: this.setUserInfo,\n      captureError: this.captureError,\n      createCustomLog: this.createCustomLog\n    };\n  };\n\n  return KeepObserverKibanaApmReport;\n}(index_1.KeepObserverPublic);\n\nexports[\"default\"] = KeepObserverKibanaApmReport;\n\n/***/ }),\n\n/***/ \"./src/services/report/kibanaApm/monitor.ts\":\n/*!**************************************************!*\\\n  !*** ./src/services/report/kibanaApm/monitor.ts ***!\n  \\**************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar index_1 = __webpack_require__(/*! @util/index */ \"@util/index\");\n\nexports._handleMonitor = function (params) {\n  var _self = this;\n\n  switch (params.typeName) {\n    case 'log':\n      return _self._handleMonitorLog(params);\n\n    case 'network':\n      return _self._handleMonitorNetwork(params);\n\n    case 'htmlElementActive':\n      return _self._handleHtmlElementActive(params);\n\n    case 'kibanaApmTrack':\n      return _self._handleKibanaApmTrack(params);\n\n    case 'error':\n      return index_1.consoleTools.warnError('kibanaAPM has a error is monitor of self, is not handle monitor error report');\n\n    default:\n      return;\n  }\n};\n\nexports._handleMonitorLog = function (reportParams) {\n  var _a = reportParams.data,\n      _b = _a.type,\n      type = _b === void 0 ? '' : _b,\n      _c = _a.data,\n      data = _c === void 0 ? '' : _c;\n  var taskName = reportParams.type + \"-\" + reportParams.typeName;\n  var task = this.tracerTransaction.createCustomEventTransaction(taskName, reportParams.typeName); //tag index limt key\n\n  task.addTags({\n    type: type,\n    data: data\n  });\n  task.end();\n};\n\nexports._handleMonitorNetwork = function (reportParams) {\n  var _a = reportParams.data,\n      _b = _a.method,\n      method = _b === void 0 ? '' : _b,\n      _c = _a.statusType,\n      statusType = _c === void 0 ? '' : _c,\n      _d = _a.type,\n      type = _d === void 0 ? '' : _d,\n      _e = _a.url,\n      url = _e === void 0 ? '' : _e,\n      _f = _a.requestHead,\n      requestHead = _f === void 0 ? null : _f,\n      _g = _a.responseHead,\n      responseHead = _g === void 0 ? null : _g,\n      _h = _a.params,\n      params = _h === void 0 ? null : _h,\n      _j = _a.body,\n      body = _j === void 0 ? '' : _j,\n      _k = _a.status,\n      status = _k === void 0 ? 0 : _k,\n      _l = _a.startTime,\n      startTime = _l === void 0 ? 0 : _l,\n      _m = _a.endTime,\n      endTime = _m === void 0 ? 0 : _m,\n      _o = _a.costTime,\n      costTime = _o === void 0 ? 0 : _o,\n      _p = _a.response,\n      response = _p === void 0 ? '' : _p,\n      _q = _a.responseType,\n      responseType = _q === void 0 ? '' : _q,\n      _r = _a.timeout,\n      timeout = _r === void 0 ? 0 : _r,\n      _s = _a.errorContent,\n      errorContent = _s === void 0 ? '' : _s,\n      _t = _a.isTimeout,\n      isTimeout = _t === void 0 ? false : _t,\n      _u = _a.isError,\n      isError = _u === void 0 ? false : _u; // request no report \n\n  if (statusType === 'request') {\n    return;\n  }\n\n  var taskName = reportParams.type + \"-\" + reportParams.typeName;\n  var task = this.tracerTransaction.createCustomEventTransaction(taskName, reportParams.typeName); //tag index limt key\n\n  task.addTags({\n    method: method,\n    url: url,\n    statusType: statusType,\n    type: type,\n    requestHead: index_1.Tools.objectStringify(requestHead),\n    responseHead: index_1.Tools.objectStringify(responseHead),\n    params: index_1.Tools.objectStringify(params),\n    body: body,\n    status: status,\n    startTime: startTime,\n    endTime: endTime,\n    costTime: costTime,\n    response: response,\n    responseType: responseType,\n    timeout: timeout,\n    errorContent: errorContent,\n    isTimeout: isTimeout,\n    isError: isError\n  });\n  task.end();\n};\n\nexports._handleHtmlElementActive = function (reportParams) {\n  var taskName = reportParams.type + \"-\" + reportParams.typeName;\n  var task = this.tracerTransaction.createCustomEventTransaction(taskName, reportParams.typeName);\n  var _a = reportParams.data,\n      type = _a.type,\n      title = _a.title,\n      xPath = _a.xPath,\n      value = _a.value;\n  task.addTags({\n    type: type,\n    title: title,\n    xPath: xPath,\n    value: value\n  });\n  task.end();\n};\n\nexports._handleKibanaApmTrack = function (reportParams) {\n  var taskName = reportParams.type + \"-\" + reportParams.typeName;\n  var task = this.tracerTransaction.createCustomEventTransaction(taskName, reportParams.typeName);\n  var _a = reportParams.data,\n      tags = _a.tags,\n      spans = _a.spans,\n      type = _a.type,\n      url = _a.url;\n  task.addTags(__assign({}, tags, {\n    type: type,\n    url: url\n  }));\n  spans.forEach(function (span) {\n    task.startSpan(span.name, span.type);\n  });\n  task.end();\n};\n\n/***/ }),\n\n/***/ \"./src/services/report/kibanaApm/transaction.ts\":\n/*!******************************************************!*\\\n  !*** ./src/services/report/kibanaApm/transaction.ts ***!\n  \\******************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n}); //elastic-apm-js-core 的ServiceFactory提供的TransactionService是返回的单例模式\n//暂时只能从源代码库中拉取原始Transaction\n\nvar transaction_1 = __importDefault(__webpack_require__(/*! elastic-apm-js-core/src/performance-monitoring/transaction */ \"./node_modules/elastic-apm-js-core/src/performance-monitoring/transaction.js\"));\n\nvar elastic_apm_js_core_1 = __webpack_require__(/*! elastic-apm-js-core */ \"./node_modules/elastic-apm-js-core/src/index.js\");\n\nvar index_1 = __webpack_require__(/*! @util/index */ \"@util/index\");\n\nvar TracerTransaction =\n/** @class */\nfunction () {\n  function TracerTransaction(config) {\n    var _this = this; //part\n\n\n    this.Initialized = false; // custom transcation\n\n    this.initCustomTransaction = function (config) {\n      _this.customServiceFactory = elastic_apm_js_core_1.createServiceFactory();\n\n      var ConfigService = _this.customServiceFactory.getService(\"ConfigService\");\n\n      ConfigService.setConfig(config);\n\n      _this.customServiceFactory.init();\n\n      _this.Customonitoring = _this.customServiceFactory.getService(\"PerformanceMonitoring\");\n\n      _this.Customonitoring.init();\n\n      _this.Customonitoring.cancelPatchSub();\n\n      _this.ApmServer = _this.serviceFactory.getService('ApmServer');\n      _this.Initialized = true;\n    }; // api\n\n\n    this.createTransaction = function (name, type) {\n      var transactionService = _this.serviceFactory.getService(\"TransactionService\");\n\n      return transactionService.startTransaction(name, type);\n    };\n\n    this.setUserInfo = function (userInfo) {\n      var configService = _this.serviceFactory.getService(\"ConfigService\");\n\n      configService.setUserContext(userInfo);\n\n      var customConfigService = _this.customServiceFactory.getService(\"ConfigService\");\n\n      customConfigService.setUserContext(userInfo);\n    };\n\n    this.createCustomEventTransaction = function (name, type, options) {\n      var self = _this;\n\n      if (!self.Initialized) {\n        return false;\n      }\n\n      var _option = index_1.Tools.extend({\n        transactionSampleRate: 1\n      }, options);\n\n      var transaction = new transaction_1[\"default\"](name, type, _option); //添加onEnd事件\n\n      Object.defineProperty(transaction, 'onEnd', {\n        enumerable: false,\n        configurable: false,\n        writable: false,\n        value: function value() {\n          if (this instanceof transaction_1[\"default\"]) {\n            self.Customonitoring.prepareTransaction(this);\n            var payload = self.Customonitoring.createTransactionDataModel(this);\n            self.ApmServer.addTransaction(payload);\n          }\n        }\n      });\n      return transaction;\n    };\n\n    this.serviceFactory = elastic_apm_js_core_1.createServiceFactory();\n    this.configService = this.serviceFactory.getService(\"ConfigService\");\n    this.configService.setConfig(config);\n    this.serviceFactory.init(); //customTransaction\n\n    this.initCustomTransaction(config);\n  }\n\n  TracerTransaction.prototype.pageLoad = function () {\n    //加载load监听\n    //挂载第一次pageload\n    var performanceMonitoring = this.serviceFactory.getService(\"PerformanceMonitoring\");\n    performanceMonitoring.init(); //send page load\n\n    if (this.configService.get(\"sendPageLoadTransaction\")) {\n      var transactionService = this.serviceFactory.getService(\"TransactionService\");\n      var tr = transactionService.startTransaction(window.location.href, \"page-load\");\n\n      var sendPageLoadMetrics = function sendPageLoadMetrics() {\n        // to make sure PerformanceTiming.loadEventEnd has a value\n        setTimeout(function () {\n          if (tr) {\n            tr.detectFinish(); //取消elastic-apm自带的log以及xhr相关patch\n\n            performanceMonitoring.cancelPatchSub();\n          }\n        });\n      };\n\n      if (document.readyState === \"complete\") {\n        sendPageLoadMetrics();\n      } else {\n        window.addEventListener(\"load\", sendPageLoadMetrics.bind(this));\n      }\n    }\n  };\n\n  TracerTransaction.prototype.catchError = function () {\n    var errorLogging = this.serviceFactory.getService(\"ErrorLogging\");\n    errorLogging.registerGlobalEventListener();\n  };\n\n  TracerTransaction.prototype.captureError = function (error) {\n    var errorLogging = this.serviceFactory.getService('ErrorLogging');\n    return errorLogging.logError(error);\n  };\n\n  TracerTransaction.prototype.watchCatchError = function (callback) {\n    var errorLogging = this.serviceFactory.getService(\"ErrorLogging\");\n    var logErrorEventPatch = errorLogging.logErrorEvent;\n\n    errorLogging.logErrorEvent = function (errorEvent, sendImmediately) {\n      callback(errorEvent);\n      return logErrorEventPatch.apply(errorLogging, errorEvent, sendImmediately);\n    };\n  };\n\n  return TracerTransaction;\n}();\n\nexports[\"default\"] = TracerTransaction;\n\n/***/ }),\n\n/***/ \"@util/index\":\n/*!******************************!*\\\n  !*** external \"@util/index\" ***!\n  \\******************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\nmodule.exports = __WEBPACK_EXTERNAL_MODULE__util_index__;\n\n/***/ })\n\n/******/ });\n});","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"@util/index\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"@util/index\"], factory);\n\telse {\n\t\tvar a = typeof exports === 'object' ? factory(require(\"@util/index\")) : factory(root[\"@util/index\"]);\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(window, function(__WEBPACK_EXTERNAL_MODULE__util_index__) {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// define __esModule on exports\n/******/ \t__webpack_require__.r = function(exports) {\n/******/ \t\tObject.defineProperty(exports, '__esModule', { value: true });\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = \"./src/services/middleware/kibanaApmTrack/index.ts\");\n/******/ })\n/************************************************************************/\n/******/ ({\n\n/***/ \"./src/services/middleware/kibanaApmTrack/api.ts\":\n/*!*******************************************************!*\\\n  !*** ./src/services/middleware/kibanaApmTrack/api.ts ***!\n  \\*******************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nexports.cancelTrack = function () {\n  this.isCancelTrack = true;\n};\n\nexports.startTrack = function () {\n  this.isCancelTrack = false;\n};\n\nexports.cancelPatch = function () {\n  window.removeEventListener(\"hashchange\", this._handleHashPageChange);\n  window.history.pushState = this._pushState;\n  window.history.replaceState = this._replaceState;\n};\n\n/***/ }),\n\n/***/ \"./src/services/middleware/kibanaApmTrack/defaultConfig.ts\":\n/*!*****************************************************************!*\\\n  !*** ./src/services/middleware/kibanaApmTrack/defaultConfig.ts ***!\n  \\*****************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = {\n  //是否中断掉正常的catch内容\n  isInterruptNormal: false,\n  //是否自动开始上报\n  automaticStart: true,\n  //上报时间format\n  reportDateFormat: 'yyyy-MM-dd hh:mm:ss'\n};\n\n/***/ }),\n\n/***/ \"./src/services/middleware/kibanaApmTrack/handleMiddle.ts\":\n/*!****************************************************************!*\\\n  !*** ./src/services/middleware/kibanaApmTrack/handleMiddle.ts ***!\n  \\****************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) {\n      ar.push(r.value);\n    }\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nvar __spread = this && this.__spread || function () {\n  for (var ar = [], i = 0; i < arguments.length; i++) {\n    ar = ar.concat(__read(arguments[i]));\n  }\n\n  return ar;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar index_1 = __webpack_require__(/*! @util/index */ \"@util/index\");\n\nexports._handleReciceReportMessage = function (interrupt, next) {\n  var _this = this;\n\n  return function () {\n    var params = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      params[_i] = arguments[_i];\n    }\n\n    var isInterruptNormal = _this._config.isInterruptNormal;\n\n    var _a = __read(params, 1),\n        _b = _a[0],\n        message = _b === void 0 ? {} : _b;\n\n    var _c = message.type,\n        type = _c === void 0 ? false : _c,\n        typeName = message.typeName; //中间件执行中会屏蔽发起的sendMessage\n\n    _this.isSendlock = true; //valid message\n\n    if (_this.isCancelTrack || !type || !index_1.Tools.isString(type) || type !== 'monitor') {\n      next.apply(void 0, __spread(params));\n      return;\n    } //handle message\n\n\n    switch (typeName) {\n      case 'log':\n        _this._handleTrackLog(message);\n\n        break;\n\n      case 'network':\n        _this._handleTrackNetwork(message);\n\n        break;\n\n      case 'htmlElementActive':\n        _this._handleTrackHtmlElementActive(message);\n\n        break;\n\n      case 'error':\n        _this._handleTrackError(message);\n\n        break;\n\n      case 'kibanaApmTrack':\n        return next.apply(void 0, __spread(params));\n\n      default:\n        index_1.consoleTools.warnError(\"is no support track typeName:\" + typeName);\n        return next.apply(void 0, __spread(params));\n    }\n\n    return isInterruptNormal ? interrupt(false) : next.apply(void 0, __spread(params));\n  };\n};\n\nexports._handleTrackLog = function (params) {\n  this.trackList.push(params); //判断是否是error类型\n\n  var type = params.data.type;\n\n  if (type === 'error') {\n    this.isWaitSend = 'pageError';\n    this.errorContent = index_1.Tools.objectStringify(params.data);\n\n    this._handleSendTrackMessage();\n  }\n};\n\nexports._handleTrackNetwork = function (params) {\n  this.trackList.push(params); //判断是否是请求出错\n\n  var isError = params.data.isError;\n\n  if (isError) {\n    this.isWaitSend = 'pageError';\n    this.errorContent = index_1.Tools.objectStringify(params.data);\n\n    this._handleSendTrackMessage();\n  }\n};\n\nexports._handleTrackHtmlElementActive = function (params) {\n  this.trackList.push(params);\n};\n\nexports._handleTrackError = function (params) {\n  this.trackList.push(params);\n  this.isWaitSend = 'pageError';\n  this.errorContent = index_1.Tools.objectStringify(params.data);\n\n  this._handleSendTrackMessage();\n}; //send \n\n\nexports._handleSendTrackMessage = function () {\n  var reportData = null;\n  var develop = this._config.develop;\n\n  switch (this.isWaitSend) {\n    case 'pageError':\n      if (this.isSendlock) return;\n      this.isWaitSend = false;\n      reportData = this._handleCreateReport('pageError');\n      this.errorContent = '';\n      break;\n\n    case 'pageHashChange':\n      if (this.isSendlock) return;\n      this.isWaitSend = false;\n      reportData = this._handleCreateReport('pageHashChange');\n      break;\n  }\n\n  if (!reportData) return;\n\n  if (reportData.data && reportData.data.type === 'pageHashChange') {\n    this.trackList = [];\n    this.isPageChangeHandle = false;\n  } //send\n\n\n  if (develop) {\n    index_1.consoleTools.log('track-reportData', reportData);\n  }\n\n  this.sendMessage(reportData);\n};\n\nexports._handleCreateReport = function (type) {\n  var _this = this;\n\n  var reportDateFormat = this._config.reportDateFormat;\n  var now = new Date().getTime();\n  var trackInfo = {\n    type: type,\n    url: window.location.href\n  };\n\n  switch (type) {\n    case 'pageHashChange':\n      trackInfo['tags'] = this.pageInfo;\n      break;\n\n    case 'pageError':\n      trackInfo['tags'] = {\n        startUrl: this.pageInfo.startUrl,\n        startDate: this.pageInfo.startDate,\n        findErrorDate: index_1.Tools.dateFormat(now, reportDateFormat),\n        errorContent: this.errorContent\n      };\n      break;\n\n    default:\n      return false;\n  }\n\n  trackInfo['spans'] = this.trackList.map(function (span) {\n    var reportDateFormat = _this._config.reportDateFormat;\n    var typeName = span.typeName,\n        reportTime = span.reportTime,\n        data = span.data;\n    var name = 'undefined';\n    var type = span.type + \"-\" + typeName + \":\" + index_1.Tools.dateFormat(reportTime, reportDateFormat);\n\n    switch (typeName) {\n      case 'log':\n        name = data.type + \"->\" + index_1.Tools.substringLimt(data.data);\n        break;\n\n      case 'network':\n        name = data.type + \"->\" + data.method + \":\" + data.url + \"(\" + data.statusType + \":\" + data.status + (data.response ? \"->\" + index_1.Tools.substringLimt(data.response) + \")\" : ')');\n        break;\n\n      case 'htmlElementActive':\n        name = data.type + \"->\" + data.title + \"(xpath:\" + data.xPath + \")\" + (data.type === 'change' ? '->' + index_1.Tools.substringLimt(data.value) : '');\n        break;\n\n      case 'error':\n        name = \"Error->\" + data.message + (data.filename ? '(' + data.filename + ')' : '');\n        break;\n    }\n\n    return {\n      name: name,\n      type: type\n    };\n  });\n  return {\n    type: 'monitor',\n    typeName: 'kibanaApmTrack',\n    data: trackInfo,\n    isError: type === 'pageError' ? true : false\n  };\n};\n\n/***/ }),\n\n/***/ \"./src/services/middleware/kibanaApmTrack/index.ts\":\n/*!*********************************************************!*\\\n  !*** ./src/services/middleware/kibanaApmTrack/index.ts ***!\n  \\*********************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar defaultConfig_1 = __importDefault(__webpack_require__(/*! ./defaultConfig */ \"./src/services/middleware/kibanaApmTrack/defaultConfig.ts\"));\n\nvar index_1 = __webpack_require__(/*! @util/index */ \"@util/index\");\n\nvar handleMiddle_1 = __webpack_require__(/*! ./handleMiddle */ \"./src/services/middleware/kibanaApmTrack/handleMiddle.ts\");\n\nvar pageHashChange_1 = __webpack_require__(/*! ./pageHashChange */ \"./src/services/middleware/kibanaApmTrack/pageHashChange.ts\");\n\nvar api_1 = __webpack_require__(/*! ./api */ \"./src/services/middleware/kibanaApmTrack/api.ts\");\n\nvar KeepObserverMiddlewareKibanaApmTrack =\n/** @class */\nfunction (_super) {\n  __extends(KeepObserverMiddlewareKibanaApmTrack, _super); //构造函数\n\n\n  function KeepObserverMiddlewareKibanaApmTrack(config) {\n    if (config === void 0) {\n      config = {};\n    }\n\n    var _this = _super.call(this, config) || this;\n\n    _this.isSendlock = true;\n    _this.isWaitSend = false;\n    _this.isPageChangeHandle = false;\n    _this.isCancelTrack = true;\n    _this.trackInfo = undefined;\n    _this.pageInfo = null;\n    _this.errorContent = '';\n    _this.trackList = [];\n    _this.resgisterPageHashChangeEventListener = pageHashChange_1.resgisterPageHashChangeEventListener.bind(_this);\n    _this.checkPageHashUrlChange = pageHashChange_1.checkPageHashUrlChange.bind(_this);\n    _this._handleHashPageChange = pageHashChange_1._handleHashPageChange.bind(_this);\n    _this._pageStart = pageHashChange_1._pageStart.bind(_this);\n    _this._pageHashNext = pageHashChange_1._pageHashNext.bind(_this); //send\n\n    _this._handleSendTrackMessage = handleMiddle_1._handleSendTrackMessage.bind(_this);\n    _this._handleCreateReport = handleMiddle_1._handleCreateReport.bind(_this); //method\n\n    _this._handleReciceReportMessage = handleMiddle_1._handleReciceReportMessage.bind(_this);\n    _this._handleTrackLog = handleMiddle_1._handleTrackLog.bind(_this);\n    _this._handleTrackNetwork = handleMiddle_1._handleTrackNetwork.bind(_this);\n    _this._handleTrackHtmlElementActive = handleMiddle_1._handleTrackHtmlElementActive.bind(_this);\n    _this._handleTrackError = handleMiddle_1._handleTrackError.bind(_this); //api\n\n    _this.cancelTrack = api_1.cancelTrack.bind(_this);\n    _this.startTrack = api_1.startTrack.bind(_this);\n    _this.cancelPatch = api_1.cancelPatch.bind(_this);\n    var _a = config.develop,\n        develop = _a === void 0 ? false : _a; //存混合配置\n\n    _this._config = index_1.Tools.extend(__assign({}, defaultConfig_1[\"default\"]), __assign({}, config, {\n      develop: develop\n    }));\n    var reportDateFormat = _this._config.reportDateFormat;\n    _this.pageInfo = {\n      startUrl: '',\n      startDate: index_1.Tools.dateFormat(new Date().getTime(), reportDateFormat),\n      nextUrl: '',\n      nextDate: 0\n    }; //发送方法\n\n    _this.sendMessage = function () {\n      return index_1.consoleTools.warnError('sendMessage is not active, apply receive sendPipeMessage fail ');\n    }; //注册pageHashChange事件\n\n\n    _this.resgisterPageHashChangeEventListener();\n\n    return _this;\n  } //提供一个挂载入口\n\n\n  KeepObserverMiddlewareKibanaApmTrack.prototype.apply = function (_a) {\n    var _this = this;\n\n    var sendMessage = _a.sendMessage,\n        useExtendMiddle = _a.useExtendMiddle,\n        registerSendDoneCallback = _a.registerSendDoneCallback;\n    var automaticStart = this._config.automaticStart;\n    this.sendMessage = sendMessage; //receive message\n\n    useExtendMiddle('sendMessage', this._handleReciceReportMessage); //send wait\n\n    registerSendDoneCallback(function () {\n      _this.isSendlock = false;\n      if (!_this.isWaitSend) return;\n\n      _this._handleSendTrackMessage();\n    });\n\n    if (automaticStart) {\n      this.startTrack();\n    }\n\n    return {\n      cancelTrack: this.cancelTrack,\n      startTrack: this.startTrack,\n      cancelHashChangePatch: this.cancelPatch\n    };\n  };\n\n  return KeepObserverMiddlewareKibanaApmTrack;\n}(index_1.KeepObserverPublic);\n\nexports[\"default\"] = KeepObserverMiddlewareKibanaApmTrack;\n\n/***/ }),\n\n/***/ \"./src/services/middleware/kibanaApmTrack/pageHashChange.ts\":\n/*!******************************************************************!*\\\n  !*** ./src/services/middleware/kibanaApmTrack/pageHashChange.ts ***!\n  \\******************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar index_1 = __webpack_require__(/*! @util/index */ \"@util/index\");\n\nexports.resgisterPageHashChangeEventListener = function () {\n  //监听相关内容\n  var self = this; //hashchange\n\n  window.addEventListener(\"hashchange\", this._handleHashPageChange); //pushStateModel  replaceStateModel\n\n  self._pushState = window.history.pushState;\n\n  window.history.pushState = function (state, title, url) {\n    var oldURL = window.location.href;\n    var newURL = url ? url : oldURL; // hook \n\n    self._handleHashPageChange({\n      eventName: 'pushState',\n      oldURL: oldURL,\n      newURL: newURL,\n      state: state,\n      title: title\n    }); //run \n\n\n    return self._pushState.apply(window.history, arguments);\n  };\n\n  self._replaceState = window.history.replaceState;\n\n  window.history.replaceState = function (state, title, url) {\n    var oldURL = window.location.href;\n    var newURL = url ? url : oldURL; // hook \n\n    self._handleHashPageChange({\n      eventName: 'replaceState',\n      oldURL: oldURL,\n      newURL: newURL,\n      state: state,\n      title: title\n    });\n\n    return self._replaceState.apply(window.history, arguments);\n  }; //start receive\n\n\n  this._pageStart();\n};\n\nexports.checkPageHashUrlChange = function (oldUrl, newUrL) {\n  //其中某一次不存在\n  if (!oldUrl || !newUrL || !index_1.Tools.isString(oldUrl) || !index_1.Tools.isString(newUrL)) {\n    return false;\n  } //has path没有变化\n\n\n  var newPath = newUrL.indexOf('?') > -1 ? newUrL.split('?')[0] : newUrL;\n  var oldPath = oldUrl.indexOf('?') > -1 ? oldUrl.split('?')[0] : oldUrl;\n\n  if (newPath === oldPath) {\n    return false;\n  }\n\n  return true;\n};\n\nexports._handleHashPageChange = function (event) {\n  if (this.isPageChangeHandle) {\n    return false;\n  }\n\n  var newURL = event.newURL,\n      oldURL = event.oldURL;\n  if (this.isCancelTrack || !this.checkPageHashUrlChange(oldURL, newURL)) return; // next page\n\n  this.isPageChangeHandle = true;\n\n  this._pageHashNext(newURL);\n}; // page status\n\n\nexports._pageStart = function () {\n  var reportDateFormat = this._config.reportDateFormat;\n  var startUrl = window.location.href;\n  var startDate = index_1.Tools.dateFormat(new Date().getTime(), reportDateFormat);\n  this.pageInfo = __assign({}, this.pageInfo, {\n    startUrl: startUrl,\n    startDate: startDate\n  });\n};\n\nexports._pageHashNext = function (nextHash) {\n  var reportDateFormat = this._config.reportDateFormat;\n  var nextUrl = nextHash || window.location.href;\n  var nextDate = index_1.Tools.dateFormat(new Date().getTime(), reportDateFormat);\n  this.pageInfo = __assign({}, this.pageInfo, {\n    nextUrl: nextUrl,\n    nextDate: nextDate\n  }); //开启pageHashChange上报\n  //如果有pageError未发生的就忽略\n\n  if (!this.isWaitSend) {\n    this.isWaitSend = 'pageHashChange';\n\n    this._handleSendTrackMessage();\n  }\n};\n\n/***/ }),\n\n/***/ \"@util/index\":\n/*!******************************!*\\\n  !*** external \"@util/index\" ***!\n  \\******************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\nmodule.exports = __WEBPACK_EXTERNAL_MODULE__util_index__;\n\n/***/ })\n\n/******/ });\n});","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"@util/index\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"@util/index\"], factory);\n\telse {\n\t\tvar a = typeof exports === 'object' ? factory(require(\"@util/index\")) : factory(root[\"@util/index\"]);\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(window, function(__WEBPACK_EXTERNAL_MODULE__util_index__) {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// define __esModule on exports\n/******/ \t__webpack_require__.r = function(exports) {\n/******/ \t\tObject.defineProperty(exports, '__esModule', { value: true });\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = \"./src/services/monitor/htmlElementActive/index.ts\");\n/******/ })\n/************************************************************************/\n/******/ ({\n\n/***/ \"./src/services/monitor/htmlElementActive/api.ts\":\n/*!*******************************************************!*\\\n  !*** ./src/services/monitor/htmlElementActive/api.ts ***!\n  \\*******************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n/*\n    停止监听\n */\n\nexports.stopObserver = function () {\n  this.isObserver = false;\n  document.removeEventListener('click', this.handleElementEvent);\n  document.removeEventListener('change', this.handleElementEvent);\n};\n/*\n    开始监听\n */\n\n\nexports.startObserver = function () {\n  if (this.isObserver) return;\n  this.isObserver = true;\n  document.addEventListener('click', this.handleElementEvent);\n  document.addEventListener('change', this.handleElementEvent);\n};\n\n/***/ }),\n\n/***/ \"./src/services/monitor/htmlElementActive/defaultConfig.ts\":\n/*!*****************************************************************!*\\\n  !*** ./src/services/monitor/htmlElementActive/defaultConfig.ts ***!\n  \\*****************************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n/*\n \nobserver htmlElement 实例默认配置数据\n*/\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = {\n  //xpath\n  xpathFlag: 'KO_tracer_xPathFlag',\n  //开启追踪\n  elementTrackFlag: 'KO-tracer-flag',\n  //全量捕获\n  isGlobalElementActionCatch: false,\n  //是否自动开始上报\n  automaticStart: true\n};\n\n/***/ }),\n\n/***/ \"./src/services/monitor/htmlElementActive/handle.ts\":\n/*!**********************************************************!*\\\n  !*** ./src/services/monitor/htmlElementActive/handle.ts ***!\n  \\**********************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar index_1 = __webpack_require__(/*! @util/index */ \"@util/index\");\n\nvar CN_CodeReg = /[\\u4e00-\\u9fa5\\w]/ig;\nvar Clear_CN_CodeReg = /[^\\u4e00-\\u9fa5\\w]/ig;\n\nexports.queryFlagElement = function (el) {\n  var elementTrackFlag = this._config.elementTrackFlag;\n\n  if (!index_1.Tools.isElement(el) || el.tagName.toLowerCase() === 'body') {\n    return false;\n  }\n\n  var flag = el.getAttribute(elementTrackFlag);\n  return index_1.Tools.isExist(flag) ? el : el.parentNode ? this.queryFlagElement(el.parentNode) : false;\n};\n\nexports.filterRepeat = function (elementActiveInfo) {\n  if (!this.previouActiveElement) {\n    this.previouActiveElement = elementActiveInfo;\n    return true;\n  }\n\n  var type = elementActiveInfo.type,\n      xPath = elementActiveInfo.xPath; //repeate click\n\n  var preType = this.previouActiveElement.type;\n  var preXpath = this.previouActiveElement.xPath;\n\n  if (type === 'click' && type === preType && preXpath === xPath) {\n    this.previouActiveElement = elementActiveInfo;\n    return false;\n  }\n\n  this.previouActiveElement = elementActiveInfo;\n  return true;\n};\n\nexports.createXPath = function (element) {\n  var xpathFlag = this._config.xpathFlag; //id\n\n  if (element.id) {\n    return \"//*[@id=\\\"\" + element.id + \"\\\"]\";\n  } //body\n\n\n  if (element.nodeName.toLowerCase() === 'body') {\n    return \"/html/\" + element.nodeName.toLowerCase();\n  }\n\n  if (!element.parentNode) {\n    return 'unkonw-parentNode';\n  }\n\n  var index = 1;\n  var brotherList = element.parentNode.children;\n  element.setAttribute(xpathFlag, true);\n\n  for (var i = 0, len = brotherList.length; i < len; i++) {\n    var item = brotherList[i];\n\n    if (item.getAttribute(xpathFlag)) {\n      element.removeAttribute(xpathFlag);\n      return this.createXPath(element.parentNode) + \"/\" + element.nodeName.toLowerCase() + (index > 1 ? '[' + index + ']' : '');\n    } else if (item.nodeName.toLowerCase() === element.nodeName.toLowerCase()) {\n      index++;\n    }\n  }\n};\n\nexports.createTitle = function (el) {\n  var type = el.tagName.toLowerCase();\n  var content = ''; //获取内容\n\n  if (el.outerText && CN_CodeReg.test(el.outerText)) {\n    content = el.outerText;\n    content = content.replace(Clear_CN_CodeReg, '');\n  } else if (el.textContent && CN_CodeReg.test(el.textContent)) {\n    content = el.textContent.replace(Clear_CN_CodeReg, '');\n  } else if (el.className !== '') {\n    content = '.' + el.className;\n  }\n\n  content = content.length > 30 ? content.substring(0, 30) + '...' : content;\n  return type + ':' + content;\n};\n\nexports.createSendMessage = function (type, element) {\n  var title = this.createTitle(element);\n  var xPath = this.createXPath(element);\n  var value = type === 'change' ? element.value : ''; //change input checkbox radio \n\n  if (element.nodeName.toLowerCase() === 'input' && (element.type === 'checkbox' || element.type === 'radio')) {\n    value = element.checked;\n  }\n\n  return {\n    type: type,\n    title: title,\n    xPath: xPath,\n    value: value\n  };\n};\n\nexports.handleElementEvent = function (event) {\n  var target = event.target,\n      type = event.type;\n  var isGlobalElementActionCatch = this._config.isGlobalElementActionCatch;\n  var flag = isGlobalElementActionCatch ? true : this.queryFlagElement(target);\n  if (!flag) return; //create message info\n\n  var elementActiveInfo = this.createSendMessage(type, target); //filter repeate  click\n\n  if (!this.filterRepeat(elementActiveInfo)) return;\n  this.sendMessage({\n    type: \"monitor\",\n    typeName: 'htmlElementActive',\n    data: elementActiveInfo\n  });\n};\n\n/***/ }),\n\n/***/ \"./src/services/monitor/htmlElementActive/index.ts\":\n/*!*********************************************************!*\\\n  !*** ./src/services/monitor/htmlElementActive/index.ts ***!\n  \\*********************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar defaultConfig_1 = __importDefault(__webpack_require__(/*! ./defaultConfig */ \"./src/services/monitor/htmlElementActive/defaultConfig.ts\"));\n\nvar index_1 = __webpack_require__(/*! @util/index */ \"@util/index\");\n\nvar api_1 = __webpack_require__(/*! ./api */ \"./src/services/monitor/htmlElementActive/api.ts\");\n\nvar handle_1 = __webpack_require__(/*! ./handle */ \"./src/services/monitor/htmlElementActive/handle.ts\");\n\nvar KeepObserverHtmlElementActive =\n/** @class */\nfunction (_super) {\n  __extends(KeepObserverHtmlElementActive, _super); //构造函数\n\n\n  function KeepObserverHtmlElementActive(config) {\n    if (config === void 0) {\n      config = {};\n    }\n\n    var _this = _super.call(this, config) || this; //method\n\n\n    _this.queryFlagElement = handle_1.queryFlagElement.bind(_this);\n    _this.filterRepeat = handle_1.filterRepeat.bind(_this);\n    _this.createXPath = handle_1.createXPath.bind(_this);\n    _this.createTitle = handle_1.createTitle.bind(_this);\n    _this.createSendMessage = handle_1.createSendMessage.bind(_this);\n    _this.handleElementEvent = handle_1.handleElementEvent.bind(_this);\n    _this.stopObserver = api_1.stopObserver.bind(_this);\n    _this.startObserver = api_1.startObserver.bind(_this); //初始化上传相关实例\n\n    var _a = config,\n        _b = _a.htmlElementCustom,\n        htmlElementCustom = _b === void 0 ? false : _b,\n        _c = _a.develop,\n        develop = _c === void 0 ? false : _c;\n    var htmlElementConfig = htmlElementCustom || config; //存混合配置\n\n    _this._config = index_1.Tools.extend(__assign({}, defaultConfig_1[\"default\"]), __assign({}, htmlElementConfig, {\n      develop: develop\n    })); //是否开始监听\n\n    _this.isObserver = false; //发送方法\n\n    _this.sendMessage = function () {\n      return index_1.consoleTools.warnError('sendMessage is not active, apply receive sendPipeMessage fail ');\n    };\n\n    return _this;\n  } //提供一个挂载入口\n\n\n  KeepObserverHtmlElementActive.prototype.apply = function (_a) {\n    var sendMessage = _a.sendMessage;\n    var automaticStart = this._config.automaticStart;\n    this.sendMessage = sendMessage; //开始\n\n    if (automaticStart) {\n      this.startObserver();\n    }\n\n    return {\n      htmlElementActiveStop: this.stopObserver,\n      htmlElementActiveStart: this.startObserver\n    };\n  };\n\n  return KeepObserverHtmlElementActive;\n}(index_1.KeepObserverPublic);\n\nexports[\"default\"] = KeepObserverHtmlElementActive;\n\n/***/ }),\n\n/***/ \"@util/index\":\n/*!******************************!*\\\n  !*** external \"@util/index\" ***!\n  \\******************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\nmodule.exports = __WEBPACK_EXTERNAL_MODULE__util_index__;\n\n/***/ })\n\n/******/ });\n});","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"@util/index\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"@util/index\"], factory);\n\telse {\n\t\tvar a = typeof exports === 'object' ? factory(require(\"@util/index\")) : factory(root[\"@util/index\"]);\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(window, function(__WEBPACK_EXTERNAL_MODULE__util_index__) {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// define __esModule on exports\n/******/ \t__webpack_require__.r = function(exports) {\n/******/ \t\tObject.defineProperty(exports, '__esModule', { value: true });\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = \"./src/services/monitor/network/index.ts\");\n/******/ })\n/************************************************************************/\n/******/ ({\n\n/***/ \"./src/services/monitor/network/api.ts\":\n/*!*********************************************!*\\\n  !*** ./src/services/monitor/network/api.ts ***!\n  \\*********************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n/*\n    停止捕获\n*/\n\nexports.stopObserver = function () {\n  this.isCatch = false;\n};\n/*\n    开始捕获\n */\n\n\nexports.startObserver = function () {\n  this.isCatch = true;\n};\n/*\n    取消拦截\n*/\n\n\nexports.cancelPatch = function () {\n  //这种方式会和angular 6的zone 等polyfills.js产生冲突\n  window.XMLHttpRequest.prototype.open = this._open;\n  window.XMLHttpRequest.prototype.send = this._send;\n  window.XMLHttpRequest.prototype.setRequestHeader = this._setRequestHeader;\n  window.fetch = this._fetch;\n  this._open = null;\n  this._send = null;\n  this._setRequestHeader = null;\n  this._fetch = null;\n};\n\n/***/ }),\n\n/***/ \"./src/services/monitor/network/defaultConfig.ts\":\n/*!*******************************************************!*\\\n  !*** ./src/services/monitor/network/defaultConfig.ts ***!\n  \\*******************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n/*\n    observer newwork 实例默认配置数据\n */\n\nexports[\"default\"] = {\n  //默认超时时间 20S;\n  timeout: 20000,\n  //屏蔽URL\n  ignoreRequestList: [],\n  //是否捕获响应内容\n  isCatchResponseContent: true,\n  //是否自动开始上报\n  automaticStart: true\n};\n\n/***/ }),\n\n/***/ \"./src/services/monitor/network/handle.ts\":\n/*!************************************************!*\\\n  !*** ./src/services/monitor/network/handle.ts ***!\n  \\************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) {\n    if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n  }\n  result[\"default\"] = mod;\n  return result;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar index_1 = __webpack_require__(/*! @util/index */ \"@util/index\");\n\nvar networkTool = __importStar(__webpack_require__(/*! ./tool */ \"./src/services/monitor/network/tool.ts\"));\n/*\n    初始化ajax请求监控\n    在这里替换window.XMLHttpRequest变量进行监控\n*/\n\n\nexports._init = function () {\n  //拦截Ajax以及fetch\n  this._patchXMLAjax();\n\n  this._patchFetch();\n};\n/*\n    拦截XML AJax信息\n */\n\n\nexports._patchXMLAjax = function () {\n  var _self = this;\n\n  var isCatchResponseContent = _self._config.isCatchResponseContent;\n  var _XMLHttp = window.XMLHttpRequest; //不支持 ajax 不进行监控\n\n  if (!_XMLHttp) {\n    return false;\n  }\n\n  _self._open = window.XMLHttpRequest.prototype.open;\n  _self._send = window.XMLHttpRequest.prototype.send;\n  _self._setRequestHeader = window.XMLHttpRequest.prototype.setRequestHeader; //拦截原生open\n\n  window.XMLHttpRequest.prototype.open = function (method, url) {\n    var XML = this;\n    var args = index_1.Tools.toArray(arguments); //定时器\n\n    var timer = null; //获取请求唯一ID\n\n    var id = index_1.Tools.getUniqueID(); //获取方法\n\n    var method = args[0]; //获取url\n\n    var url = args[1]; //保存下 在send中使用\n\n    XML._url = url;\n    XML._method = method;\n    XML._id = id; //保存下请求头 在拦截请求头处使用\n\n    XML._setHead = {};\n    XML._setHead[id] = {}; //拦截处理响应回调\n\n    var _onreadystatechange = XML.onreadystatechange || function () {}; // start onreadystatechange\n\n\n    var onreadystatechange = function onreadystatechange() {\n      var item = _self.networkList[id] ? _self.networkList[id] : false; //如果不存在 可能略过了send 会导致丢失部分数据\n\n      if (!item) {\n        item = {}; //保存请求方法\n\n        item.method = method;\n\n        var _a = networkTool.handleReqUrl(XML._url),\n            url_1 = _a.url,\n            params = _a.params; //处理请求url和params\n\n\n        item.url = url_1;\n        item.params = params;\n      } //更新状态\n\n\n      item.status = 0;\n\n      if (XML.readyState > 1) {\n        item.status = XML.status;\n      }\n\n      item.responseType = XML.responseType; //判断请求状态\n\n      if (XML.readyState == 0) {\n        // 未开始\n        if (!item.startTime) {\n          item.startTime = +new Date();\n        }\n      } else if (XML.readyState == 1) {\n        // 打开\n        if (!item.startTime) {\n          item.startTime = +new Date();\n        }\n      } else if (XML.readyState == 2) {// 发送\t\t          \t\n      } else if (XML.readyState == 3) {//loading\n      } else if (XML.readyState == 4) {\n        //结束超时捕获\n        _self._handleTimeout(id); //处理响应头\n\n\n        item.responseHead = {};\n        var header = XML.getAllResponseHeaders() || '',\n            headerArr = header.split(\"\\n\"); //提取数据\n\n        for (var i = 0; i < headerArr.length; i++) {\n          var line = headerArr[i];\n\n          if (!line) {\n            continue;\n          }\n\n          var arr = line.split(': ');\n          var key = arr[0],\n              value = arr.slice(1).join(': ');\n          item.responseHead[key] = value;\n        } //完成\n\n\n        clearInterval(timer);\n        item.endTime = +new Date(), item.costTime = item.endTime - (item.startTime || item.endTime);\n        item.response = isCatchResponseContent ? XML.response : 'no-catch-responseContent'; //请求结束完成\n\n        setTimeout(function () {\n          //是否是超时接口 超时的接口不做处理\n          if (!_self.timeoutRequest[id]) {\n            _self._handleDoneXML(id);\n          }\n        });\n      } else {\n        clearInterval(timer);\n      } //如果这个接口已经超时处理了 那么不记录\n\n\n      if (!_self.timeoutRequest[id]) {\n        _self.networkList[id] = item;\n      }\n\n      return _onreadystatechange.apply(XML, arguments);\n    };\n\n    XML.onreadystatechange = onreadystatechange; //end onreadystatechange\n    //防止第三方库更改状态\n    //定时查看请求状态\n\n    var preState = -1;\n    timer = setInterval(function () {\n      if (preState != XML.readyState) {\n        preState = XML.readyState;\n        onreadystatechange.call(XML);\n      }\n    }, 10);\n    return _self._open.apply(XML, args);\n  }; //拦截原始设置请求头\n\n\n  window.XMLHttpRequest.prototype.setRequestHeader = function (header) {\n    var XML = this;\n    var args = index_1.Tools.toArray(arguments);\n\n    if (XML._id && XML._setHead) {\n      var setHead = XML._setHead[XML._id];\n      var key = args[0] ? args[0] : 'unkownRequestHead';\n      var value = args[1] ? args[1] : '';\n      setHead[key] = value;\n      XML._setHead[XML._id] = setHead;\n    }\n\n    return _self._setRequestHeader.apply(XML, args);\n  }; //拦截原生send\n\n\n  window.XMLHttpRequest.prototype.send = function () {\n    var XML = this;\n    var id = XML._id;\n\n    var method = XML._method.toUpperCase();\n\n    var requestHead = XML._setHead[id];\n    var url = XML._url;\n    var args = [].slice.call(arguments),\n        data = args[0],\n        saveData = ''; //监听列表中创建一条请求\n\n    if (!_self.networkList[id]) {\n      _self.networkList[id] = {};\n    } //type ajax\n\n\n    _self.networkList[id].type = 'ajax'; //保存请求方法\n\n    _self.networkList[id].method = method;\n\n    var _a = networkTool.handleReqUrl(url),\n        url = _a.url,\n        params = _a.params; //处理请求url和params\n\n\n    _self.networkList[id].url = url;\n    _self.networkList[id].params = params; //保存自定义请求头\n\n    if (requestHead) {\n      _self.networkList[id].requestHead = index_1.Tools.extend({}, requestHead);\n      delete XML._setHead[id];\n    } //如果是post数据保存\n\n\n    if (method === 'POST') {\n      if (index_1.Tools.isString(data)) {\n        saveData = data;\n      }\n    }\n\n    _self.networkList[id].body = saveData; //发送\n\n    _self._handleSendXML(id); //开启定时器 判断接口是否超时\n\n\n    _self._handleTimeout(id);\n\n    return _self._send.apply(XML, args);\n  };\n};\n/*\n    拦截fetch信息\n */\n\n\nexports._patchFetch = function () {\n  if (!window.fetch) {\n    return false;\n  }\n\n  var _self = this;\n\n  var isCatchResponseContent = _self._config.isCatchResponseContent;\n  _self._fetch = window.fetch; //https://developer.mozilla.org/zh-CN/docs/Web/API/WindowOrWorkerGlobalScope/fetch#%E5%8F%82%E6%95%B0\n\n  window.fetch = function (input, init) {\n    if (init === void 0) {\n      init = undefined;\n    }\n\n    var fetchSelf = this;\n    var args = arguments;\n    var id = index_1.Tools.getUniqueID();\n\n    if (!_self.networkList[id]) {\n      _self.networkList[id] = {};\n    }\n\n    var _a = networkTool.handleReqUrl(input.toString()),\n        url = _a.url,\n        params = _a.params; //处理请求url和params\n\n\n    _self.networkList[id].type = 'fetch';\n    _self.networkList[id].url = url;\n    _self.networkList[id].status = 0;\n    _self.networkList[id].params = params;\n\n    if (init && !index_1.Tools.isEmptyObject(init)) {\n      _self.networkList[id].method = init.method ? init.method.toUpperCase() : 'GET';\n      _self.networkList[id].body = init.body ? index_1.Tools.objectStringify(init.body) : '';\n      _self.networkList[id].requestHead = init.headers ? init.headers : undefined;\n    } else {\n      _self.networkList[id].method = 'GET';\n      _self.networkList[id].body = '';\n      _self.networkList[id].requestHead = undefined;\n    }\n\n    _self._handleSendXML(id);\n\n    return new Promise(function (resolve, reject) {\n      var promise;\n      var startTime = new Date().getTime();\n\n      var handleResponse = function handleResponse(response, content) {\n        _self.networkList[id].costTime = new Date().getTime() - startTime;\n        _self.networkList[id].response = isCatchResponseContent ? content : 'no-catch-responseContent';\n        _self.networkList[id].status = response ? response.status : 0 || 0;\n        var headers = index_1.Tools.toArray(response.headers.keys());\n\n        if (!index_1.Tools.isEmptyArray(headers)) {\n          _self.networkList[id].responseHead = {};\n          headers.forEach(function (key) {\n            _self.networkList[id].responseHead[key] = response.headers.get(key);\n          });\n        } else {\n          _self.networkList[id].responseHead = undefined;\n        }\n\n        _self.networkList[id].responseType = response.type;\n        setTimeout(function () {\n          //是否是超时接口 超时的接口不做处理\n          if (!_self.timeoutRequest[id]) {\n            _self._handleDoneXML(id);\n          }\n        });\n      };\n\n      try {\n        _self.networkList[id].startTime = startTime; //开启定时器 判断接口是否超时\n\n        _self._handleTimeout(id);\n\n        promise = _self._fetch.apply(fetchSelf, args);\n      } catch (error) {\n        _self.networkList[id].costTime = new Date().getTime() - startTime;\n        _self.networkList[id].response = 'fetch error:' + error;\n        _self.networkList[id].responseHead = '';\n        _self.networkList[id].responseType = 'error';\n        setTimeout(function () {\n          _self._handleDoneXML(id);\n        });\n        reject(error);\n        return;\n      }\n\n      promise.then(function (response) {\n        resolve(response.clone()); //结束超时捕获\n\n        _self._handleTimeout(id); //stream only\n\n\n        if (response.ok) {\n          response.text().then(function (content) {\n            handleResponse(response, content);\n          }, function (err) {\n            handleResponse(response, 'fetch response.text() error:' + err);\n          });\n        } else {\n          handleResponse(response, 'fetch error:' + response.statusText);\n        }\n      }, function (error) {\n        //结束超时捕获\n        _self._handleTimeout(id);\n\n        _self.networkList[id].costTime = new Date().getTime() - startTime;\n        _self.networkList[id].response = 'fetch error:' + error;\n        _self.networkList[id].responseHead = '';\n        _self.networkList[id].responseType = 'error';\n        setTimeout(function () {\n          //是否是超时接口 超时的接口不做处理\n          if (!_self.timeoutRequest[id]) {\n            _self._handleDoneXML(id);\n          }\n        });\n        reject(error);\n      });\n    });\n  };\n};\n/*\n    处理接口请求超时\n */\n\n\nexports._handleTimeout = function (id) {\n  var _self = this;\n\n  var timeout = _self._config.timeout;\n  var isTimeout = _self.timeoutRequest[id] ? _self.timeoutRequest[id] : false;\n  var time = _self.timeout[id] ? _self.timeout[id] : false;\n  var item = _self.networkList[id]; //如果不存在 不做处理\n\n  if (!item || isTimeout) {\n    return false;\n  }\n\n  if (!time) {\n    //如果没有那么创建检测超时定时器\n    time = setTimeout(function () {\n      //接口返回超时\n      item.isTimeout = true;\n      item.timeout = timeout;\n      item.isError = true;\n      item.errorContent = 'ajax request timeout，time:' + timeout + '(ms)';\n      item.response = item.response || 'ajax request timeout，time:' + timeout + '(ms)'; //这里直接完成添加到超时列表 停止后续处理\n\n      _self._handleDoneXML(id);\n\n      _self.timeoutRequest[id] = true;\n    }, timeout);\n  } else {\n    //如果存在 则说明已经回调 取消超时定时器\n    clearTimeout(time);\n  }\n};\n/*\n    处理请求完成的数据\n    @id:拦截请求唯一ID\n */\n\n\nexports._handleDoneXML = function (id) {\n  var _self = this;\n\n  var ajaxItem = index_1.Tools.extend({}, _self.networkList[id]); //空的对象不做处理\n\n  if (index_1.Tools.isEmptyObject(ajaxItem)) {\n    return false;\n  }\n\n  ajaxItem.statusType = 'response';\n  /******   这里开始处理数据  *****/\n  //判断当前请求数据url是否需要屏蔽\n\n  if (!this.isCatch || !_self._handleJudgeDisbale(ajaxItem)) {\n    delete _self.networkList[id];\n    return false;\n  } //判断状态码是否出错\n\n\n  var status = ajaxItem.status;\n\n  if (!networkTool.validateStatus(status) && !ajaxItem.isError) {\n    ajaxItem.isError = true;\n    ajaxItem.response = ajaxItem.response || 'ajax request error! error statusCode:' + (status || 0);\n    ajaxItem.errorContent = 'ajax request error! error statusCode:' + (status || 0);\n  } //通知上传\n\n\n  _self.sendMessage({\n    type: \"monitor\",\n    typeName: 'network',\n    data: ajaxItem,\n    isError: ajaxItem.isTimeout || ajaxItem.isError ? true : false\n  }); //上报后删除记录\n\n\n  delete _self.networkList[id];\n};\n/*\n    处理发送的请求\n    @id:拦截请求唯一ID\n */\n\n\nexports._handleSendXML = function (id) {\n  var _self = this;\n\n  var ajaxItem = index_1.Tools.extend({}, _self.networkList[id]); //空的对象不做处理\n\n  if (index_1.Tools.isEmptyObject(ajaxItem)) {\n    return false;\n  }\n\n  ajaxItem.statusType = 'request'; //判断当前请求数据url是否需要屏蔽\n\n  if (!this.isCatch || !_self._handleJudgeDisbale(ajaxItem)) {\n    delete _self.networkList[id];\n    return false;\n  } //通知上传\n\n\n  _self.sendMessage({\n    type: \"monitor\",\n    typeName: 'network',\n    data: ajaxItem\n  });\n};\n/*\n    判断该请求是否是屏蔽请求\n    params\n        ajaxInfo :即将上报的数据\n    return\n        忽略返回 false;\n        不忽略返回 true\n */\n\n\nexports._handleJudgeDisbale = function (ajaxInfo) {\n  var ignoreRequestList = this._config.ignoreRequestList; //判断是否是是屏蔽url\n\n  if (ignoreRequestList && !index_1.Tools.isEmptyArray(ignoreRequestList)) {\n    var url = ajaxInfo.url;\n    var unReport = false;\n    ignoreRequestList.forEach(function (item) {\n      if (url.indexOf(item) > -1) {\n        unReport = true;\n        return false;\n      }\n    });\n\n    if (unReport) {\n      return false;\n    }\n  }\n\n  return true;\n};\n\n/***/ }),\n\n/***/ \"./src/services/monitor/network/index.ts\":\n/*!***********************************************!*\\\n  !*** ./src/services/monitor/network/index.ts ***!\n  \\***********************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar defaultConfig_1 = __importDefault(__webpack_require__(/*! ./defaultConfig */ \"./src/services/monitor/network/defaultConfig.ts\"));\n\nvar index_1 = __webpack_require__(/*! @util/index */ \"@util/index\");\n\nvar api_1 = __webpack_require__(/*! ./api */ \"./src/services/monitor/network/api.ts\");\n\nvar handle_1 = __webpack_require__(/*! ./handle */ \"./src/services/monitor/network/handle.ts\"); // 获取系统信息\n\n\nvar KeepObserverNetwork =\n/** @class */\nfunction (_super) {\n  __extends(KeepObserverNetwork, _super); //构造函数\n\n\n  function KeepObserverNetwork(config) {\n    if (config === void 0) {\n      config = {};\n    }\n\n    var _this = _super.call(this, config) || this; //method\n\n\n    _this.stopObserver = api_1.stopObserver.bind(_this);\n    _this.startObserver = api_1.startObserver.bind(_this);\n    _this.cancelPatch = api_1.cancelPatch.bind(_this);\n    _this._init = handle_1._init.bind(_this);\n    _this._patchXMLAjax = handle_1._patchXMLAjax.bind(_this);\n    _this._patchFetch = handle_1._patchFetch.bind(_this);\n    _this._handleTimeout = handle_1._handleTimeout.bind(_this);\n    _this._handleDoneXML = handle_1._handleDoneXML.bind(_this);\n    _this._handleSendXML = handle_1._handleSendXML.bind(_this);\n    _this._handleJudgeDisbale = handle_1._handleJudgeDisbale.bind(_this); //存混合配置\n\n    var _a = config,\n        _b = _a.networkCustom,\n        networkCustom = _b === void 0 ? false : _b,\n        _c = _a.reportCustom,\n        reportCustom = _c === void 0 ? false : _c;\n    var reportUrl = reportCustom && reportCustom.reportUrl ? reportCustom.reportUrl : [];\n    var networkConfig = index_1.Tools.extend({\n      reportUrl: reportUrl\n    }, networkCustom || config);\n    _this._config = index_1.Tools.extend(__assign({}, defaultConfig_1[\"default\"]), networkConfig);\n    _this._config.ignoreRequestList = _this._config.ignoreRequestList.concat(reportUrl); //kabanaApm serverUrl\n\n    if (_this._config.serverUrl) {\n      _this._config.ignoreRequestList.push(_this._config.serverUrl);\n    } //是否开启捕获\n\n\n    _this.isCatch = false; //监控的数据列表\n\n    _this.networkList = {}; //辅助捕获超时\n\n    _this.timeout = {};\n    _this.timeoutRequest = {}; // 发送消息\n\n    _this.sendMessage = function () {\n      return index_1.consoleTools.warnError('sendMessage is not active, apply receive sendPipeMessage fail ');\n    }; // 开启网络拦截监控\n\n\n    _this._init();\n\n    return _this;\n  } //提供一个挂载入口\n\n\n  KeepObserverNetwork.prototype.apply = function (_a) {\n    var sendMessage = _a.sendMessage;\n    var automaticStart = this._config.automaticStart;\n    this.sendMessage = sendMessage; //开启捕获\n\n    if (automaticStart) {\n      this.startObserver();\n    }\n\n    return {\n      networkStop: this.stopObserver,\n      networkStart: this.startObserver,\n      networkCancelPatch: this.cancelPatch\n    };\n  };\n\n  return KeepObserverNetwork;\n}(index_1.KeepObserverPublic);\n\nexports[\"default\"] = KeepObserverNetwork;\n\n/***/ }),\n\n/***/ \"./src/services/monitor/network/tool.ts\":\n/*!**********************************************!*\\\n  !*** ./src/services/monitor/network/tool.ts ***!\n  \\**********************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n/*\n    处理URL\n    分离base url 和params\n    @return {\n        url:  string\n        params: object or string('')\n    }\n */\n\nvar __values = this && this.__values || function (o) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator],\n      i = 0;\n  if (m) return m.call(o);\n  return {\n    next: function next() {\n      if (o && i >= o.length) o = void 0;\n      return {\n        value: o && o[i++],\n        done: !o\n      };\n    }\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nfunction handleReqUrl(url) {\n  var e_1, _a; //处理下解码URL\n\n\n  url = window.decodeURIComponent(url);\n  var params = '';\n  var baseUrl = ''; //判断URL后面是否存在参数\n\n  if (url.indexOf('?') === -1) {\n    baseUrl = url;\n  } else {\n    var query = url.indexOf('?');\n    baseUrl = url.substring(0, query);\n    query = url.substring(query + 1, url.length);\n    params = {};\n    query = query.split('&'); // => ['b=c', 'd=?e']\n\n    try {\n      for (var query_1 = __values(query), query_1_1 = query_1.next(); !query_1_1.done; query_1_1 = query_1.next()) {\n        var q = query_1_1.value;\n        q = q.split('=');\n        params[q[0]] = q[1];\n      }\n    } catch (e_1_1) {\n      e_1 = {\n        error: e_1_1\n      };\n    } finally {\n      try {\n        if (query_1_1 && !query_1_1.done && (_a = query_1[\"return\"])) _a.call(query_1);\n      } finally {\n        if (e_1) throw e_1.error;\n      }\n    }\n  }\n\n  return {\n    url: baseUrl,\n    params: params\n  };\n}\n\nexports.handleReqUrl = handleReqUrl;\n/*\n    检查状态码是否正确\n */\n\nfunction validateStatus(status) {\n  return status >= 200 && status < 300;\n}\n\nexports.validateStatus = validateStatus;\n\n/***/ }),\n\n/***/ \"@util/index\":\n/*!******************************!*\\\n  !*** external \"@util/index\" ***!\n  \\******************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\nmodule.exports = __WEBPACK_EXTERNAL_MODULE__util_index__;\n\n/***/ })\n\n/******/ });\n});","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"@util/index\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"@util/index\"], factory);\n\telse {\n\t\tvar a = typeof exports === 'object' ? factory(require(\"@util/index\")) : factory(root[\"@util/index\"]);\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(window, function(__WEBPACK_EXTERNAL_MODULE__util_index__) {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// define __esModule on exports\n/******/ \t__webpack_require__.r = function(exports) {\n/******/ \t\tObject.defineProperty(exports, '__esModule', { value: true });\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = \"./src/services/monitor/log/index.ts\");\n/******/ })\n/************************************************************************/\n/******/ ({\n\n/***/ \"./src/services/monitor/log/api.ts\":\n/*!*****************************************!*\\\n  !*** ./src/services/monitor/log/api.ts ***!\n  \\*****************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar index_1 = __webpack_require__(/*! @util/index */ \"@util/index\");\n/*\n    停止监听\n */\n\n\nexports.stopObserver = function () {\n  if (!this.console || this.console && index_1.Tools.isEmptyObject(this.console)) {\n    return this.console = null;\n  }\n\n  window.console.log = this.console.log;\n  window.console.error = this.console.error;\n  window.console.info = this.console.info;\n  window.console.debug = this.console.debug;\n  window.console.warn = this.console.warn;\n  window.console.time = this.console.time;\n  window.console.timeEnd = this.console.timeEnd;\n  window.console.clear = this.console.clear;\n  this.console = null;\n};\n/*\n    开始监听\n */\n\n\nexports.startObserver = function () {\n  var _this = this;\n\n  if (this.console) {\n    return;\n  }\n\n  this.console = {};\n  setTimeout(function () {\n    //启动监听\n    if (!index_1.Tools.isEmptyObject(_this.console) || !_this.console) {\n      return;\n    }\n\n    _this._handleInit();\n  });\n};\n\n/***/ }),\n\n/***/ \"./src/services/monitor/log/defaultConfig.ts\":\n/*!***************************************************!*\\\n  !*** ./src/services/monitor/log/defaultConfig.ts ***!\n  \\***************************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n/*\n \n    observer log 实例默认配置数据\n */\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = {\n  //是否打印输出\n  isPrint: true,\n  //是否自动开始上报\n  automaticStart: true\n};\n\n/***/ }),\n\n/***/ \"./src/services/monitor/log/handle.ts\":\n/*!********************************************!*\\\n  !*** ./src/services/monitor/log/handle.ts ***!\n  \\********************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) {\n      ar.push(r.value);\n    }\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nvar __spread = this && this.__spread || function () {\n  for (var ar = [], i = 0; i < arguments.length; i++) {\n    ar = ar.concat(__read(arguments[i]));\n  }\n\n  return ar;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar index_1 = __webpack_require__(/*! @util/index */ \"@util/index\");\n/*\n    初始化替换相关信息\n*/\n\n\nexports._handleInit = function () {\n  var _self = this;\n\n  var isPrint = this._config.isPrint; //替换window.console变量\n\n  var baseLogList = ['log', 'info', 'warn', 'debug', 'error'];\n  _self.console = {};\n\n  if (!window.console) {\n    window.console = {};\n  }\n\n  baseLogList.map(function (method) {\n    _self.console[method] = window.console[method];\n  });\n  _self.console.time = window.console.time;\n  _self.console.timeEnd = window.console.timeEnd;\n  _self.console.clear = window.console.clear;\n  baseLogList.map(function (method) {\n    window.console[method] = function () {\n      var args = [];\n\n      for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n      }\n\n      var _a; //是否打印\n\n\n      if (isPrint && _self.console[method] && index_1.Tools.isFunction(_self.console[method])) {\n        (_a = _self.console)[method].apply(_a, __spread(args));\n      } //交给拦截处理信息\n\n\n      _self._handleMessage(method, args);\n    };\n  }); //处理time timeEnd clear\n\n  var timeLog = {};\n\n  window.console.time = function (label) {\n    timeLog[label] = Date.now();\n  };\n\n  window.console.timeEnd = function (label) {\n    var pre = timeLog[label];\n    var type = 'timeEnd';\n\n    if (pre) {\n      var content = label + ':' + (Date.now() - pre) + 'ms';\n\n      _self._handleMessage(type, [content]); //是否打印\n\n\n      if (isPrint && _self.console.log && index_1.Tools.isFunction(_self.console.log)) {\n        _self.console.log(content);\n      }\n    } else {\n      var content = label + ': 0ms';\n\n      _self._handleMessage(type, [content]); //是否打印\n\n\n      if (isPrint && _self.console.log && index_1.Tools.isFunction(_self.console.log)) {\n        _self.console.log(content);\n      }\n    }\n  };\n\n  window.console.clear = function () {\n    var args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      args[_i] = arguments[_i];\n    }\n\n    _self._handleMessage('clear', args);\n\n    _self.console.clear.apply(window.console, args);\n  };\n};\n/*\n    处理打印信息\n    上报报文如下\n    @: type string  (log|info|debug.... jsError)\n    @: data string  (JSON格式对象报文)\n */\n\n\nexports._handleMessage = function (type, agrs) {\n  var _self = this;\n\n  var reportData = {\n    type: '',\n    data: ''\n  };\n  var separate = ',';\n  var data = '['; //agrs不是数组 或是空数组 则不处理\n\n  if (!index_1.Tools.isArray(agrs) || agrs.length === 0) {\n    return false;\n  }\n\n  reportData.type = type; //直接转成字符串形式\n\n  agrs.forEach(function (el, index) {\n    try {\n      if (index_1.Tools.isObject(el) || index_1.Tools.isArray(el)) {\n        data += \"\" + (index === 0 ? '' : separate) + index_1.Tools.objectStringify(el);\n      } else {\n        data += (index === 0 ? '' : separate) + \"\\\"\" + index_1.Tools.toString(el) + \"\\\"\";\n      }\n    } catch (err) {\n      data += (index === 0 ? '' : separate) + \"\\\"toString is err:\" + index_1.Tools.toString(err).replace(/[\\s\\r\\n\\t]/g, '') + \"\\\"\";\n    }\n  });\n  data += ']';\n  reportData.data = data; //上报\n\n  _self.sendMessage({\n    type: \"monitor\",\n    typeName: 'log',\n    data: reportData\n  });\n};\n\n/***/ }),\n\n/***/ \"./src/services/monitor/log/index.ts\":\n/*!*******************************************!*\\\n  !*** ./src/services/monitor/log/index.ts ***!\n  \\*******************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar defaultConfig_1 = __importDefault(__webpack_require__(/*! ./defaultConfig */ \"./src/services/monitor/log/defaultConfig.ts\"));\n\nvar index_1 = __webpack_require__(/*! @util/index */ \"@util/index\");\n\nvar api_1 = __webpack_require__(/*! ./api */ \"./src/services/monitor/log/api.ts\");\n\nvar handle_1 = __webpack_require__(/*! ./handle */ \"./src/services/monitor/log/handle.ts\"); // 获取系统信息\n\n\nvar KeepObserverLog =\n/** @class */\nfunction (_super) {\n  __extends(KeepObserverLog, _super); //构造函数\n\n\n  function KeepObserverLog(config) {\n    if (config === void 0) {\n      config = {};\n    }\n\n    var _this = _super.call(this, config) || this; //method\n\n\n    _this._handleInit = handle_1._handleInit.bind(_this);\n    _this._handleMessage = handle_1._handleMessage.bind(_this);\n    _this.stopObserver = api_1.stopObserver.bind(_this);\n    _this.startObserver = api_1.startObserver.bind(_this); //初始化上传相关实例\n\n    var _a = config,\n        _b = _a.logCustom,\n        logCustom = _b === void 0 ? false : _b,\n        _c = _a.develop,\n        develop = _c === void 0 ? false : _c;\n    var logConfig = logCustom || config; //存混合配置\n\n    _this._config = index_1.Tools.extend(__assign({}, defaultConfig_1[\"default\"]), __assign({}, logConfig, {\n      develop: develop\n    })); //替换window.console\n\n    _this.console = null; //发送方法\n\n    _this.sendMessage = function () {\n      return index_1.consoleTools.warnError('sendMessage is not active, apply receive sendPipeMessage fail ');\n    };\n\n    return _this;\n  } //提供一个挂载入口\n\n\n  KeepObserverLog.prototype.apply = function (_a) {\n    var sendMessage = _a.sendMessage;\n    var automaticStart = this._config.automaticStart;\n    this.sendMessage = sendMessage; //启动监控\n\n    if (automaticStart) {\n      this.startObserver();\n    }\n\n    return {\n      logStop: this.stopObserver,\n      logStart: this.startObserver\n    };\n  };\n\n  return KeepObserverLog;\n}(index_1.KeepObserverPublic);\n\nexports[\"default\"] = KeepObserverLog;\n\n/***/ }),\n\n/***/ \"@util/index\":\n/*!******************************!*\\\n  !*** external \"@util/index\" ***!\n  \\******************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\nmodule.exports = __WEBPACK_EXTERNAL_MODULE__util_index__;\n\n/***/ })\n\n/******/ });\n});","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"@util/index\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"@util/index\"], factory);\n\telse {\n\t\tvar a = typeof exports === 'object' ? factory(require(\"@util/index\")) : factory(root[\"@util/index\"]);\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(window, function(__WEBPACK_EXTERNAL_MODULE__util_index__) {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// define __esModule on exports\n/******/ \t__webpack_require__.r = function(exports) {\n/******/ \t\tObject.defineProperty(exports, '__esModule', { value: true });\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = \"./src/instance/index.ts\");\n/******/ })\n/************************************************************************/\n/******/ ({\n\n/***/ \"./src/constants/index.ts\":\n/*!********************************!*\\\n  !*** ./src/constants/index.ts ***!\n  \\********************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n}); //上报数据类型\n\nexports.reportType = ['unKownType', 'log', 'network', 'vue']; //版本号\n\nexports.version = '2.0.0-beta.1'; //公共中间件\n\nexports.publicMiddleScopeNames = ['sendMessage', 'error'];\n\n/***/ }),\n\n/***/ \"./src/instance/defaultConfig.ts\":\n/*!***************************************!*\\\n  !*** ./src/instance/defaultConfig.ts ***!\n  \\***************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n/*\n    keepObserver 默认配置\n*/\n\nvar index_1 = __webpack_require__(/*! @util/index */ \"@util/index\");\n\nvar index_2 = __webpack_require__(/*! ../constants/index */ \"./src/constants/index.ts\");\n\nexports[\"default\"] = {\n  //更新版本是否清除缓存\n  updateVersionClearCache: false,\n  //kibana apm\n  projectName: \"\",\n  projectVersion: \"\",\n  version: index_2.version,\n  //唯一设备id\n  deviceID: index_1.getDeviceId(),\n  //是否检查重复注入\n  //这个主要用在jasmine spyOn 以及UglifyJS  class = n o a b c ..可能出现的问题\n  isCheckRepeatUse: true\n};\n\n/***/ }),\n\n/***/ \"./src/instance/index.ts\":\n/*!*******************************!*\\\n  !*** ./src/instance/index.ts ***!\n  \\*******************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar index_1 = __webpack_require__(/*! @util/index */ \"@util/index\");\n\nvar defaultConfig_1 = __importDefault(__webpack_require__(/*! ./defaultConfig */ \"./src/instance/defaultConfig.ts\"));\n\nvar index_2 = __importDefault(__webpack_require__(/*! ./pipe/index */ \"./src/instance/pipe/index.ts\"));\n\nexports.keepObserverPipe = index_2[\"default\"];\n\nvar index_3 = __importDefault(__webpack_require__(/*! ./pipe/PipeUser/index */ \"./src/instance/pipe/PipeUser/index.ts\"));\n\nexports.PipeUser = index_3[\"default\"];\n\nvar index_4 = __importDefault(__webpack_require__(/*! ./pipe/WatchDog/index */ \"./src/instance/pipe/WatchDog/index.ts\"));\n\nexports.WatchDog = index_4[\"default\"];\n\nvar index_5 = __importDefault(__webpack_require__(/*! ./pipe/MQ/index */ \"./src/instance/pipe/MQ/index.ts\"));\n\nexports.MessageQueue = index_5[\"default\"];\n\nvar update_1 = __webpack_require__(/*! ./method/update */ \"./src/instance/method/update.ts\");\n\nvar api_1 = __webpack_require__(/*! ./method/api */ \"./src/instance/method/api.ts\");\n\nvar middle_1 = __webpack_require__(/*! ./method/middle */ \"./src/instance/method/middle.ts\");\n\nvar base_1 = __webpack_require__(/*! ./method/base */ \"./src/instance/method/base.ts\");\n\nvar KeepObserver =\n/** @class */\nfunction (_super) {\n  __extends(KeepObserver, _super);\n\n  function KeepObserver(config) {\n    if (config === void 0) {\n      config = {};\n    }\n\n    var _this = _super.call(this, config = index_1.Tools.extend(__assign({}, defaultConfig_1[\"default\"]), config)) || this; //method\n\n\n    _this.updateVersionClearCache = update_1.updateVersionClearCache.bind(_this);\n    _this.registerApi = api_1.registerApi.bind(_this); //api\n\n    _this.apis = api_1.apis.bind(_this); //主实例重载中间件服务\n\n    _this.useMiddle = middle_1.useMiddle.bind(_this);\n    _this.getRunMiddle = middle_1.getRunMiddle.bind(_this); //扩展上报属性\n\n    _this.extendReportParams = base_1.extendReportParams.bind(_this); //挂载插件服务\n\n    _this.use = base_1.use.bind(_this); //获取实例配置\n\n    _this._config = config; //管道实例\n\n    _this._pipe = new index_2[\"default\"](_this, _this._config); //扩展上报内容\n\n    var _a = _this._config,\n        projectName = _a.projectName,\n        projectVersion = _a.projectVersion,\n        version = _a.version;\n\n    _this.extendReportParams({\n      projectName: projectName,\n      projectVersion: projectVersion,\n      version: version\n    }); //扩展中间件\n\n\n    _this.middleScopeNames = _this.middleScopeNames.concat(_this._publicMiddleScopeNames); //是否需要更新版本清除缓存\n\n    if (_this._config.projectVersion && _this._config.updateVersionClearCache) {\n      _this.updateVersionClearCache();\n    }\n\n    return _this;\n  }\n\n  return KeepObserver;\n}(index_1.KeepObserverPublic);\n\nexports[\"default\"] = KeepObserver;\n\n/***/ }),\n\n/***/ \"./src/instance/method/api.ts\":\n/*!************************************!*\\\n  !*** ./src/instance/method/api.ts ***!\n  \\************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) {\n      ar.push(r.value);\n    }\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nvar __spread = this && this.__spread || function () {\n  for (var ar = [], i = 0; i < arguments.length; i++) {\n    ar = ar.concat(__read(arguments[i]));\n  }\n\n  return ar;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar index_1 = __webpack_require__(/*! @util/index */ \"@util/index\");\n\nexports.registerApi = function (apiName, cb) {\n  var _self = this;\n\n  if (_self.apis[apiName]) {\n    return index_1.consoleTools.warnError(\"apiName:\" + apiName + \" is defined\");\n  }\n\n  _self.apis[apiName] = cb;\n};\n\nexports.apis = function (apiName) {\n  var args = [];\n\n  for (var _i = 1; _i < arguments.length; _i++) {\n    args[_i - 1] = arguments[_i];\n  }\n\n  var _self = this;\n\n  if (!_self.apis[apiName]) {\n    var errorMsg = \"apiName:\" + apiName + \" is undefined\";\n    index_1.consoleTools.warnError(errorMsg);\n    return _self.runMiddle('error', errorMsg);\n  }\n\n  var callback = _self.apis[apiName];\n  var res = null;\n\n  try {\n    var res = callback.apply(void 0, __spread(args));\n  } catch (e) {\n    var errorMsg = \"apiName:\" + apiName + \" is run find error:\" + e;\n    index_1.consoleTools.warnError(errorMsg);\n\n    _self.runMiddle('error', errorMsg);\n  }\n\n  return res;\n};\n\n/***/ }),\n\n/***/ \"./src/instance/method/base.ts\":\n/*!*************************************!*\\\n  !*** ./src/instance/method/base.ts ***!\n  \\*************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar index_1 = __webpack_require__(/*! @util/index */ \"@util/index\"); //扩展上报属性\n\n\nexports.extendReportParams = function (params) {\n  return index_1.KeepObserverPublic.extendReport(params);\n}; //挂载插件服务\n\n\nexports.use = function (Provider) {\n  return this._pipe.use(Provider);\n};\n\n/***/ }),\n\n/***/ \"./src/instance/method/middle.ts\":\n/*!***************************************!*\\\n  !*** ./src/instance/method/middle.ts ***!\n  \\***************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar index_1 = __webpack_require__(/*! @util/index */ \"@util/index\"); //主实例重载中间件服务\n\n\nexports.useMiddle = function (scopeName, middlesFn) {\n  if (this.middleScopeNames.indexOf(scopeName) === -1) {\n    this.middleScopeNames.push(scopeName);\n  }\n\n  return index_1.KeepObserverMiddleWare.usePublishMiddles(scopeName, middlesFn);\n}; //当前正在运行的中间件实例\n\n\nexports.getRunMiddle = function () {\n  return index_1.KeepObserverMiddleWare.currentRunMiddle;\n};\n\n/***/ }),\n\n/***/ \"./src/instance/method/update.ts\":\n/*!***************************************!*\\\n  !*** ./src/instance/method/update.ts ***!\n  \\***************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar index_1 = __webpack_require__(/*! @util/index */ \"@util/index\");\n\nvar updateVersionRecordKey = 'versionRecord';\nvar keepObserverRecordReg = /^keepObserverData/i;\n\nexports.updateVersionClearCache = function () {\n  var oldVersion = index_1.Tools.getStorage(updateVersionRecordKey);\n\n  if (!this._config.projectVersion || this._config.projectVersion === oldVersion) {\n    return false;\n  }\n\n  if (!window.localStorage) {\n    return false;\n  }\n\n  for (var key in window.localStorage) {\n    if (keepObserverRecordReg.test(key)) {\n      localStorage.removeItem(key);\n      this.$devWarn('[keepObserver] updateVersionRecord key:' + key);\n    }\n  }\n\n  index_1.Tools.setStorage(updateVersionRecordKey, this._config.projectVersion);\n};\n\n/***/ }),\n\n/***/ \"./src/instance/pipe/MQ/index.ts\":\n/*!***************************************!*\\\n  !*** ./src/instance/pipe/MQ/index.ts ***!\n  \\***************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar triggerQueue_1 = __webpack_require__(/*! ./triggerQueue */ \"./src/instance/pipe/MQ/triggerQueue.ts\");\n\nvar receiveQueue_1 = __webpack_require__(/*! ./receiveQueue */ \"./src/instance/pipe/MQ/receiveQueue.ts\");\n\nvar MessageQueue =\n/** @class */\nfunction () {\n  function MessageQueue(config, $pipe) {\n    //method\n    this.noticeListener = triggerQueue_1.noticeListener.bind(this);\n    this.sendPipeMessage = triggerQueue_1.sendPipeMessage.bind(this);\n    this.registerRecivePipeMessage = receiveQueue_1.registerRecivePipeMessage.bind(this); //消息是否在执行\n\n    this.isRun = false; //消息队列\n\n    this.messageQueue = []; //管道实例\n\n    this.$pipe = $pipe; //消费者集合\n\n    this.consumerMap = {};\n  }\n\n  return MessageQueue;\n}();\n\nexports[\"default\"] = MessageQueue;\n\n/***/ }),\n\n/***/ \"./src/instance/pipe/MQ/receiveQueue.ts\":\n/*!**********************************************!*\\\n  !*** ./src/instance/pipe/MQ/receiveQueue.ts ***!\n  \\**********************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar index_1 = __webpack_require__(/*! @util/index */ \"@util/index\"); //注册管道接收数据函数\n\n\nexports.registerRecivePipeMessage = function (id, scope) {\n  var _self = this; //修正索引\n\n\n  if (_self.consumerMap[id]) {\n    var errMsg = 'register recive pipe index is Occupy';\n    index_1.consoleTools.warnError(errMsg);\n\n    _self.$pipe.$keepObserver.runMiddle('error', errMsg);\n\n    return false;\n  } //返回一个闭包函数用来接收注册函数\n\n\n  return function (fn) {\n    //接收函数\n    if (!fn || !index_1.Tools.isFunction(fn)) {\n      var errMsg = 'registerRecivePipeMessage method receive function is not right';\n      index_1.consoleTools.warnError(errMsg);\n\n      _self.$pipe.$keepObserver.runMiddle('error', errMsg);\n\n      return;\n    } //内部修改作用域调用\n\n\n    _self.consumerMap[id] = function () {\n      var agrs = index_1.Tools.toArray(arguments); //向注册进来的接收函数发送数据\n\n      return fn.apply(scope, agrs);\n    };\n  };\n};\n\n/***/ }),\n\n/***/ \"./src/instance/pipe/MQ/triggerQueue.ts\":\n/*!**********************************************!*\\\n  !*** ./src/instance/pipe/MQ/triggerQueue.ts ***!\n  \\**********************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar index_1 = __webpack_require__(/*! @util/index */ \"@util/index\"); //发送消息在管道内流通\n\n\nexports.sendPipeMessage = function (id, params) {\n  var _self = this;\n\n  var msgItem = {\n    id: id,\n    params: params\n  };\n  return new Promise(function (res, rej) {\n    //如果正在执行\n    if (_self.isRun) {\n      return rej(false);\n    } //是否消息队列加锁,并且防止异常消息\n    //进入消息队列\n\n\n    _self.messageQueue.push(msgItem); //异步执行消息队列分发\n\n\n    setTimeout(function () {\n      //获取消息队列数组快照\n      var queue = _self.messageQueue.map(function (e) {\n        return e;\n      }); //清空队列\n\n\n      _self.messageQueue = []; //通知监听\n\n      _self.noticeListener(queue).then(res, res);\n    });\n  });\n}; //通知监听\n\n\nexports.noticeListener = function (queue) {\n  var _self = this;\n\n  if (!index_1.Tools.isArray(queue) || queue.length === 0) {\n    return Promise.reject();\n  } //接收消息进入等待状态\n\n\n  _self.isRun = true; //分发处理消息\n\n  return Promise.all(queue.map(function (item) {\n    var id = item.id,\n        params = item.params; //消息分发\n\n    return Promise.all(index_1.Tools.mapToArray(_self.consumerMap, function (cb, pipeId) {\n      //id修正\n      pipeId = !index_1.Tools.isNumber(pipeId) ? parseInt(pipeId) : false;\n\n      if (!index_1.Tools.isNumber(pipeId)) {\n        return false;\n      } //判断是否是正确注册接收函数\n\n\n      if (!index_1.Tools.isFunction(cb)) {\n        return false;\n      } //不允许自发自收\n\n\n      if (id === pipeId) {\n        return false;\n      } //分发\n\n\n      try {\n        //执行分发\n        return cb(params) || Promise.resolve();\n      } catch (e) {\n        var errMsg = 'handle message is runing error:' + e;\n        index_1.consoleTools.warnError(errMsg);\n\n        _self.$pipe.$keepObserver.runMiddle('error', errMsg);\n      }\n    }));\n  }))[\"finally\"](function () {\n    //执行状态结束，放到下个阶段，屏蔽处理阶段立即发起的消息\n    _self.isRun = false;\n  });\n};\n\n/***/ }),\n\n/***/ \"./src/instance/pipe/PipeUser/index.ts\":\n/*!*********************************************!*\\\n  !*** ./src/instance/pipe/PipeUser/index.ts ***!\n  \\*********************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __read = this && this.__read || function (o, n) {\n  var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n  if (!m) return o;\n  var i = m.call(o),\n      r,\n      ar = [],\n      e;\n\n  try {\n    while ((n === void 0 || n-- > 0) && !(r = i.next()).done) {\n      ar.push(r.value);\n    }\n  } catch (error) {\n    e = {\n      error: error\n    };\n  } finally {\n    try {\n      if (r && !r.done && (m = i[\"return\"])) m.call(i);\n    } finally {\n      if (e) throw e.error;\n    }\n  }\n\n  return ar;\n};\n\nvar __spread = this && this.__spread || function () {\n  for (var ar = [], i = 0; i < arguments.length; i++) {\n    ar = ar.concat(__read(arguments[i]));\n  }\n\n  return ar;\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar index_1 = __webpack_require__(/*! @util/index */ \"@util/index\");\n\nvar index_2 = __webpack_require__(/*! @util/index */ \"@util/index\");\n\nvar index_3 = __importDefault(__webpack_require__(/*! ../WatchDog/index */ \"./src/instance/pipe/WatchDog/index.ts\"));\n\nvar PipeUser =\n/** @class */\nfunction (_super) {\n  __extends(PipeUser, _super);\n\n  function PipeUser(index, $pipe, scope) {\n    var _this = _super.call(this) || this; //index\n\n\n    _this.pipeIndex = index; //register watchDog\n\n    var $watchDog = new index_3[\"default\"](); //provide sendMessage\n\n    _this.sendMessage = $watchDog.sendMessageLimtWatch(\n    /* watch fn */\n    function (catchParams, contendHashCode) {\n      //mq handle process message ignore\n      if ($pipe.$mq.isRun) return Promise.reject('mq handle process message ignore'); //send message\n\n      var isError = true;\n\n      var _a = __read($pipe._publicMiddleScopeNames, 1),\n          sendMessage = _a[0];\n\n      var reportParams = _this.handleReportData(__assign({}, catchParams, {\n        contendHashCode: contendHashCode\n      })); //  1 -> 2 -> 3 -> 2 -> 1\n\n\n      return _this.runMiddle(sendMessage, reportParams).then(function (middleReportParams) {\n        isError = false;\n\n        if (!middleReportParams) {\n          _this.constructor.emitSendDoneCallback();\n\n          return false;\n        }\n\n        index_2.consoleTools.devLog($pipe._develop, middleReportParams);\n        $pipe.$mq.sendPipeMessage(index, middleReportParams).then(function () {\n          _this.constructor.emitSendDoneCallback();\n        });\n      }) //check middle exec error\n      [\"finally\"](function () {\n        if (isError) {\n          index_2.consoleTools.devLog($pipe._develop, reportParams);\n          $pipe.$mq.sendPipeMessage(index, reportParams).then(function () {\n            _this.constructor.emitSendDoneCallback();\n          });\n        }\n      });\n    },\n    /* anomaly callback */\n    function (anomalyMessage) {\n      return $pipe.$keepObserver.runMiddle('error', anomalyMessage);\n    }); //extend middle\n\n    _this.runExtendMiddle = function (scopeName) {\n      var args = [];\n\n      for (var _i = 1; _i < arguments.length; _i++) {\n        args[_i - 1] = arguments[_i];\n      }\n\n      var _a;\n\n      return (_a = $pipe.$keepObserver).runMiddle.apply(_a, __spread([scopeName], args));\n    };\n\n    _this.useExtendMiddle = function (scopeName, middlesFn) {\n      return $pipe.$keepObserver.useMiddle(scopeName, middlesFn);\n    }; //extend report params\n\n\n    _this.extendsReportParams = function (params) {\n      return $pipe.$keepObserver.extendReportParams(params);\n    }; //provide reciveMessage \n\n\n    _this.registerReciveMessage = $pipe.$mq.registerRecivePipeMessage(index, scope); //register send done callback\n\n    _this.registerSendDoneCallback = function (callback) {\n      _this.constructor.onSendDoneCallbackMap.push(callback);\n    };\n\n    return _this;\n  }\n\n  PipeUser.onSendDoneCallbackMap = [];\n\n  PipeUser.emitSendDoneCallback = function () {\n    this.onSendDoneCallbackMap.forEach(function (fn) {\n      try {\n        fn();\n      } catch (e) {\n        index_2.consoleTools.warnError(\"emitSendDoneCallback find error:\" + e);\n      }\n    });\n  };\n\n  return PipeUser;\n}(index_1.KeepObserverPublic);\n\nexports[\"default\"] = PipeUser;\n\n/***/ }),\n\n/***/ \"./src/instance/pipe/WatchDog/index.ts\":\n/*!*********************************************!*\\\n  !*** ./src/instance/pipe/WatchDog/index.ts ***!\n  \\*********************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar index_1 = __webpack_require__(/*! @util/index */ \"@util/index\");\n\nvar WatchDog =\n/** @class */\nfunction () {\n  function WatchDog(config) {\n    if (config === void 0) {\n      config = {};\n    }\n\n    this._config = config;\n  } //api\n\n\n  WatchDog.prototype.sendMessageLimtWatch = function (fn, anomalyCallback) {\n    var anomaly = false;\n    var receiveCount = 1;\n    var countBuff = {};\n    var resetCountFn = index_1.Tools.debounceWrap(1000)(function () {\n      countBuff = {}, receiveCount = 1;\n    });\n    var resetAnomaly = index_1.Tools.throttleWrap(3000)(function () {\n      anomaly = false;\n    });\n\n    var limtJudgeAnomaly = function limtJudgeAnomaly(count, catchParams, anomalyCallback) {\n      //启动定时器每秒恢复一次计数\n      resetCountFn();\n\n      if (++receiveCount > 50) {\n        var msg = 'send  Message during 1000ms in Over 50 times,maybe Anomaly';\n        index_1.consoleTools.warnError(msg, catchParams);\n        anomalyCallback(msg);\n        return false;\n      } //重复技术统计\n\n\n      if (count === 10) {\n        var msg = 'send  Message during 1000ms in Over 10 times,maybe Anomaly';\n        index_1.consoleTools.warnError(msg, catchParams);\n        anomalyCallback(msg);\n        return false;\n      }\n\n      if (count > 20) {\n        var msg = 'send  Message during 1000ms in Over 20 times,maybe happend Endless loop';\n        index_1.consoleTools.warnError(msg, catchParams);\n        anomalyCallback(msg);\n        return true;\n      }\n\n      return false;\n    };\n\n    var watchWrap = function watchWrap(catchParams) {\n      var _a = catchParams || {},\n          _b = _a.isIgnoreSendRepeat,\n          isIgnoreSendRepeat = _b === void 0 ? false : _b,\n          _c = _a.type,\n          type = _c === void 0 ? \"undefined\" : _c,\n          _d = _a.typeName,\n          typeName = _d === void 0 ? \"undefined\" : _d,\n          _e = _a.data,\n          data = _e === void 0 ? {} : _e; //contendHashCode 本来不放这里的，但是因为要做校验，所以在这里生产 后面就不生成了\n\n\n      var contendHashCode = index_1.Tools.getHashCode(data);\n      var key = isIgnoreSendRepeat ? 'ignore' : type + \"_\" + typeName + \"_\" + contendHashCode;\n      var count = countBuff[key] ? ++countBuff[key] : countBuff[key] = 1;\n      anomaly = !anomaly ? limtJudgeAnomaly(count, catchParams, anomalyCallback) : true;\n\n      if (anomaly) {\n        resetAnomaly();\n        return Promise.reject('send  Message during 1000ms in Over 20 times,maybe happend Endless loop');\n      }\n\n      return fn(catchParams, contendHashCode);\n    };\n\n    return watchWrap;\n  };\n\n  return WatchDog;\n}();\n\nexports[\"default\"] = WatchDog;\n\n/***/ }),\n\n/***/ \"./src/instance/pipe/index.ts\":\n/*!************************************!*\\\n  !*** ./src/instance/pipe/index.ts ***!\n  \\************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar index_1 = __webpack_require__(/*! @util/index */ \"@util/index\");\n\nvar index_2 = __importDefault(__webpack_require__(/*! ./MQ/index */ \"./src/instance/pipe/MQ/index.ts\"));\n\nvar injection_1 = __webpack_require__(/*! ./injection */ \"./src/instance/pipe/injection.ts\");\n\nvar keepObserverPipe =\n/** @class */\nfunction (_super) {\n  __extends(keepObserverPipe, _super);\n\n  function keepObserverPipe(keepObserver, config) {\n    var _this = _super.call(this, config) || this;\n\n    _this.pipeMap = {}; //method\n\n    _this.injection = injection_1.injection.bind(_this); // api\n\n    _this.use = injection_1.use.bind(_this); //获取实例配置\n\n    _this._config = config; //获取kp实例\n\n    _this.$keepObserver = keepObserver; //消息队列实例\n\n    _this.$mq = new index_2[\"default\"](config, _this\n    /* $pipe */\n    ); //管道用户\n\n    _this.pipeUser = [];\n    return _this;\n  }\n\n  return keepObserverPipe;\n}(index_1.KeepObserverPublic);\n\nexports[\"default\"] = keepObserverPipe;\n\n/***/ }),\n\n/***/ \"./src/instance/pipe/injection.ts\":\n/*!****************************************!*\\\n  !*** ./src/instance/pipe/injection.ts ***!\n  \\****************************************/\n/*! no static exports found */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar index_1 = __webpack_require__(/*! @util/index */ \"@util/index\");\n\nvar index_2 = __importDefault(__webpack_require__(/*! ./PipeUser/index */ \"./src/instance/pipe/PipeUser/index.ts\"));\n/*\n    receive Plug-ins Server\n    params\n    @Provider  type es6 class  or classInstance\n    explan: Provider class render apply function ,apply runing return method object ,on mounted is keepObsever class\n */\n\n\nexports.use = function (Provider) {\n  var _self = this;\n\n  var isCheckRepeatUse = _self._config.isCheckRepeatUse;\n\n  if (!Provider || !index_1.Tools.isFunction(Provider) && !index_1.Tools.isClassObject(Provider)) {\n    var errorMsg = \"use method receive provider is not right\";\n    index_1.consoleTools.warnError(errorMsg);\n    return _self.$keepObserver.runMiddle('error', errorMsg);\n  } //初始化注入服务\n\n\n  var config = _self._config;\n  var providerInstalcen = index_1.Tools.isFunction(Provider) ? new Provider(config) : Provider; //校验重复注入\n  //mind UglifyJS  class = n o a b c ...\n\n  if (isCheckRepeatUse) {\n    var providerName = index_1.Tools.isObject(providerInstalcen) && providerInstalcen.constructor ? providerInstalcen.constructor.name : undefined;\n    var serverId = providerName + '-' + index_1.Tools.getHashCode(providerInstalcen);\n\n    if (!providerName || this.pipeMap[serverId]) {\n      var errorMsg = !providerName ? \"Provider.constructor is undefined\" : providerName + \" already injection server\";\n      index_1.consoleTools.warnError(errorMsg);\n      return _self.$keepObserver.runMiddle('error', errorMsg);\n    }\n\n    this.pipeMap[serverId] = true;\n  } //检查注入方法是否存在存在apply,存在则加入到管道流中\n  //并检查是否存在返回方法，挂载在自身中,用于对外提供\n\n\n  var _a = providerInstalcen.apply,\n      apply = _a === void 0 ? null : _a;\n\n  if (apply && index_1.Tools.isFunction(apply)) {\n    this.injection(providerInstalcen, apply);\n    return Promise.resolve(providerInstalcen);\n  } else {\n    var errorMsg = \"use method receive provider is not apply method\";\n    index_1.consoleTools.warnError(errorMsg);\n    return _self.$keepObserver.runMiddle('error', errorMsg);\n  }\n};\n/*\n    注入\n    params\n    @scope  type object\n        explan:this指向\n    @applyFn type function\n        explan: apply function\n */\n\n\nexports.injection = function (scope, applyFn) {\n  var _self = this;\n\n  var config = this._config; //check data\n\n  if (!applyFn || !index_1.Tools.isFunction(applyFn)) {\n    var errorMsg = \"injection receive because Provider apply is undefined or no function\";\n    index_1.consoleTools.warnError(errorMsg);\n    return _self.$keepObserver.runMiddle('error', errorMsg);\n  } //cerate pipeUser and add quenen\n\n\n  var pipeUser = new index_2[\"default\"](_self.pipeUser.length, _self, scope);\n\n  try {\n    // runing apply\n    var userRenderMethod = applyFn.call(scope, pipeUser, config); //new version mounte api method\n    // 1. $keepObserver.registerApi \n    // 2. userRenderMethod : {apiName:callback}\n\n    if (_self.$keepObserver.registerApi && index_1.Tools.isObject(userRenderMethod) && !index_1.Tools.isEmptyObject(userRenderMethod)) {\n      index_1.Tools.map(userRenderMethod, function (callback, apiName) {\n        if (!apiName || !callback) {\n          var errorMsg = \"apiName is '' or callback is undefined\";\n          index_1.consoleTools.warnError(errorMsg);\n          return _self.$keepObserver.runMiddle('error', errorMsg);\n        }\n\n        _self.$keepObserver.registerApi(apiName, callback.bind(scope));\n      });\n    }\n\n    _self.pipeUser[_self.pipeUser.length] = pipeUser;\n  } catch (e) {\n    var errorMsg = 'injection receive Provider apply is runing find error:' + e;\n    index_1.consoleTools.warnError(errorMsg);\n    return _self.$keepObserver.runMiddle('error', errorMsg);\n  }\n};\n\n/***/ }),\n\n/***/ \"@util/index\":\n/*!******************************!*\\\n  !*** external \"@util/index\" ***!\n  \\******************************/\n/*! no static exports found */\n/***/ (function(module, exports) {\n\nmodule.exports = __WEBPACK_EXTERNAL_MODULE__util_index__;\n\n/***/ })\n\n/******/ });\n});"],"mappings":"AAAA;;;;;ACwFA;;;;;AA0MA;;;;;AAsCA;;;;;AAsBA;;;;;AA4HA;;AAiBA;;;;;AAwCA;;AAuBA;;AAIA;;AAIA;;AAIA;;AAIA;;;;;AAWA;;AAgDA;;AAEA;;AAEA;;;;;AA8LA;;AAoEA;;AAEA;;AAEA;;;;;AA2FA;;AAeA;;AAEA;;AAEA;;;;;ACr5BA;;AAQA;;;;;AAmMA;;;;;AAsHA;;AA0BA;;AAEA;;AAEA;;AAEA;;AAEA;;;;;AA8RA;;AA+BA;;AAEA;;AAEA;;;;;AA+NA;;;;;AAoEA;;AA4BA;;;;;AAuEA;;;;;AA0CA;;AA4BA;;AAMA;;;;;AA+FA;;AA0BA;;AAEA;;AAEA;;;;;AA+BA;;;;;AAsGA;;AAiCA;;AASA;;;;;AAkJA;;;;;AAgFA;;AA0BA;;AAEA;;AAEA;;AAEA;;AAEA;;;;;AAkFA;;;;;AA+DA;;;;;AAsEA;;;;;AAkIA;;AA0BA;;AAIA;;AAEA;;;;;AA8UA;;AA0BA;;AAEA;;;;;AAoLA;;AA0BA;;;;;AAsBA;;AA0BA;;;;;AAmJA;;AA2BA;;AAEA;;AAEA;;AAEA;;AAEA;;;;;AAsBA;;AA0BA;;AAEA;;;;;AAgJA;;AA0BA;;AAEA;;;;;AA2BA;;AAmCA;;AAEA;;AAIA;;AAOA;;;;;AAwSA;;AA+BA;;;;;AAgFA;;AA0BA;;;;;AA8BA;;AA0BA;;AAEA;;AAEA;;AAEA;;;;;AA8RA;;AA0BA;;AAEA;;AAUA;;;;;AAsNA;;;;;AA0CA;;;;;AAuCA;;;;;AAkBA;;;;;AAmCA;;AASA;;;;;AAoDA;;AAyDA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA;;;;;AA6FA;;AAyBA;;;;;AAyJA;;AAgBA;;AAEA;;AAEA;;;;;AAgJA;;;;;AC1yJA;;;;;AA8BA;;;;;AAwBA;;AA4CA;;;;;AAkNA;;AAyDA;;AAEA;;AAEA;;AAEA;;AAEA;;;;;AA2GA;;AAyBA;;;;;AAiHA;;;;;AC1mBA;;;;;AAoCA;;;;;AA8BA;;AASA;;;;;AA+HA;;AAyDA;;AAEA;;AAEA;;AAEA;;;;;AAyEA;;;;;AClVA;;;;;AA+CA;;;;;AA8BA;;AAmBA;;AAEA;;;;;AAgfA;;AAyDA;;AAEA;;AAEA;;AAEA;;;;;AA2FA;;;;;AA4FA;;;;;ACx0BA;;AASA;;;;;AAmDA;;;;;AA0BA;;AA4CA;;;;;AA2IA;;AAyDA;;AAEA;;AAEA;;AAEA;;;;;AAsEA;;;;;AClZA;;;;;AAsBA;;AAYA;;AAEA;;;;;AAuBA;;AAyDA;;AAEA;;AAEA;;AAIA;;AAIA;;AAIA;;AAIA;;AAEA;;AAEA;;AAEA;;;;;AAgEA;;AA4CA;;;;;AAiDA;;AASA;;;;;AAmBA;;AASA;;;;;AAuBA;;AASA;;;;;AAiCA;;AASA;;AAEA;;;;;AAgCA;;AASA;;;;;AA4CA;;AASA;;;;;AA4FA;;AA4FA;;AAEA;;AAEA;;;;;AAkHA;;AASA;;;;;AA8FA;;AAyCA;;AAEA;;AAEA;;;;;AAwCA;;AAeA;;AAEA;;;;;AA6GA","sourceRoot":""}