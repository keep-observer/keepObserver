!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var r=t();for(var n in r)("object"==typeof exports?exports:e)[n]=r[n]}}(window,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=14)}([function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(t,"__esModule",{value:!0});var o=r(1);function i(e){return"[object Number]"==Object.prototype.toString.call(e)}function a(e){return"[object String]"==Object.prototype.toString.call(e)}function s(e){return"[object Array]"==Object.prototype.toString.call(e)}function u(e){return"[object Boolean]"==Object.prototype.toString.call(e)}function c(e){return"[object RegExp]"==Object.prototype.toString.call(e)}function l(e){return"[object Date]"==Object.prototype.toString.call(e)}function f(e){return void 0===e}function p(e){return null===e}function v(e){return"[object Symbol]"==Object.prototype.toString.call(e)}function d(e){return!("[object Object]"!=Object.prototype.toString.call(e)&&(i(e)||a(e)||u(e)||l(e)||c(e)||s(e)||p(e)||m(e)||f(e)||v(e)))}function y(e){if(!d(e))return!0;for(var t in e)return!1;return!0}function g(e){return!s(e)||!(e.length>0)}function m(e){return"[object Function]"==Object.prototype.toString.call(e)}function h(e){return"object"===("undefined"==typeof HTMLElement?"undefined":n(HTMLElement))?e instanceof HTMLElement:e&&"object"===n(e)&&null!==e&&1===e.nodeType&&"string"==typeof e.nodeName}function b(e){var t=Object.prototype.toString.call(e);return"[object global]"==t||"[object Window]"==t||"[object DOMWindow]"==t}function _(e){var t,r=Object.prototype.hasOwnProperty;if(!e||"object"!==n(e)||e.nodeType||b(e))return!1;try{if(e.constructor&&!r.call(e,"constructor")&&!r.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}for(t in e);return void 0===t||r.call(e,t)}function w(e){return Array.prototype.slice.call(e)}t.dateFormat=function(e,t){if(!t||"string"!=typeof t)return console.error("format is undefiend or type is Error"),"";var r={"y+":(e=e instanceof Date?e:"number"==typeof e||"string"==typeof e?new Date(e):new Date).getFullYear(),"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds()};for(var n in r)if(new RegExp(n).test(t)){var o=RegExp.lastMatch;t=t.replace(o,r[n]<10?"0"+r[n]:r[n].toString())}return t},t.isNumber=i,t.isString=a,t.isArray=s,t.isBoolean=u,t.isRegExp=c,t.isDateObject=l,t.isUndefined=f,t.isNull=p,t.isExist=function(e){return!f(e)&&!p(e)},t.isSymbol=v,t.isSVGElement=function(e){return h(e)&&(e instanceof SVGElement||e.ownerSVGElement)},t.isObject=d,t.isEmptyObject=y,t.isEmptyArray=g,t.isFunction=m,t.isElement=h,t.isWindow=b,t.isPlainObject=_,t.isClassObject=function(e){return!(!d(e)||_(e))},t.toArray=w,t.toString=function(e){return e?"string"==typeof e?e:e.toString():""},t.setSessionStorage=function(e,t){window.sessionStorage&&(e="keepObserverData_"+e,t=JSON.stringify(t),sessionStorage.setItem(e,t))},t.getSessionStorage=function(e){if(window.sessionStorage){e="keepObserverData_"+e;var t=sessionStorage.getItem(e);return t?JSON.parse(t):""}},t.removeSessionStorage=function(e){window.sessionStorage&&(e="keepObserverData_"+e,sessionStorage.removeItem(e))},t.setStorage=function(e,t){window.localStorage&&(e="keepObserverData_"+e,t=JSON.stringify(t),localStorage.setItem(e,t))},t.getStorage=function(e){if(window.localStorage){e="keepObserverData_"+e;var t=localStorage.getItem(e);return t?JSON.parse(t):""}},t.removeStorage=function(e){window.localStorage&&(e="keepObserverData_"+e,localStorage.removeItem(e))},t.getUniqueID=function(){return"xxxxxxxx-xxx-t-xxx--xxxxxxxx".replace(/[xyt]/g,function(e){var t=16*Math.random()|0,r=(new Date).getTime();return("x"==e?t:"t"==e?r:3&t|8).toString(16)})},t.extend=function e(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var n=w(arguments);if(0===n.length)return console.error("extends params is undefined"),{};if(1===n.length)return n[0];var o=n[0],i=n.slice(1,n.length);return d(o)||s(o)||(o={}),i.map(function(t){if(o===t)return!1;if(d(t))for(var r in t)d(t[r])&&!y(t[r])?(o[r]=o[r]&&d(o[r])?o[r]:{},o[r]=e(o[r],t[r])):s(t[r])&&!g(t[r])?(o[r]=o[r]&&s(o[r])?o[r]:[],o[r]=e(o[r],t[r])):d(t[r])&&y(t[r])?o[r]={}:s(t[r])&&g(t[r])?o[r]=[]:o[r]=t[r];else if(s(t))for(var n=0;n<t.length;n++)d(t[n])&&!y(t[n])?(o[n]=o[n]&&d(o[n])?o[n]:{},o[n]=e(o[n],t[n])):s(t[n])&&!g(t[n])?(o[n]=o[n]&&s(o[n])?o[n]:[],o[n]=e(o[n],t[n])):d(t[n])&&y(t[n])?o[n]={}:s(t[n])&&g(t[n])?o[n]=[]:o[n]=t[n]}),o},t.mixin=function(e,t){for(var r in t&&d(t)&&!y(t)||o.warnError("keepObserver $mixin receive params not right"),t)e[r]?o.warnError("keepObserver $mixin method key: "+r+" is exist"):Object.defineProperty(e,r,{configurable:!1,enumerable:!0,value:t[r]})},t.filter=function(e,t){if(!s(e)&&!d(e)||!m(t))return e;if(s(e))return e.filter(t);var r={};for(var n in e){var o=e[n];t(o,n)&&(r[n]=o)}return r},t.map=function(e,t){if(!s(e)&&!d(e)||!m(t))return e;if(s(e))return e.map(t);var r={};for(var n in e){var o=e[n];r[n]=t(o,n)}return r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=window.console.log,o=window.console.warn,i=window.console.error;window.console.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];n.apply(window.console,e)},window.console.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];i.apply(window.console,e)},window.console.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];o.apply(window.console,e)},t.log=n,t.error=i,t.wran=o,t.warnError=function(e,r){if(void 0===r&&(r=!0),r)return t.error("[keepObserver] find error! message: "+e)}},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(r(0)),a=r(1),s=o(r(3)),u=function(){function e(e){var t=e.develop,r=void 0!==t&&t;this._develop=r,this.middleWareInstance=new s.default(e)}return e.prototype.useMiddle=function(){},e.prototype.runMiddle=function(){},e.prototype.addReportListener=function(e){e&&this.eventListener.push(e)},e.prototype.noticeReport=function(e,t){var r=this;return 0!==r.eventListener.length&&Promise.all(r.eventListener.map(function(n){if(i.isFunction(n))return n(e,t);var o="eventListener "+i.toString(n)+" is not Function";return a.warnError(o,r._develop),Promise.reject(o)}))},e}();t.default=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){return function(e){var t=e.develop,r=void 0!==t&&t;this._develop=r}}();t.default=n},,,function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RecordKey="simpleH5Analyse-"+window.location.href,t.RecordDataKey="simpleH5AnalyseDate-"+window.location.href,t.exitBackstageFlag="backstageFlag"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.handleReportData=function(e){var t={lazy:!1,isError:!1,isReport:!0};return{reportParams:{type:"analyse",typeName:"simpleH5",data:e,location:window.location.href,environment:window.navigator.userAgent,reportTime:(new Date).getTime()},control:t}}},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var o=n(r(0)),i=r(6);t.stopAnalyse=function(){this.destroy()},t.startAnalyse=function(e){var t=!0;this._addEventListener||(t=this._handleEventTarget()),t&&this.begine(e)},t.clearSaveRecive=function(){o.removeStorage(i.RecordKey)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isHidden=function(){var e=function(){var e=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var t=0;t<e.length;t++)if(e[t]+"Hidden"in document)return e[t]+"Hidden";return null}();return!!e&&document[e]},t.createDataRecord=function(){var e=new Date,t=e.getFullYear(),r=e.getMonth()+1,n=e.getDate();return parseInt(t+""+r+n)}},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var o=n(r(0)),i=n(r(9)),a=r(6),s=i.createDataRecord();t.begine=function(e){var t=this,r=e.analyseDomList;r||o.isArray(r)?t.analyseDomList=t.handleAnalyseDomList(r,function(e){t.triggerAcitveReport(e)}):t.$devWarn("[keepObserver] analyseServer simpleH5 is analyse dom list is no exist or is no arrayType"),t.triggerInitReport()},t.destroy=function(){if(!o.isEmptyObject(this.analyseDomList))for(var e in this.analyseDomList){var t=this.analyseDomList[e];t.destroyEvent&&o.isFunction(t.destroyEvent)&&t.destroyEvent()}this._recoverEventTarget(),this.analyseDomList={},this._domListener={}},t.triggerAcitveReport=function(e){var t=(e=e||window.event).target,r=t.nodeName.toLowerCase(),n=this._config.timeoutDispatchEvent;if("a"===r&&t.href){var o=t.href;e.preventDefault(),setTimeout(function(){window.location.href=o},n)}this.reportData=this.createReportData(),this.noticeReport(this.reportData)},t.triggerInitReport=function(){var e=o.getStorage(a.RecordKey),t=o.getSessionStorage(a.exitBackstageFlag),r=o.getStorage(a.RecordDataKey);if(e&&(this.reportData=o.extend(this.reportData,e)),t||(this.reportData.repeatCount+=1,this.reportData.repeatCountAll+=1,this.reportData=this.createReportData(),this.noticeReport(this.reportData),o.setSessionStorage(a.exitBackstageFlag,!0)),r){if(parseInt(r)<s){if(this.reportData.repeatCount=0,!o.isEmptyObject(this.reportData.useActives))for(var n in this.reportData.useActives)this.reportData.useActives[n].activeCount=0;o.setStorage(a.RecordDataKey,s)}}else o.setStorage(a.RecordDataKey,s)},t.createReportData=function(){var e=this.reportData;if(!o.isEmptyObject(this.analyseDomList))for(var t in this.analyseDomList){var r=this.analyseDomList[t];e.useActives[t]?o.isExist(e.useActives[t].activeCount)?r.getActiveStauts()&&(e.useActives[t].activeCount+=1,e.useActives[t].activeCountAll+=1):(e.useActives[t].activeCount=0,e.useActives[t].activeCountAll=0):e.useActives[t]={activeCount:r.getActiveStauts()?1:0,activeCountAll:r.getActiveStauts()?1:0}}return o.setStorage(a.RecordKey,e),e}},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var o=n(r(0)),i=n(r(1)),a="keepObserverUniqueID"+o.getUniqueID().substring(0,8);t.registerAnalyseDomEvent=function(e,t){var r=this,n=e.tagName.toLowerCase(),i=(r._config.timeoutDispatchEvent,"click");return"input"!==n&&"textarea"!==n&&"select"!==n||(i="change"),r._addEventListener.apply(e,[i,t]),e.setAttribute(a,!0),function(){e&&o.isElement(e)&&r._removeEventListener.apply(e,[i,t]),i=null,n=null}},t._handleEventTarget=function(){var e=this,t=e._config.timeoutDispatchEvent;return window.Node&&Node.prototype.addEventListener?(e._addEventListener=Node.prototype.addEventListener,e._removeEventListener=Node.prototype.removeEventListener,Node.prototype.addEventListener=function(){var r=this,n=o.toArray(arguments);if(n.length<2||!o.isString(n[0])||!o.isFunction(n[1]))return i.warnError("element addEventListener params error"),!1;var s=n[1];return n[1]=function(){var e=r.getAttribute(a),n=o.toArray(arguments);return e?setTimeout(function(){s.apply(r,n)},t):s.apply(r,n)},e._addEventListener.apply(r,n)},Node.prototype.removeEventListener=function(){var t=o.toArray(arguments);return t.length<2||!o.isString(t[0])||!o.isFunction(t[1])?(i.warnError("element removeEventListener params error"),!1):e._removeEventListener.apply(this,t)},!0):(i.warnError("analyseServer simpleH5: borwser not can EventTarget.prototype.addEventListener"),!1)},t._recoverEventTarget=function(){if(!window.Node||!Node.prototype.addEventListener)return i.warnError("analyseServer simpleH5: borwser not can EventTarget.prototype.addEventListener"),!1;Node.prototype.addEventListener=this._addEventListener,Node.prototype.removeEventListener=this._removeEventListener,this._removeEventListener=!1,this._addEventListener=!1}},function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var o=n(r(0)),i=n(r(1)),a=/[\u4e00-\u9fa5\w]/gi,s=/[^\u4e00-\u9fa5\w]/gi,u=1,c=1;t.handleAnalyseDomList=function(e,t){var r=this,n={},a={};return e.forEach(function(e){if(!o.isString(e)&&!o.isElement(e))return i.warnError("analyseServer simpleH5 config analyseDomList item is not string or not domElement"),!1;var s=o.isElement(e)?e:document.querySelector(e);if(!s||!o.isElement(s))return i.warnError("analyseServer simpleH5 config analyseDomList item is not find domElement"),!1;var u=r.getDomTitle(s);n[u]&&(u+="-"+c,c++),a[u]=!1;var l=r.registerAnalyseDomEvent(s,function(e){a[u]=!0,t&&o.isFunction(t)&&t(e)});n[u]={destroyEvent:l,getActiveStauts:function(e){return function(){return a[e]}}(u)}}),n},t.getDomTitle=function(e){var t=e.tagName.toLowerCase(),r="";return e.outerText&&a.test(e.outerText)?r=(r=e.outerText).replace(s,""):e.textContent&&a.test(e.textContent)?r=e.textContent.replace(s,""):""!==e.className?r="."+e.className:(r=""+u,u++),t+":"+r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={initBegine:!1,timeoutDispatchEvent:200}},function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(t,"__esModule",{value:!0});var a=o(r(13)),s=i(r(0)),u=o(r(2)),c=r(12),l=r(11),f=r(10),p=r(8),v=r(7),d=function(e){function t(t){var r=e.call(this,t)||this;r.getDomTitle=c.getDomTitle.bind(r),r.handleAnalyseDomList=c.handleAnalyseDomList.bind(r),r.stopAnalyse=p.stopAnalyse.bind(r),r.startAnalyse=p.startAnalyse.bind(r),r.clearSaveRecive=p.clearSaveRecive.bind(r),r.handleReportData=v.handleReportData.bind(r),r.registerAnalyseDomEvent=l.registerAnalyseDomEvent.bind(r),r._handleEventTarget=l._handleEventTarget.bind(r),r._recoverEventTarget=l._recoverEventTarget.bind(r),r.begine=f.begine.bind(r),r.destroy=f.destroy.bind(r),r.triggerAcitveReport=f.triggerAcitveReport.bind(r),r.triggerInitReport=f.triggerInitReport.bind(r),r.createReportData=f.createReportData.bind(r);var n=t.simpleH5AnalyseCustom,o=void 0!==n&&n||{};return r._config=s.extend(a.default,o),r._addEventListener=!1,r._removeEventListener=!1,r._domListener={},r.analyseDomList={},r.uniqueId=s.getUniqueID(),r.reportData={id:s.getUniqueID(),repeatCountAll:0,repeatCount:0,useActives:{}},r._handleEventTarget()&&r._config.initBegine&&r._config.begineConfig&&r.startAnalyse(r._config.begineConfig),r}return n(t,e),t.prototype.apply=function(e){return this.addReportListener(e.sendPipeMessage),{$simpleH5AnalyseClearSaveRecive:this.clearSaveRecive,$simpleH5AnalyseStop:this.stopAnalyse,$simpleH5AnalyseBegine:this.startAnalyse}},t}(u.default);t.default=d}])});